<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="https://www.w3.org/2005/Atom">
  <title>ChowMe</title>
  <icon>https://www.gravatar.com/avatar/a73d30b0d26382bb941766ce55d0904e</icon>
  <subtitle>Hello,World</subtitle>
  <link href="/BeCoderQ.github.io/atom.xml" rel="self"/>
  
  <link href="http://localhost:4000/"/>
  <updated>2021-07-19T08:50:35.924Z</updated>
  <id>http://localhost:4000/</id>
  
  <author>
    <name>Chow</name>
    <email>zhouqm814@sina.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å®ç°Vuexç²¾å‡†çš„ç±»å‹æ¨æ–­Betaç‰ˆ</title>
    <link href="http://localhost:4000/2021/07/19/%E5%AE%9E%E7%8E%B0Vuex%E6%9C%80%E7%B2%BE%E5%87%86%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%ADBeta%E7%89%88/"/>
    <id>http://localhost:4000/2021/07/19/%E5%AE%9E%E7%8E%B0Vuex%E6%9C%80%E7%B2%BE%E5%87%86%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%8E%A8%E6%96%ADBeta%E7%89%88/</id>
    <published>2021-07-19T06:15:54.000Z</published>
    <updated>2021-07-19T08:50:35.924Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å’ŒVuexè€—ä¸Šäº†"><a href="#å’ŒVuexè€—ä¸Šäº†" class="headerlink" title="å’ŒVuexè€—ä¸Šäº†"></a>å’ŒVuexè€—ä¸Šäº†</h1><p>ä¸Šä¸€æ¬¡æˆ‘ä¹Ÿå¯¹Vuexè¿›è¡Œäº†æ¨æ–­ï¼Œä½†ç»“æœå¾ˆéš¾è®©äººæ»¡æ„: <a href="http://zyyzg.cn/2021/06/02/%E8%AE%B0%E4%B8%80%E6%AC%A1Vuex%E4%B8%ADcommit%E7%B1%BB%E5%9E%8B%E6%A0%A1%E9%AA%8C%E7%9A%84%E8%BF%87%E7%A8%8B/" target="_blank" rel="noopener">http://zyyzg.cn/2021/06/02/%E8%AE%B0%E4%B8%80%E6%AC%A1Vuex%E4%B8%ADcommit%E7%B1%BB%E5%9E%8B%E6%A0%A1%E9%AA%8C%E7%9A%84%E8%BF%87%E7%A8%8B/</a></p><p>äºæ˜¯è¿™æ¬¡è®¤çœŸæ€è€ƒäº†ä¸€ä¸‹ï¼Œæœ‰äº†ä¸€ä¸ªæ–°çš„æ–¹æ¡ˆï¼Œå¤æ‚çš„æ˜ å°„åï¼ˆæˆ‘è§‰å¾—è¿‡ç¨‹å†™å¾—å¾ˆéº»çƒ¦ï¼Œæ¯•ç«Ÿæ°´å¹³æœ‰é™ï¼‰èƒ½æ‹¿åˆ°å‹‰å¼ºæ»¡æ„çš„ç»“æœäº†ï¼š</p><h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><p><img src="/BeCoderQ.github.io/2021/07/19/å®ç°Vuexæœ€ç²¾å‡†çš„ç±»å‹æ¨æ–­Betaç‰ˆ/state.gif" alt="å›¾"></p><h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><p><img src="/BeCoderQ.github.io/2021/07/19/å®ç°Vuexæœ€ç²¾å‡†çš„ç±»å‹æ¨æ–­Betaç‰ˆ/commit.gif" alt="å›¾"></p><h3 id="dispatch"><a href="#dispatch" class="headerlink" title="dispatch"></a>dispatch</h3><p><img src="/BeCoderQ.github.io/2021/07/19/å®ç°Vuexæœ€ç²¾å‡†çš„ç±»å‹æ¨æ–­Betaç‰ˆ/dispatch.gif" alt="å›¾"></p><p>å¯ä»¥çœ‹åˆ°stateèƒ½å¤Ÿæ‹¿åˆ°moduleså†…çš„ï¼Œcommitå’Œdispatchèƒ½æ‹¿åˆ°å‘½åç©ºé—´keyï¼Œå¹¶ä¸”ç¬¬äºŒä¸ªå‚æ•°(payload)çš„ç±»å‹ä¹Ÿèƒ½å¤Ÿä¸ä¹‹å¯¹åº”ã€‚</p><h3 id="store-index-tsæ–‡ä»¶"><a href="#store-index-tsæ–‡ä»¶" class="headerlink" title="store/index.tsæ–‡ä»¶"></a>store/index.tsæ–‡ä»¶</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex, &#123; Commit &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> &#123; isOwnKey, NonNeverState, GetState, GetMutationKeyParamMap, GetActionKeyParamMap &#125; <span class="keyword">from</span> <span class="string">"vuex-with-type"</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  token: <span class="string">""</span>,</span><br><span class="line">  openId: <span class="string">""</span>,</span><br><span class="line">  name: <span class="string">""</span>,</span><br><span class="line">  appId: <span class="string">"1"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** modulesæµ‹è¯• */</span></span><br><span class="line"><span class="keyword">const</span> modOneState = &#123;</span><br><span class="line">  name: <span class="string">"z"</span>,</span><br><span class="line">  age: <span class="number">24</span>,</span><br><span class="line">  job: <span class="string">'frontier-engineer'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modOneMutation = &#123;</span><br><span class="line">  SET_STATE(state: <span class="keyword">typeof</span> modOneState, obj: Partial&lt;<span class="keyword">typeof</span> modOneState&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isOwnKey(key, obj)) &#123;</span><br><span class="line">        state[key] = obj[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  SET_NAME(state: &#123; name: <span class="built_in">string</span> &#125;, v: <span class="built_in">string</span>) &#123;</span><br><span class="line">    state.name = v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modTwoState = &#123;</span><br><span class="line">  name: <span class="string">"q"</span>,</span><br><span class="line">  age: <span class="number">25</span>,</span><br><span class="line">  job: <span class="string">'back-end-engineer'</span>,</span><br><span class="line">  <span class="number">996</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> modTwoMutation = &#123;</span><br><span class="line">  SET_STATE(state: <span class="keyword">typeof</span> modTwoState, obj: Partial&lt;<span class="keyword">typeof</span> modTwoState&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isOwnKey(key, obj)) &#123;</span><br><span class="line">        state[key] = obj[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  SET_AGE(state: &#123; age: <span class="built_in">number</span> &#125;, v: <span class="built_in">number</span>) &#123;</span><br><span class="line">    state.age = v;</span><br><span class="line">  &#125;,</span><br><span class="line">  SET_996(state: &#123; <span class="number">996</span>: <span class="built_in">boolean</span> &#125;, v: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">    state[<span class="number">996</span>] = v;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†vuex storeç‹¬ç«‹å‡ºæ¥</span></span><br><span class="line"><span class="keyword">const</span> storeOptions = &#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    SET_STATE(s: NonNeverState&lt;<span class="keyword">typeof</span> state&gt;, obj: Partial&lt;NonNeverState&lt;<span class="keyword">typeof</span> state&gt;&gt;) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isOwnKey(key, obj)) &#123;</span><br><span class="line">          s[key] = obj[key];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    SET_NAME(s: NonNeverState&lt;<span class="keyword">typeof</span> state&gt;, v: <span class="built_in">string</span>) &#123;</span><br><span class="line">      s.name = v;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    SET_ASYNC_STATE(&#123; commit &#125;: &#123; commit: Commit &#125;, obj: Partial&lt;NonNeverState&lt;<span class="keyword">typeof</span> state&gt;&gt;) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">          commit(<span class="string">"SET_STATE"</span>, obj);</span><br><span class="line">          resolve(obj);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  modules: &#123;</span><br><span class="line">    modOne: &#123;</span><br><span class="line">      namespaced: <span class="literal">true</span>,</span><br><span class="line">      state: modOneState,</span><br><span class="line">      mutations: modOneMutation,</span><br><span class="line">      actions: &#123;</span><br><span class="line">        SET_ASYNC_NAME(&#123; commit &#125;: &#123; commit: Commit &#125;, name: <span class="built_in">string</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">              commit(<span class="string">"modOne/SET_NAME"</span>, name);</span><br><span class="line">              resolve(name);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      modules: &#123;</span><br><span class="line">        modOneSon: &#123;</span><br><span class="line">          namespaced: <span class="literal">true</span>,</span><br><span class="line">          state: &#123;</span><br><span class="line">            jk: <span class="literal">true</span></span><br><span class="line">          &#125;,</span><br><span class="line">          mutations: &#123;</span><br><span class="line">            SET_JK(state: &#123; jk: <span class="built_in">boolean</span> &#125;, v: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">              state.jk = v;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          actions: &#123;</span><br><span class="line">            SET_ASYNC_JK(&#123; commit &#125;: &#123; commit: Commit &#125;, v: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> &#123;</span><br><span class="line">                setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">                  commit(<span class="string">"modOne/modOneSon/SET_JK"</span>, v);</span><br><span class="line">                  resolve(v);</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          modules: &#123;</span><br><span class="line">            modOneSonSon: &#123;</span><br><span class="line">              namespaced: <span class="literal">true</span>,</span><br><span class="line">              state: &#123;</span><br><span class="line">                kpi: <span class="literal">true</span></span><br><span class="line">              &#125;,</span><br><span class="line">              mutations: &#123;</span><br><span class="line">                SET_KPI(state: &#123; kpi: <span class="built_in">boolean</span> &#125;, v: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">                  state.kpi = v;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              actions: &#123;</span><br><span class="line">                SET_ASYNC_KPI(&#123; commit &#125;: &#123; commit: Commit &#125;, v: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> &#123;</span><br><span class="line">                    setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">                      commit(<span class="string">"modOne/modOneSon/modOneSonSon/SET_KPI"</span>, v);</span><br><span class="line">                      resolve(v);</span><br><span class="line">                    &#125;);</span><br><span class="line">                  &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    modTwo: &#123;</span><br><span class="line">      namespaced: <span class="literal">true</span>,</span><br><span class="line">      state: modTwoState,</span><br><span class="line">      mutations: modTwoMutation,</span><br><span class="line">      actions: &#123;</span><br><span class="line">        SET_ASYNC_AGE(&#123; commit &#125;: &#123; commit: Commit &#125;, v: <span class="built_in">number</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">              commit(<span class="string">"modTwo/SET_AGE"</span>, v);</span><br><span class="line">              resolve(v);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        SET_ASYNC_996(&#123; commit &#125;: &#123; commit: Commit &#125;, v: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> &#123;</span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">              commit(<span class="string">"modTwo/SET_996"</span>, v);</span><br><span class="line">              resolve(v);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> TState = NonNeverState&lt;GetState&lt;<span class="keyword">typeof</span> storeOptions&gt;&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> TMutation = GetMutationKeyParamMap&lt;<span class="keyword">typeof</span> storeOptions&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> TAction = GetActionKeyParamMap&lt;<span class="keyword">typeof</span> storeOptions&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store&lt;TState&gt;(storeOptions);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure><h1 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h1><p>åˆ©ç”¨å·¥ä½œé—´éš™æ–­æ–­ç»­ç»­å†™äº†ä¸¤ä¸‰å‘¨æ—¶é—´ï¼Œä¸­é—´ä¹Ÿå‡ºç°å› ä¸ºéš”äº†å¾ˆé•¿æ—¶é—´æ²¡å†™éƒ½å¿˜è®°ä¸Šæ¬¡æƒ³åˆ°å“ªå„¿äº†XDï¼Œç¡®å®é‡åˆ°äº†å‡ ä¸ªé—®é¢˜ï¼Œä»¥ä¸‹ç”±æ˜“åˆ°éš¾ï¼š</p><h2 id="æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥" class="headerlink" title="æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥"></a>æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥</h2><p>å› ä¸ºè¦å®ç°<code>modules</code>åµŒå¥—å<code>mutation</code>ä¸`actionä»¥â€/â€œä¸ºåˆ†éš”çš„å‘½åç©ºé—´ï¼Œå¿…é¡»è¦ç”¨ä¸ŠTS4.1å‡ºçš„æ¨¡æ¿å­—ç¬¦ä¸²æ–°ç‰¹æ€§ï¼š<a href="https://www.typescriptlang.org/docs/handbook/2/template-literal-types.html" target="_blank" rel="noopener">https://www.typescriptlang.org/docs/handbook/2/template-literal-types.html</a>. </p><p>æœ¬è´¨ä¸Šè¿™å°±æ˜¯jsé‡Œçš„æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸è¿‡æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯ä¼ å…¥çš„èŒƒå‹æ‰”åˆ°å­—ç¬¦ä¸²æ‹¼æ¥typeåä¼šæŠ¥é”™ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰keyçš„ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> KeyType = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"><span class="comment">// æ‹¼æ¥key</span></span><br><span class="line"><span class="keyword">type</span> AddPrefix&lt;Prefix <span class="keyword">extends</span> KeyType, Keys <span class="keyword">extends</span> KeyType&gt; = <span class="string">`<span class="subst">$&#123;Prefix&#125;</span>/<span class="subst">$&#123;Keys&#125;</span>`</span>;</span><br><span class="line"><span class="comment">// ä½¿ç”¨é‡åˆ°é—®é¢˜</span></span><br><span class="line"><span class="keyword">type</span> AddPrefixKeys&lt;P, S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = GetValue&lt;&#123;</span><br><span class="line">  [K <span class="keyword">in</span> S]: P <span class="keyword">extends</span> <span class="string">""</span> ? K : AddPrefix&lt;P, K&gt;;</span><br><span class="line">&#125;&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒPä¼šæŠ¥é”™ï¼š<strong>ç±»å‹â€œPâ€ä¸æ»¡è¶³çº¦æŸâ€œKeyTypeâ€</strong>ã€‚å®é™…ä¸ŠæŠŠèŒƒå‹Pé‚£å„¿æ”¹æˆ<code>P extends KeyType</code>å°±å¯ä»¥äº†ï¼Œä½†æ˜¯åœ¨ä¸€äº›ä½¿ç”¨åœºæ™¯ä¸‹ä½ æ‹¿åˆ°å¹¶è¯•å›¾ä¼ å…¥çš„å¹¶ä¸ä¸€å®šèƒ½å°†ç±»å‹ç¼©çª„åˆ°<code>KeyType</code>ï¼Œæ‰€ä»¥è‡ªå·±å†™äº†ä¸ªæ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Revert2Key&lt;T&gt; = T <span class="keyword">extends</span> KeyType ? T : KeyType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AddPrefixKeys&lt;P, S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = GetValue&lt;&#123;</span><br><span class="line">  [K <span class="keyword">in</span> S]: P <span class="keyword">extends</span> <span class="string">""</span> ? K : AddPrefix&lt;Revert2Key&lt;P&gt;, K&gt;;</span><br><span class="line">&#125;&gt;</span><br></pre></td></tr></table></figure><p>ä½†åé¢å‘ç°å…¶å®è¿˜å¯ä»¥ç”¨äº¤å‰ç±»å‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> AddPrefixKeys&lt;P, S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = GetValue&lt;&#123;</span><br><span class="line">  [K <span class="keyword">in</span> S]: P <span class="keyword">extends</span> <span class="string">""</span> ? K : AddPrefix&lt;P &amp; <span class="built_in">string</span>, K&gt;;</span><br><span class="line">&#125;&gt;</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾ï¼Œç¬¬äºŒç§æ–¹å¼æ›´ä¼˜é›…ã€‚</p><h2 id="ä½¿ç”¨è€…å®šä¹‰stateæ—¶ï¼Œå‡ºç°neverç±»å‹å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#ä½¿ç”¨è€…å®šä¹‰stateæ—¶ï¼Œå‡ºç°neverç±»å‹å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="ä½¿ç”¨è€…å®šä¹‰stateæ—¶ï¼Œå‡ºç°neverç±»å‹å¦‚ä½•è§£å†³ï¼Ÿ"></a>ä½¿ç”¨è€…å®šä¹‰stateæ—¶ï¼Œå‡ºç°neverç±»å‹å¦‚ä½•è§£å†³ï¼Ÿ</h2><p>å…¶å®å½“æˆ‘ä»¬ç»™ä¸€ä¸ªstateå…¶ä¸­ä¸€ä¸ªå˜é‡èµ‹åˆå§‹å€¼ä¸º[]æ—¶ï¼Œå®ƒçš„ç±»å‹å°±ä¼šè¢«è‡ªåŠ¨æ¨æ–­ä¸º<code>never[]</code>ã€‚æˆ‘å†™äº†ä¸€ä¸ªå·¥å…·æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> DealNeverType&lt;T&gt; = T <span class="keyword">extends</span> never ? <span class="built_in">any</span> : T <span class="keyword">extends</span> never[] ? <span class="built_in">any</span>[] : T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> NonNeverState&lt;R <span class="keyword">extends</span> object&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof R]: R[K] <span class="keyword">extends</span> (<span class="built_in">any</span>[] | never) ? </span><br><span class="line">  DealNeverType&lt;R[K]&gt; : (R[K] <span class="keyword">extends</span> object ? </span><br><span class="line">  NonNeverState&lt;R[K]&gt; : DealNeverType&lt;R[K]&gt;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå¼€å§‹æˆ‘å†™çš„ç‰ˆæœ¬ï¼Œè¿™å…¶ä¸­æœ‰ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼ŒåŸå› æ˜¯æˆ‘æ²¡æœ‰ç†è§£neverè¿™ä¸ªç‰¹æ®Šç±»å‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> CheckNever&lt;T&gt; = T <span class="keyword">extends</span> never ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// ç»“æœå¹¶ä¸æ˜¯æƒ³è±¡é‚£æ ·</span></span><br><span class="line"><span class="keyword">type</span> Test = CheckNever&lt;never&gt;; <span class="comment">// never</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œneveræ˜¯æ‰€æœ‰ç±»å‹çš„subTypeï¼Œè¿™é‡Œåªéšä¾¿ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Test2 = never <span class="keyword">extends</span> symbol ? <span class="literal">true</span> : <span class="literal">false</span>; <span class="comment">// true</span></span><br></pre></td></tr></table></figure><p>å¾ˆå¿«ï¼Œæˆ‘åœ¨Typescriptçš„ä»“åº“æ‰¾åˆ°äº†ç­”æ¡ˆï¼š<a href="https://github.com/microsoft/TypeScript/issues/23182ã€‚" target="_blank" rel="noopener">https://github.com/microsoft/TypeScript/issues/23182ã€‚</a></p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> DealNeverType&lt;T&gt; = [T] <span class="keyword">extends</span> [never] ? <span class="built_in">any</span> : ([T] <span class="keyword">extends</span> [never[]] ? <span class="built_in">any</span>[] : T);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> NonNeverState&lt;R <span class="keyword">extends</span> object&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof R]: R[K] <span class="keyword">extends</span> (<span class="built_in">any</span>[] | never) ? </span><br><span class="line">  DealNeverType&lt;R[K]&gt; : (R[K] <span class="keyword">extends</span> object ? </span><br><span class="line">  NonNeverState&lt;R[K]&gt; : DealNeverType&lt;R[K]&gt;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆå°±æ˜¯è®©ä»–ä»¬å˜æˆå…ƒç¥–ã€‚</p><h2 id="å½“Storeæ ‘æœ‰Nå±‚modulesï¼Œå¦‚ä½•è·å–æ‰€æœ‰çš„keyï¼Ÿ"><a href="#å½“Storeæ ‘æœ‰Nå±‚modulesï¼Œå¦‚ä½•è·å–æ‰€æœ‰çš„keyï¼Ÿ" class="headerlink" title="å½“Storeæ ‘æœ‰Nå±‚modulesï¼Œå¦‚ä½•è·å–æ‰€æœ‰çš„keyï¼Ÿ"></a>å½“Storeæ ‘æœ‰Nå±‚modulesï¼Œå¦‚ä½•è·å–æ‰€æœ‰çš„keyï¼Ÿ</h2><p>è€å®è¯´è¿™ä¸ªå…¶å®æ˜¯æœ€ç®€å•çš„é—®é¢˜ï¼Œä¸è¿‡æˆ‘ä¸­é—´èµ°äº†ä¸€æ¬¡å¼¯è·¯ï¼Œè¿˜æ˜¯æŠŠå®ƒè€è€å®å®å†™å‡ºæ¥å§ï¼</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// åˆ¤æ–­æ˜¯å¦æ·»åŠ /</span></span><br><span class="line"><span class="keyword">type</span> AddSlashe&lt;T&gt; = T <span class="keyword">extends</span> <span class="string">""</span> ? T : <span class="string">`<span class="subst">$&#123;T &amp; <span class="built_in">string</span>&#125;</span>/`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> GetMutationKeys&lt;N <span class="keyword">extends</span> ModuleStoreOptions, Prefix = <span class="string">""</span>&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof N]: N[K] <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">  (</span><br><span class="line">    AddPrefix&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;Prefix&gt;&#125;</span><span class="subst">$&#123;K &amp; <span class="built_in">string</span>&#125;</span>`</span> , keyof N[K][<span class="string">"mutations"</span>] &amp; <span class="built_in">string</span>&gt; | </span><br><span class="line">    GetMutationKeys&lt;N[K][<span class="string">"modules"</span>], <span class="string">`<span class="subst">$&#123;AddSlashe&lt;Prefix&gt;&#125;</span><span class="subst">$&#123;K &amp; <span class="built_in">string</span>&#125;</span>`</span>&gt;</span><br><span class="line">  ) : </span><br><span class="line">  AddPrefix&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;Prefix&gt;&#125;</span><span class="subst">$&#123;K &amp; <span class="built_in">string</span>&#125;</span>`</span>, keyof N[K][<span class="string">"mutations"</span>] &amp; <span class="built_in">string</span>&gt;; </span><br><span class="line">&#125;[keyof N];</span><br></pre></td></tr></table></figure><p>é€šè¿‡åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦æœ‰<code>modules</code>æ¥å†³å®šæ˜¯å¦èµ°é€’å½’ä¸‰å…ƒåˆ†æ”¯</p><p><img src="/BeCoderQ.github.io/2021/07/19/å®ç°Vuexæœ€ç²¾å‡†çš„ç±»å‹æ¨æ–­Betaç‰ˆ/infer-1.png" alt="å›¾"></p><p>å¯ä»¥çœ‹åˆ°ç±»å‹ç¡®å®æ¨æ–­å‡ºæ¥äº†ï¼Œæ˜¯é‚£ä¹ˆå›äº‹ï¼Œä¸è¿‡æˆ‘å‘ç°è¿™ä¸ªæ–¹æ³•è¡Œä¸é€šï¼š</p><ul><li>è¿™æ ·åªèƒ½æ‹¿åˆ°mutationsæˆ–è€…actionsçš„keyï¼Œæˆ‘æ‹¿ä¸åˆ°å‚æ•°ï¼ˆå³commit(xxx, payload)å‡½æ•°çš„è¿™ä¸ªpayloadï¼‰ã€‚</li><li>è¿™æ ·æ‹¿ä¸åˆ°ç¬¬ä¸€å±‚stateï¼Œç”¨æˆ·è¦å•ç‹¬ä¼ å…¥modulesç±»å‹å†ä¸å¤–å±‚stateäº¤å‰ï¼Œå¾ˆéº»çƒ¦ã€‚</li></ul><p>ç¬¬äºŒä¸ªé—®é¢˜å¾ˆå¥½è§£å†³ï¼Œå…ˆä¸è°ˆï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±è¦éš¾ä¸€ç‚¹ï¼šè¦å®ç°æœ¬æ–‡æœ€ä¸Šé¢çš„å›¾ç¤ºçš„æ•ˆæœï¼Œå°±å¿…é¡»è¦æŠŠmutationsçš„keyä¸å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°è”ç³»èµ·æ¥ã€‚</p><p>è¿™ä¹Ÿå°±å¼•å‡ºäº†ä¸‹ä¸€ä¸ªé—®é¢˜</p><h2 id="å¦‚ä½•å°†modulesåµŒå¥—çš„keyä¸å‡½æ•°å‚æ•°å¯¹åº”èµ·æ¥ï¼Ÿ"><a href="#å¦‚ä½•å°†modulesåµŒå¥—çš„keyä¸å‡½æ•°å‚æ•°å¯¹åº”èµ·æ¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•å°†modulesåµŒå¥—çš„keyä¸å‡½æ•°å‚æ•°å¯¹åº”èµ·æ¥ï¼Ÿ"></a>å¦‚ä½•å°†modulesåµŒå¥—çš„keyä¸å‡½æ•°å‚æ•°å¯¹åº”èµ·æ¥ï¼Ÿ</h2><p>å®ç°è¿™ç‚¹å¤§ä½“è¦åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><h3 id="è·å–mutationsæˆ–actionsçš„payloadç±»å‹"><a href="#è·å–mutationsæˆ–actionsçš„payloadç±»å‹" class="headerlink" title="è·å–mutationsæˆ–actionsçš„payloadç±»å‹"></a>è·å–mutationsæˆ–actionsçš„payloadç±»å‹</h3><p>æƒ³å®ç°ä¸Šé¢çš„æ•ˆæœï¼Œ<code>infer</code>å…³é”®å­—å°±è¦å¤§æ˜¾ç¥å¨äº†ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªè·å–mutationæˆ–actionå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> GetSecondParamType&lt;M, MK <span class="keyword">extends</span> <span class="built_in">string</span>, K <span class="keyword">extends</span> <span class="built_in">string</span>, KEY = <span class="string">"mutations"</span>, E = never&gt; = M <span class="keyword">extends</span> &#123; </span><br><span class="line">  [X <span class="keyword">in</span> MK]: &#123; </span><br><span class="line">    [X1 <span class="keyword">in</span> KEY &amp; <span class="built_in">string</span>]: &#123; </span><br><span class="line">      [X2 <span class="keyword">in</span> K]: <span class="function">(<span class="params">s: <span class="built_in">any</span>, v: infer N</span>)=&gt;</span> <span class="built_in">any</span> </span><br><span class="line">    &#125; </span><br><span class="line">  &#125; </span><br><span class="line">&#125; ? N | E : never;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥å¾ˆå¤´å¤§ï¼Œæ¢ä¸€ç§å†™æ³•çœ‹ç€ä¼šå¥½ä¸€ç‚¹ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> XXX&lt;....&gt; = M <span class="keyword">extends</span> &#123;</span><br><span class="line">mod: &#123;</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    SET_NAME: <span class="function">(<span class="params">state: <span class="built_in">any</span>, value: <span class="built_in">any</span>[]</span>)=&gt;</span> <span class="built_in">any</span>     </span><br><span class="line">    &#125;      </span><br><span class="line">  &#125;         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç±»å‹è½¬é—¨ç”¨äºæ¨æ–­vuexçš„moduleså†…çš„mutationsæˆ–actionsï¼ŒMæ˜¯æ¨¡å—ç±»å‹ï¼ŒMKæ˜¯è¦æ¨æ–­çš„æŒ‡å®šæ¨¡å—çš„keyï¼ŒKEYæ˜¯é€‰æ‹©mutationsè¿˜æ˜¯actionsï¼ŒKæ˜¯æŒ‡å®šè¦æ¨æ–­çš„mutationsæˆ–actionsçš„æŸä¸€ä¸ªå‡½æ•°ã€‚</p><h4 id="inferå…³é”®å­—"><a href="#inferå…³é”®å­—" class="headerlink" title="inferå…³é”®å­—"></a>inferå…³é”®å­—</h4><p>å¯ä»¥æŠŠinferç†è§£ä¸ºä¸€ä¸ªé™·é˜±(trap)ï¼Œä»¥TSå†…ç½®çš„ReturnTypeä¸ºä¾‹:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ReturnType&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>) =&gt; infer R ? R : <span class="built_in">any</span>;</span><br></pre></td></tr></table></figure><p>å½“ä¼ å…¥å‡½æ•°æ—¶ï¼Œå°±ä¸€å®š<code>extends (...args: any)</code>ï¼Œé‚£ä¹ˆæŠŠ<code>infer R</code>æ”¾åˆ°å‡½æ•°è¿”å›å€¼çš„åœ°æ–¹ï¼Œå®ƒå°±ä¼šæ•è·åˆ°å‡½æ•°çš„è¿”å›ç±»å‹ã€‚</p><h4 id="ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™ä¹ˆå¤šèŒƒå‹å‚æ•°ï¼ŒåƒKç›´æ¥ä¼ å…¥keyof-mutationsä¸è¡Œå—ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™ä¹ˆå¤šèŒƒå‹å‚æ•°ï¼ŒåƒKç›´æ¥ä¼ å…¥keyof-mutationsä¸è¡Œå—ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™ä¹ˆå¤šèŒƒå‹å‚æ•°ï¼ŒåƒKç›´æ¥ä¼ å…¥keyof mutationsä¸è¡Œå—ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™ä¹ˆå¤šèŒƒå‹å‚æ•°ï¼ŒåƒKç›´æ¥ä¼ å…¥keyof mutationsä¸è¡Œå—ï¼Ÿ</h4><p>ç­”æ¡ˆæ˜¯ä¸è¡Œï¼Œç»§ç»­å¾€åçœ‹ï¼Œä½ ä¼šå‘ç°ç›´æ¥ä¼ å…¥keyof mutationsä¼šè®©ç»“æœå˜æˆ<strong>ä¸€å¯¹å¤š</strong>ã€‚</p><h4 id="è¿™é‡Œæœ€åä¸€ä¸ªèŒƒå‹å‚æ•°Eæ˜¯åšä»€ä¹ˆçš„"><a href="#è¿™é‡Œæœ€åä¸€ä¸ªèŒƒå‹å‚æ•°Eæ˜¯åšä»€ä¹ˆçš„" class="headerlink" title="è¿™é‡Œæœ€åä¸€ä¸ªèŒƒå‹å‚æ•°Eæ˜¯åšä»€ä¹ˆçš„"></a>è¿™é‡Œæœ€åä¸€ä¸ªèŒƒå‹å‚æ•°Eæ˜¯åšä»€ä¹ˆçš„</h4><p>è¿™ä¸ªEå¯ä»¥è®©æ‰€æœ‰æ¨æ–­çš„ç±»å‹æœ‰ä¸€ä¸ªè”åˆç±»å‹ï¼Œæ¯”å¦‚<code>null</code>ã€‚è¿™é‡Œè®¾ç½®åˆå§‹å€¼ä¸ºneveræ˜¯å› ä¸º<code>ä»»ä½•ç±»å‹ | never</code>éƒ½ä¼šå¾—åˆ°å…¶æœ¬èº«ï¼Œè¿™èƒ½å…¼å®¹ä¸ä¼ å…¥Eçš„æƒ…å†µã€‚</p><h3 id="é€’å½’å°†keyå’Œpayloadå¯¹åº”èµ·æ¥"><a href="#é€’å½’å°†keyå’Œpayloadå¯¹åº”èµ·æ¥" class="headerlink" title="é€’å½’å°†keyå’Œpayloadå¯¹åº”èµ·æ¥"></a>é€’å½’å°†keyå’Œpayloadå¯¹åº”èµ·æ¥</h3><p>åˆ°è¿™ä¸€æ­¥ä»£ç å°±æ˜¾å¾—éå¸¸å‡Œä¹±äº†ğŸ˜‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰é”®ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> KeyType = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨æ–­å‡ºå‚æ•°ç±»å‹ è¿”å›å…ƒç¥–</span></span><br><span class="line"><span class="keyword">type</span> ParamsType&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (...args: infer R) =&gt; <span class="built_in">any</span> ? R : <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å¯¹è±¡å€¼</span></span><br><span class="line"><span class="keyword">type</span> GetValue&lt;T&gt; = T[keyof T];</span><br><span class="line"></span><br><span class="line"><span class="comment">// è”åˆç±»å‹è½¬äº¤å‰ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> UnionToIntersection&lt;U&gt; = </span><br><span class="line">  (U <span class="keyword">extends</span> <span class="built_in">any</span> ? <span class="function">(<span class="params">k: U</span>) =&gt;</span> <span class="built_in">void</span> : never) <span class="keyword">extends</span> (<span class="function">(<span class="params">k: infer I</span>) =&gt;</span> <span class="built_in">void</span>) ? I : never</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AddPrefix&lt;Prefix <span class="keyword">extends</span> KeyType, Keys <span class="keyword">extends</span> KeyType&gt; = <span class="string">`<span class="subst">$&#123;Prefix&#125;</span>/<span class="subst">$&#123;Keys&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// åˆ¤æ–­æ˜¯å¦æ·»åŠ /</span></span><br><span class="line"><span class="keyword">type</span> AddSlashe&lt;T&gt; = T <span class="keyword">extends</span> <span class="string">""</span> ? T : <span class="string">`<span class="subst">$&#123;T &amp; <span class="built_in">string</span>&#125;</span>/`</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// æ”¯æŒè”åˆç±»å‹çš„å­—ç¬¦ä¸²æ¨¡æ¿æ‹¼æ¥ support string splicing of union type </span></span><br><span class="line"><span class="keyword">type</span> AddPrefixKeys&lt;P, S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = GetValue&lt;&#123;</span><br><span class="line">  [K <span class="keyword">in</span> S]: P <span class="keyword">extends</span> <span class="string">""</span> ? K : AddPrefix&lt;P &amp; <span class="built_in">string</span>, K&gt;;</span><br><span class="line">&#125;&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—Storeçš„ç±»å‹ï¼Œç”¨äºç»§æ‰¿åˆ¤æ–­ type of modules's store</span></span><br><span class="line"><span class="keyword">type</span> ModuleStoreOptions = &#123; </span><br><span class="line">  [k: <span class="built_in">string</span>]: &#123; </span><br><span class="line">    mutations: &#123; [x: <span class="built_in">string</span>]: <span class="function">(<span class="params">...args: <span class="built_in">any</span>[]</span>)=&gt;</span> <span class="built_in">any</span> &#125;; </span><br><span class="line">    state: <span class="built_in">any</span>; </span><br><span class="line">    actions?: &#123; [x: <span class="built_in">string</span>]: <span class="function">(<span class="params">...args: <span class="built_in">any</span>[]</span>)=&gt;</span> <span class="built_in">any</span> &#125;; </span><br><span class="line">    modules?: ModuleStoreOptions </span><br><span class="line">  &#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–mutationæˆ–actionå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ get second param type of function which named K</span></span><br><span class="line"><span class="keyword">type</span> GetSecondParamType&lt;M, MK <span class="keyword">extends</span> <span class="built_in">string</span>, K <span class="keyword">extends</span> <span class="built_in">string</span>, KEY = <span class="string">"mutations"</span>, E = never&gt; = M <span class="keyword">extends</span> &#123; </span><br><span class="line">  [X <span class="keyword">in</span> MK]: &#123; </span><br><span class="line">    [X1 <span class="keyword">in</span> KEY &amp; <span class="built_in">string</span>]: &#123; </span><br><span class="line">      [X2 <span class="keyword">in</span> K]: <span class="function">(<span class="params">s: <span class="built_in">any</span>, v: infer N</span>)=&gt;</span> <span class="built_in">any</span> </span><br><span class="line">    &#125; </span><br><span class="line">  &#125; </span><br><span class="line">&#125; ? N | E : never;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GetModuleMutationKeyParamMap&lt;M <span class="keyword">extends</span> ModuleStoreOptions, P = <span class="string">""</span>&gt; = UnionToIntersection&lt;GetValue&lt;&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œæ‹¿åˆ°ä¼ å…¥çš„æ¨¡å—Mçš„key å¦‚modOne</span></span><br><span class="line">  [R <span class="keyword">in</span> keyof M]:</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å†…éƒ¨æ˜¯å¦è¿˜æœ‰modulesï¼Œå¦‚modOne: &#123; modules: ... &#125;</span></span><br><span class="line">    M[R] <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">    <span class="comment">// æ³¨æ„æˆ‘ä»¬éœ€è¦çš„åªæ˜¯å€¼ï¼Œè€Œä¸æ˜¯å¯¹è±¡ï¼Œå› æ­¤è¿™é‡Œéƒ½æ˜¯æ‹¿GetValueç±»å‹åŒ…ç€çš„ã€‚</span></span><br><span class="line">    GetValue&lt;&#123;</span><br><span class="line">      <span class="comment">// éå†M modulesä¸‹Rçš„mutations</span></span><br><span class="line">      [K <span class="keyword">in</span> keyof M[R][<span class="string">"mutations"</span>]]: &#123; </span><br><span class="line">        <span class="comment">// æœ€å è¿™é‡Œæ‰æ˜¯éå†keyï¼Œå¹¶å¯¹åº”payloadç±»å‹çš„åœ°æ–¹ï¼Œè¿™ä¹Ÿæ˜¯æœ€åè¾“å‡ºçš„ç»“æœ</span></span><br><span class="line">        [K1 <span class="keyword">in</span> AddPrefixKeys&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;P&gt;&#125;</span><span class="subst">$&#123;R &amp; <span class="built_in">string</span>&#125;</span>`</span>, K &amp; <span class="built_in">string</span>&gt;]: GetSecondParamType&lt;M, R &amp; <span class="built_in">string</span>, K &amp; <span class="built_in">string</span>&gt;</span><br><span class="line">      &#125; </span><br><span class="line">    &#125;&gt; &amp; GetMutationKeyParamMap&lt;M[R][<span class="string">"modules"</span>], P <span class="keyword">extends</span> <span class="string">""</span> ? R : AddPrefix&lt;P &amp; <span class="built_in">string</span>, R &amp; <span class="built_in">string</span>&gt;&gt; : </span><br><span class="line">    GetValue&lt;&#123;</span><br><span class="line">      [K <span class="keyword">in</span> keyof M[R][<span class="string">"mutations"</span>]]: &#123;</span><br><span class="line">        [K1 <span class="keyword">in</span> AddPrefix&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;P&gt;&#125;</span><span class="subst">$&#123;R &amp; <span class="built_in">string</span>&#125;</span>`</span>, K &amp; <span class="built_in">string</span>&gt;]: GetSecondParamType&lt;M, R &amp; <span class="built_in">string</span>, K &amp; <span class="built_in">string</span>&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;&gt;</span><br><span class="line">&#125;&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯æŒç›´æ¥ä¼ å…¥æ•´ä¸ªvuex storeæ ‘ è§£æå‡ºmutationçš„keyä¸å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> GetMutationKeyParamMap&lt;M <span class="keyword">extends</span> (ModuleStoreOptions | GetValue&lt;ModuleStoreOptions&gt;), P = <span class="string">""</span>&gt; = </span><br><span class="line">    M <span class="keyword">extends</span> ModuleStoreOptions ? </span><br><span class="line">    GetModuleMutationKeyParamMap&lt;M, P&gt; : </span><br><span class="line">    M <span class="keyword">extends</span> GetValue&lt;ModuleStoreOptions&gt; ? </span><br><span class="line">    (</span><br><span class="line"><span class="comment">// å¯¹äºémodulesçš„ç¬¬ä¸€å±‚ï¼Œç›´æ¥æ¨å‡ºç±»å‹å°±è¡Œäº†</span></span><br><span class="line">      &#123; [K <span class="keyword">in</span> keyof M[<span class="string">"mutations"</span>]]: ParamsType&lt;M[<span class="string">"mutations"</span>][K &amp; <span class="built_in">string</span>]&gt;[<span class="number">1</span>] &#125; &amp;</span><br><span class="line">      (</span><br><span class="line">        M <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">        GetModuleMutationKeyParamMap&lt;M[<span class="string">"modules"</span>]&gt; : </span><br><span class="line">        &#123;&#125;</span><br><span class="line">      )</span><br><span class="line">    ) : never;</span><br></pre></td></tr></table></figure><p>ä»ä¸Šå¾€ä¸‹çœ‹ï¼Œå¤šäº†ä¸‰ä¸ªä¸œè¥¿ï¼š<code>GetValue</code>å’Œ<code>AddPrefixKeys</code>ä»¥åŠ<code>UnionToIntersection</code>ï¼Œå‰ä¸¤è€…å¾ˆå¥½ç†è§£ï¼Œå‰è€…æ˜¯è·å–å¯¹è±¡å€¼çš„ï¼Œåè€…æ˜¯æ‰©å±•äº†æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥ç±»å‹<code>AddPrefix</code>ï¼Œå¯ä»¥æ¥æ”¶è”åˆç±»å‹æ‹¼æ¥ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> AddPrefixKeys&lt;P, S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = GetValue&lt;&#123;</span><br><span class="line">  [K <span class="keyword">in</span> S]: P <span class="keyword">extends</span> <span class="string">""</span> ? K : AddPrefix&lt;P &amp; <span class="built_in">string</span>, K&gt;;</span><br><span class="line">&#125;&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Test = AddPrefixKeys&lt;<span class="string">"vwt"</span>, <span class="string">"1"</span> | <span class="string">"2"</span> | <span class="string">"3"</span>&gt;; <span class="comment">// "vwt/1 | vwt/2 | vwt/3"</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ä¸ª<code>UnionToIntersection</code>ï¼Œå…¶å®æ˜¯ç”¨æ¥æŠŠè”åˆç±»å‹è½¬ä¸ºäº¤å‰ç±»å‹çš„ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> A = &#123; name: <span class="built_in">string</span> &#125; | &#123; age: <span class="built_in">number</span> &#125;;</span><br><span class="line"><span class="keyword">type</span> Intersection = UnionToIntersection&lt;A&gt;; <span class="comment">// &#123; name: string; age: number &#125;</span></span><br></pre></td></tr></table></figure><p><strong>æ¨æ–­keyå’Œparamå¯¹åº”çš„è¿‡ç¨‹ä¸ä»…è¦æ¨å‡ºä»–ä»¬çš„ç±»å‹ï¼Œè¿˜è¦è®©ç»“æ„æ‰å¹³åŒ–</strong>ã€‚</p><h4 id="GetModuleMutationKeyParamMapç±»å‹"><a href="#GetModuleMutationKeyParamMapç±»å‹" class="headerlink" title="GetModuleMutationKeyParamMapç±»å‹"></a>GetModuleMutationKeyParamMapç±»å‹</h4><p>è¿™ä¸ªç±»å‹ç”¨äºæ¨æ–­moduleså†…çš„mutationç±»å‹ï¼Œæ¨æ–­ç»“æœä¼šæ˜¯è¿™æ ·ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  SET_NAME: <span class="built_in">string</span>;</span><br><span class="line">  modOne/SET_STATE: Partial&lt;<span class="keyword">typeof</span> modOneState&gt;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åšäº†ä¸‰ä¸ªå·¥ä½œï¼š</p><ul><li>ä½¿ç”¨é€’å½’ä¸äº¤å‰ç±»å‹æŠŠåµŒå¥—modulesä¸­åŸæœ¬æ ‘å½¢ç»“æ„çš„mutationæ‰å¹³åŒ–ï¼ˆUnionToIntersectionï¼‰</li><li>åˆ©ç”¨å¤šå±‚å¯¹è±¡éå†(å°±æ˜¯é‚£å †xxx in keyof)ä¿è¯<code>GetSecondParamType</code>æ‹¿åˆ°çš„mutationså‡½æ•°çš„KEYä¸æ˜¯è”åˆç±»å‹</li><li>åŒæ ·æ˜¯åˆ©ç”¨é€’å½’ï¼ŒæŠŠä¸Šä¸€è½®çš„åµŒå¥—ç»“æœPä¼ å…¥ä¸‹ä¸€è½®ï¼Œå®ç°mod/modOne/modOneSonè¿™æ ·çš„æ•ˆæœ</li></ul><h4 id="GetMutationKeyParamMapç±»å‹"><a href="#GetMutationKeyParamMapç±»å‹" class="headerlink" title="GetMutationKeyParamMapç±»å‹"></a>GetMutationKeyParamMapç±»å‹</h4><p>è¿™ä¸ªç±»å‹å°±æ²¡é‚£ä¹ˆå¤æ‚äº†ï¼Œå°±æ˜¯åˆ¤æ–­ç”¨æˆ·ä¼ å…¥çš„ç±»å‹æ˜¯æ•´ä¸ªVuex storeè¿˜æ˜¯åªç©¿äº†modulesçš„ç±»å‹ï¼Œä½œä¸ºä¸€ä¸ªå…¼å®¹ä¸¤è€…çš„ç±»å‹æš´éœ²å‡ºå»ã€‚</p><p>actionsçš„è·å–è¿‡ç¨‹å’Œmutationsçš„åŸºæœ¬å°±æ˜¯ä¸€æ ·çš„ï¼Œå°±å˜äº†ä¸ªkeyçš„åå­—ï¼Œå°±ä¸å•ç‹¬å†™å‡ºæ¥äº†</p><h1 id="è§£å†³æœ€åä¸€ä¸ªéº»çƒ¦"><a href="#è§£å†³æœ€åä¸€ä¸ªéº»çƒ¦" class="headerlink" title="è§£å†³æœ€åä¸€ä¸ªéº»çƒ¦"></a>è§£å†³æœ€åä¸€ä¸ªéº»çƒ¦</h1><p>åˆ°è¿™é‡Œå…¶å®è¿˜æœ‰ä¸ªæœ€é‡è¦çš„é—®é¢˜è¿˜æ²¡æœ‰è§£å†³ï¼Œé‚£å°±æ˜¯å£°æ˜åˆå¹¶çš„é—®é¢˜ï¼Œåœ¨vuexçš„å®˜æ–¹å£°æ˜æ–‡ä»¶<code>vue.d.ts</code>ä¸­ï¼Œæœ‰è¿™ä¹ˆå‡ è¡Œä»£ç ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> "vue/types/vue" &#123;</span><br><span class="line">  <span class="keyword">interface</span> Vue &#123;</span><br><span class="line">    $store: Store&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vuexå®˜æ–¹å£°æ˜äº†$storeå¯¹è±¡ï¼Œä½†ç»™äº†ä¸ªanyç±»å‹ï¼Œè¿™ä¹Ÿå¯¼è‡´åç»­å£°æ˜åˆå¹¶éƒ½æ— æ•ˆï¼Œæœ€å¤šä¹Ÿå°±åˆå¹¶ä¸‹Commitè¿™äº›ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥ç”¨nodeç¨‹åºæŠŠè¿™ä¸ªä»£ç åˆ æ‰äº†hhhã€‚</p><p>ä¹‹ååˆ›å»ºä¸€ä¸ªå£°æ˜æ–‡ä»¶ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; CommitOptions, DispatchOptions, Payload, Store &#125; <span class="keyword">from</span> <span class="string">"vuex"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TAction, TMutation, TState &#125; <span class="keyword">from</span> <span class="string">"@/store"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TupleTypeToUnions&lt;T, K = <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> <span class="built_in">Array</span>&lt;K&gt; ? T[<span class="built_in">number</span>] : T</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»é™¤æŒ‡å®škeyï¼Œå¯æ¥å—å…ƒç¥–</span></span><br><span class="line"><span class="keyword">type</span> ExcludeKey&lt;T, U&gt; = T <span class="keyword">extends</span> (U <span class="keyword">extends</span> <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; ? TupleTypeToUnions&lt;U&gt; : U) ? never : T;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç§»é™¤stateä¸commitã€dispatch æ–¹ä¾¿åç»­é‡å†™ </span></span><br><span class="line"><span class="keyword">type</span> CutStore = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> ExcludeKey&lt;keyof Store&lt;<span class="built_in">any</span>&gt;, [<span class="string">"state"</span>, <span class="string">"commit"</span>, <span class="string">"dispatch"</span>]&gt;]: Store&lt;<span class="built_in">any</span>&gt;[K];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> "vue/types/vue" &#123;</span><br><span class="line">  <span class="keyword">interface</span> Vue &#123;</span><br><span class="line">    $store: CutStore &amp; &#123;</span><br><span class="line">      commit: &#123;</span><br><span class="line">        &lt;R <span class="keyword">extends</span> keyof TMutation&gt;(</span><br><span class="line">          <span class="keyword">type</span>: R,</span><br><span class="line">          payload?: TMutation[R],</span><br><span class="line">          options?: CommitOptions</span><br><span class="line">        ): <span class="built_in">void</span>;</span><br><span class="line">        &lt;P <span class="keyword">extends</span> Payload&gt;(payloadWithType: P, options?: CommitOptions): <span class="built_in">void</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; &amp; &#123;</span><br><span class="line">      dispatch: &#123;</span><br><span class="line">        &lt;R <span class="keyword">extends</span> keyof TAction&gt;(</span><br><span class="line">          <span class="keyword">type</span>: R,</span><br><span class="line">          payload?: TAction[R],</span><br><span class="line">          options?: DispatchOptions</span><br><span class="line">        ): <span class="built_in">void</span>;</span><br><span class="line">        &lt;P <span class="keyword">extends</span> Payload&gt;(payloadWithType: P, options?: DispatchOptions): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; &amp; &#123;</span><br><span class="line">      state: TState;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> "vuex/types/index" &#123;</span><br><span class="line">  <span class="keyword">interface</span> Commit &#123;</span><br><span class="line">    &lt;K <span class="keyword">extends</span> keyof TMutation&gt;(</span><br><span class="line">      <span class="keyword">type</span>: K,</span><br><span class="line">      payload?: TMutation[K],</span><br><span class="line">      options?: CommitOptions</span><br><span class="line">    ): <span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">interface</span> Dispatch &#123;</span><br><span class="line">    &lt;K <span class="keyword">extends</span> keyof TAction&gt;(</span><br><span class="line">      <span class="keyword">type</span>: K,</span><br><span class="line">      payload?: TAction[K],</span><br><span class="line">      options?: DispatchOptions</span><br><span class="line">    ): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ç®—æ˜¯å®Œå·¥äº†ã€‚</p><h1 id="å·¥å…·å®Œæ•´ä»£ç "><a href="#å·¥å…·å®Œæ•´ä»£ç " class="headerlink" title="å·¥å…·å®Œæ•´ä»£ç "></a>å·¥å…·å®Œæ•´ä»£ç </h1><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> UnionToIntersection&lt;U&gt; = </span><br><span class="line">  (U <span class="keyword">extends</span> <span class="built_in">any</span> ? <span class="function">(<span class="params">k: U</span>) =&gt;</span> <span class="built_in">void</span> : never) <span class="keyword">extends</span> (<span class="function">(<span class="params">k: infer I</span>) =&gt;</span> <span class="built_in">void</span>) ? I : never</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨æ–­å‡ºå‡½æ•°çš„å‚æ•°ç±»å‹ infer param type of function</span></span><br><span class="line"><span class="keyword">type</span> ParamsType&lt;T <span class="keyword">extends</span> (...args: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (...args: infer R) =&gt; <span class="built_in">any</span> ? R : <span class="built_in">any</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * neveræ˜¯ä¸€ä¸ªç‰¹æ®Šç±»å‹ï¼Œæ¯”å¦‚ä½ è®© any extends never ? 1 : 2ï¼Œè¿™ä¸ªç»“æœä¼šæ˜¯1 | 2ï¼Œå¦å¤–ï¼Œnever extends never[]æ˜¯true</span></span><br><span class="line"><span class="comment"> * è§£å†³è¿™äº›ç‰¹æ®Šæƒ…å†µå¯ä»¥æŠŠå®ƒè½¬ä¸ºå…ƒç¥–ç±»å‹åè¿›è¡Œå¯¹æ¯” </span></span><br><span class="line"><span class="comment"> * to prevent T being distributive, wrap it with []</span></span><br><span class="line"><span class="comment"> * ref. https://github.com/microsoft/TypeScript/issues/23182</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> DealNeverType&lt;T&gt; = [T] <span class="keyword">extends</span> [never] ? <span class="built_in">any</span> : ([T] <span class="keyword">extends</span> [never[]] ? <span class="built_in">any</span>[] : T);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * state =  &#123;</span></span><br><span class="line"><span class="comment"> *    arr: []</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> * è¿™ç§ä¼šè¢«æ¨æ–­ä¸ºnever[]</span></span><br><span class="line"><span class="comment"> * this one will be infered to never[]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> NonNeverState&lt;R <span class="keyword">extends</span> object&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof R]: R[K] <span class="keyword">extends</span> (<span class="built_in">any</span>[] | never) ? </span><br><span class="line">  DealNeverType&lt;R[K]&gt; : (R[K] <span class="keyword">extends</span> object ? </span><br><span class="line">  NonNeverState&lt;R[K]&gt; : DealNeverType&lt;R[K]&gt;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰é”®ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> KeyType = <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å€¼ get value of an object</span></span><br><span class="line"><span class="keyword">type</span> GetValue&lt;T&gt; = T[keyof T];</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> AddPrefix&lt;Prefix <span class="keyword">extends</span> KeyType, Keys <span class="keyword">extends</span> KeyType&gt; = <span class="string">`<span class="subst">$&#123;Prefix&#125;</span>/<span class="subst">$&#123;Keys&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// åˆ¤æ–­æ˜¯å¦æ·»åŠ /</span></span><br><span class="line"><span class="keyword">type</span> AddSlashe&lt;T&gt; = T <span class="keyword">extends</span> <span class="string">""</span> ? T : <span class="string">`<span class="subst">$&#123;T &amp; <span class="built_in">string</span>&#125;</span>/`</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// æ”¯æŒè”åˆç±»å‹çš„å­—ç¬¦ä¸²æ¨¡æ¿æ‹¼æ¥ support string splicing of union type </span></span><br><span class="line"><span class="keyword">type</span> AddPrefixKeys&lt;P, S <span class="keyword">extends</span> <span class="built_in">string</span>&gt; = GetValue&lt;&#123;</span><br><span class="line">  [K <span class="keyword">in</span> S]: P <span class="keyword">extends</span> <span class="string">""</span> ? K : AddPrefix&lt;P &amp; <span class="built_in">string</span>, K&gt;;</span><br><span class="line">&#125;&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—Storeçš„ç±»å‹ï¼Œç”¨äºç»§æ‰¿åˆ¤æ–­ type of modules's store</span></span><br><span class="line"><span class="keyword">type</span> ModuleStoreOptions = &#123; </span><br><span class="line">  [k: <span class="built_in">string</span>]: &#123; </span><br><span class="line">    mutations: &#123; [x: <span class="built_in">string</span>]: <span class="function">(<span class="params">...args: <span class="built_in">any</span>[]</span>)=&gt;</span> <span class="built_in">any</span> &#125;; </span><br><span class="line">    state: <span class="built_in">any</span>; </span><br><span class="line">    actions?: &#123; [x: <span class="built_in">string</span>]: <span class="function">(<span class="params">...args: <span class="built_in">any</span>[]</span>)=&gt;</span> <span class="built_in">any</span> &#125;; </span><br><span class="line">    modules?: ModuleStoreOptions </span><br><span class="line">  &#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–mutationæˆ–actionå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹ get second param type of function which named K</span></span><br><span class="line"><span class="keyword">type</span> GetSecondParamType&lt;M, MK <span class="keyword">extends</span> <span class="built_in">string</span>, K <span class="keyword">extends</span> <span class="built_in">string</span>, KEY = <span class="string">"mutations"</span>, E = never&gt; = M <span class="keyword">extends</span> &#123; </span><br><span class="line">  [X <span class="keyword">in</span> MK]: &#123; </span><br><span class="line">    [X1 <span class="keyword">in</span> KEY &amp; <span class="built_in">string</span>]: &#123; </span><br><span class="line">      [X2 <span class="keyword">in</span> K]: <span class="function">(<span class="params">s: <span class="built_in">any</span>, v: infer N</span>)=&gt;</span> <span class="built_in">any</span> </span><br><span class="line">    &#125; </span><br><span class="line">  &#125; </span><br><span class="line">&#125; ? N | E : never;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–modulesä¸­çš„mutation keyä¸ç¬¬äºŒä¸ªå‚æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> GetModuleMutationKeyParamMap&lt;M <span class="keyword">extends</span> ModuleStoreOptions, P = <span class="string">""</span>&gt; = UnionToIntersection&lt;GetValue&lt;&#123;</span><br><span class="line">  [R <span class="keyword">in</span> keyof M]: </span><br><span class="line">    M[R] <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">    GetValue&lt;&#123; </span><br><span class="line">      [K <span class="keyword">in</span> keyof M[R][<span class="string">"mutations"</span>]]: &#123;</span><br><span class="line">        [K1 <span class="keyword">in</span> AddPrefixKeys&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;P&gt;&#125;</span><span class="subst">$&#123;R &amp; <span class="built_in">string</span>&#125;</span>`</span>, K &amp; <span class="built_in">string</span>&gt;]: GetSecondParamType&lt;M, R &amp; <span class="built_in">string</span>, K &amp; <span class="built_in">string</span>&gt;</span><br><span class="line">      &#125; </span><br><span class="line">    &#125;&gt; &amp; GetMutationKeyParamMap&lt;M[R][<span class="string">"modules"</span>], P <span class="keyword">extends</span> <span class="string">""</span> ? R : AddPrefix&lt;P &amp; <span class="built_in">string</span>, R &amp; <span class="built_in">string</span>&gt;&gt; : </span><br><span class="line">    GetValue&lt;&#123;</span><br><span class="line">      [K <span class="keyword">in</span> keyof M[R][<span class="string">"mutations"</span>]]: &#123;</span><br><span class="line">        [K1 <span class="keyword">in</span> AddPrefix&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;P&gt;&#125;</span><span class="subst">$&#123;R &amp; <span class="built_in">string</span>&#125;</span>`</span>, K &amp; <span class="built_in">string</span>&gt;]: GetSecondParamType&lt;M, R &amp; <span class="built_in">string</span>, K &amp; <span class="built_in">string</span>&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;&gt;</span><br><span class="line">&#125;&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯æŒç›´æ¥ä¼ å…¥æ•´ä¸ªvuex storeæ ‘ è§£æå‡ºmutationçš„keyä¸å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> GetMutationKeyParamMap&lt;M <span class="keyword">extends</span> (ModuleStoreOptions | GetValue&lt;ModuleStoreOptions&gt;), P = <span class="string">""</span>&gt; = </span><br><span class="line">    M <span class="keyword">extends</span> ModuleStoreOptions ? </span><br><span class="line">    GetModuleMutationKeyParamMap&lt;M, P&gt; : </span><br><span class="line">    M <span class="keyword">extends</span> GetValue&lt;ModuleStoreOptions&gt; ? </span><br><span class="line">    (</span><br><span class="line">      &#123; [K <span class="keyword">in</span> keyof M[<span class="string">"mutations"</span>]]: ParamsType&lt;M[<span class="string">"mutations"</span>][K &amp; <span class="built_in">string</span>]&gt;[<span class="number">1</span>] &#125; &amp;</span><br><span class="line">      (</span><br><span class="line">        M <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">        GetModuleMutationKeyParamMap&lt;M[<span class="string">"modules"</span>]&gt; : </span><br><span class="line">        &#123;&#125;</span><br><span class="line">      )</span><br><span class="line">    ) : never;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ¨¡å—ä¸‹çš„actionçš„keyä¸å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°map</span></span><br><span class="line"><span class="keyword">type</span> GetModuleActionKeyParamMap&lt;M <span class="keyword">extends</span> ModuleStoreOptions, P = <span class="string">""</span>&gt; = UnionToIntersection&lt;GetValue&lt;&#123;</span><br><span class="line">  [R <span class="keyword">in</span> keyof M]: </span><br><span class="line">    M[R] <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">    GetValue&lt;&#123; </span><br><span class="line">      [K <span class="keyword">in</span> keyof M[R][<span class="string">"actions"</span>]]: &#123;</span><br><span class="line">        [K1 <span class="keyword">in</span> AddPrefixKeys&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;P&gt;&#125;</span><span class="subst">$&#123;R &amp; <span class="built_in">string</span>&#125;</span>`</span>, K &amp; <span class="built_in">string</span>&gt;]: GetSecondParamType&lt;M, R &amp; <span class="built_in">string</span>, K &amp; <span class="built_in">string</span>, <span class="string">"actions"</span>&gt;</span><br><span class="line">      &#125; </span><br><span class="line">    &#125;&gt; &amp; GetActionKeyParamMap&lt;M[R][<span class="string">"modules"</span>], P <span class="keyword">extends</span> <span class="string">""</span> ? R : AddPrefix&lt;P &amp; <span class="built_in">string</span>, R &amp; <span class="built_in">string</span>&gt;&gt; : </span><br><span class="line">    GetValue&lt;&#123;</span><br><span class="line">      [K <span class="keyword">in</span> keyof M[R][<span class="string">"actions"</span>]]: &#123;</span><br><span class="line">        [K1 <span class="keyword">in</span> AddPrefix&lt;<span class="string">`<span class="subst">$&#123;AddSlashe&lt;P&gt;&#125;</span><span class="subst">$&#123;R &amp; <span class="built_in">string</span>&#125;</span>`</span>, K &amp; <span class="built_in">string</span>&gt;]: GetSecondParamType&lt;M, R &amp; <span class="built_in">string</span>, K &amp; <span class="built_in">string</span>, <span class="string">"actions"</span>&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;&gt;</span><br><span class="line">&#125;&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ”¯æŒç›´æ¥ä¼ å…¥æ•´ä¸ªvuex storeæ ‘ è§£æå‡ºactionçš„keyä¸å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> GetActionKeyParamMap&lt;M <span class="keyword">extends</span> (ModuleStoreOptions | GetValue&lt;ModuleStoreOptions&gt;), P = <span class="string">""</span>&gt; = </span><br><span class="line">    M <span class="keyword">extends</span> ModuleStoreOptions ? </span><br><span class="line">    GetModuleActionKeyParamMap&lt;M, P&gt; : </span><br><span class="line">    M <span class="keyword">extends</span> Required&lt;GetValue&lt;ModuleStoreOptions&gt;&gt; ? </span><br><span class="line">    (</span><br><span class="line">      &#123; [K <span class="keyword">in</span> keyof M[<span class="string">"actions"</span>]]: ParamsType&lt;M[<span class="string">"actions"</span>][K &amp; <span class="built_in">string</span>]&gt;[<span class="number">1</span>] &#125; &amp;</span><br><span class="line">      (</span><br><span class="line">        M <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">        GetModuleActionKeyParamMap&lt;M[<span class="string">"modules"</span>]&gt; : </span><br><span class="line">        &#123;&#125;</span><br><span class="line">      )</span><br><span class="line">    ) : never;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡å—stateçš„ç±»å‹ ä¼šé€’å½’æ‹¿åˆ°åµŒå¥—æ¨¡å—çš„stateç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> GetSubState&lt;M <span class="keyword">extends</span> ModuleStoreOptions&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof M]?: M[K] <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">    M[K][<span class="string">"state"</span>] &amp; GetSubState&lt;M[K][<span class="string">"modules"</span>]&gt; : </span><br><span class="line">    M[K][<span class="string">"state"</span>]</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ ¹æ®ä¼ å…¥çš„vuex store è·å–state</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> GetState&lt;M <span class="keyword">extends</span> (ModuleStoreOptions | GetValue&lt;ModuleStoreOptions&gt;)&gt; = M <span class="keyword">extends</span> ModuleStoreOptions ? </span><br><span class="line">  GetSubState&lt;M&gt; : (</span><br><span class="line">    &#123; [K <span class="keyword">in</span> keyof M[<span class="string">"state"</span>]]: M[<span class="string">"state"</span>][K] &#125; &amp; (</span><br><span class="line">    M <span class="keyword">extends</span> &#123; modules: ModuleStoreOptions &#125; ? </span><br><span class="line">    GetState&lt;M[<span class="string">"modules"</span>]&gt; : </span><br><span class="line">    &#123;&#125;</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ä¸ªæ–‡ç« ä¹Ÿæ˜¯æ–­æ–­ç»­ç»­å†™çš„ï¼Œå†™å®Œæ„Ÿè§‰ä¹±ä¸ƒå…«ç³Ÿã€‚ä»¥ä¸Šæ˜¯å¤§æ¦‚å®ç°ï¼Œå®é™…ä¸Šè¿˜æœ‰å‘æ²¡å¡«ï¼Œæ¯”å¦‚namespacedè®¾ç½®ä¸ºfalseçš„æ²¡æœ‰å•ç‹¬å¤„ç†ï¼Œåˆæ¯”å¦‚commitä¸dispatchåªæ”¯æŒäº†ä¸€ç§å†™æ³•ï¼Œå†æ¯”å¦‚è¦é€šè¿‡åˆ é™¤åº“æºç çš„ä¸€éƒ¨åˆ†æ‰èƒ½å®ç°ï¼ˆä¸è¿‡å¥½åœ¨tsåªæ˜¯å…ƒç¼–ç¨‹åŸºæœ¬ä¸æ¶‰åŠæ•°æ®é€»è¾‘ï¼‰ï¼Œå¦å¤–æ„Ÿè§‰å†™å¾—è¿‡äºå¤æ‚äº†ã€‚æœ€åçš„æœ€åï¼Œè¿™æ•´å¥—æˆ‘æœ‰æ•´åˆå‘å¸ƒåˆ°npmä¸Šï¼Œä½¿ç”¨<code>npm i vuex-with-type</code>å®‰è£…ï¼Œ<code>npx vwt init</code>ä½¿ç”¨ã€‚æ˜é‡‘å†™æ–‡ç« ï¼Œå‘npmåŒ…éƒ½æ˜¯ç¬¬ä¸€æ¬¡ï¼Œå¦‚æœæœ¬æ–‡æœ‰äººçœ‹ï¼Œå¸Œæœ›èƒ½ç•™ä¸‹è¯„è®ºæ‰¹è¯„æŒ‡ç‚¹ä¸€ä¸‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;å’ŒVuexè€—ä¸Šäº†&quot;&gt;&lt;a href=&quot;#å’ŒVuexè€—ä¸Šäº†&quot; class=&quot;headerlink&quot; title=&quot;å’ŒVuexè€—ä¸Šäº†&quot;&gt;&lt;/a&gt;å’ŒVuexè€—ä¸Šäº†&lt;/h1&gt;&lt;p&gt;ä¸Šä¸€æ¬¡æˆ‘ä¹Ÿå¯¹Vuexè¿›è¡Œäº†æ¨æ–­ï¼Œä½†ç»“æœå¾ˆéš¾è®©äººæ»¡æ„: &lt;a href=&quot;http://zyy
      
    
    </summary>
    
    
      <category term="è®°å½•" scheme="http://localhost:4000/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="typescript" scheme="http://localhost:4000/tags/typescript/"/>
    
      <category term="vuex" scheme="http://localhost:4000/tags/vuex/"/>
    
      <category term="å¼€æº" scheme="http://localhost:4000/tags/%E5%BC%80%E6%BA%90/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡Vuexä¸­commitç±»å‹æ ¡éªŒçš„è¿‡ç¨‹</title>
    <link href="http://localhost:4000/2021/06/02/%E8%AE%B0%E4%B8%80%E6%AC%A1Vuex%E4%B8%ADcommit%E7%B1%BB%E5%9E%8B%E6%A0%A1%E9%AA%8C%E7%9A%84%E8%BF%87%E7%A8%8B/"/>
    <id>http://localhost:4000/2021/06/02/%E8%AE%B0%E4%B8%80%E6%AC%A1Vuex%E4%B8%ADcommit%E7%B1%BB%E5%9E%8B%E6%A0%A1%E9%AA%8C%E7%9A%84%E8%BF%87%E7%A8%8B/</id>
    <published>2021-06-02T09:29:07.000Z</published>
    <updated>2021-06-15T02:14:53.249Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æŠ€æœ¯æ ˆæ˜¯<code>vue2.x</code> +<code>typescript</code>+<code>nuxt</code>ï¼Œæ¥æ‰‹çš„é¡¹ç›®è™½è¯´ç”¨çš„tsï¼Œä¸è¿‡å¹¶æ²¡æœ‰å®Œæˆä¸€äº›å…³é”®çš„æ ¡éªŒã€‚æ¥æ‰‹åæˆ‘å…ˆæ”¹äº†ä¸€ä¸‹storeæ–‡ä»¶çš„æ ¡éªŒï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå·¥å…·ç±»å‹ç”¨æ¥å¤„ç†stateä¸­ç›´æ¥å†™[]è¿™æ ·æ•°æ®å¯¼è‡´çš„neverç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> DealNeverType&lt;T <span class="keyword">extends</span> object&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]: T[K] <span class="keyword">extends</span> never[]</span><br><span class="line">    ? <span class="built_in">any</span>[]</span><br><span class="line">    : T[K] <span class="keyword">extends</span> never</span><br><span class="line">    ? <span class="built_in">any</span></span><br><span class="line">    : T[K];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> TState = DealNeverType&lt;ReturnType&lt;<span class="keyword">typeof</span> state&gt;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  SET_STATE(state: TState, obj: Partial&lt;TState&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isOwnKey(key, obj)) &#123;</span><br><span class="line">        state[key] = obj[key];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> TMutations = keyof <span class="keyword">typeof</span> mutations;</span><br></pre></td></tr></table></figure><p>é¡¹ç›®æ­å»ºäººæ˜¯æƒ³çš„å°†<code>commit(key, value)</code>ç®€åŒ–ä¸€ç‚¹ï¼Œç»Ÿä¸€çš„ç”¨<code>commit(&quot;SET_STATE&quot;, { key: value })</code>æ¥æ”¹å€¼ï¼Œè¿™ä¸ªåˆ°æ²¡æœ‰é—®é¢˜ï¼Œå°±æ˜¯æ²¡æœ‰åšä»»ä½•ç±»å‹æ ¡éªŒã€‚<code>isOwnKey</code>å‡½æ•°çš„è¯æ˜¯è¿™æ ·ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å·¥å…·ï¼Œç±»å‹ä¿æŠ¤è§£å†³ç´¢å¼•ç±»å‹æŠ¥é”™é—®é¢˜</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isOwnKey</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  key: <span class="built_in">string</span> | <span class="built_in">number</span> | symbol,</span></span></span><br><span class="line"><span class="function"><span class="params">  object: object</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">key</span> <span class="title">is</span> <span class="title">keyof</span> <span class="title">typeof</span> <span class="title">object</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> key <span class="keyword">in</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éš¾ç‚¹"><a href="#éš¾ç‚¹" class="headerlink" title="éš¾ç‚¹"></a>éš¾ç‚¹</h2><p>åœ¨vuex4.xä¹‹å‰ä¸€ç›´éƒ½å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å®˜æ–¹declareäº†ä¸€ä¸ªå…¨å±€çš„å£°æ˜ï¼Œå®ƒå°†<code>$store</code>å£°æ˜åˆå¹¶åœ¨äº†<code>interface Vue</code>ä¸­ï¼Œè¿™æ— å¯åšéï¼Œä½†é—®é¢˜æ˜¯å®ƒçš„ç±»å‹æ˜¯<code>Store&lt;any&gt;</code>ï¼holy shit.</p><p>è¿™è®©åé¢çš„æ ¡éªŒå°±åƒä¾¿ç§˜ä¸€æ ·éš¾å—ï¼Œå°¤å…¶æ˜¯<code>state</code>çš„æ ¡éªŒï¼Œæš‚æ—¶è¿˜æ˜¯æ²¡æ‰¾åˆ°æ–¹æ³•ï¼Œä¸è¿‡è¿™æ¬¡å…ˆè¯´<code>commit</code>ï¼Œè¿™ä¸ªæš‚æ—¶è§£å†³äº†çš„ã€‚</p><h2 id="å°è¯•è¿‡çš„æ–¹æ¡ˆ"><a href="#å°è¯•è¿‡çš„æ–¹æ¡ˆ" class="headerlink" title="å°è¯•è¿‡çš„æ–¹æ¡ˆ"></a>å°è¯•è¿‡çš„æ–¹æ¡ˆ</h2><p>æˆ‘å¤§æ¦‚ä½¿ç”¨äº†3ä¸ªæ–¹æ³•ï¼š</p><h3 id="å£°æ˜åˆå¹¶Vueä¸­çš„-store"><a href="#å£°æ˜åˆå¹¶Vueä¸­çš„-store" class="headerlink" title="å£°æ˜åˆå¹¶Vueä¸­çš„$store"></a>å£°æ˜åˆå¹¶Vueä¸­çš„$store</h3><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ˆå»æ‰commitï¼Œé¿å…ä¸vuexåŸç”Ÿçš„Commitç±»å‹æ‰“æ¶æœ€åå˜æˆäº¤å‰ç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> NoCommitStore = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> Exclude&lt;keyof Store&lt;<span class="built_in">any</span>&gt;, <span class="string">"commit"</span>&gt;]: Store&lt;<span class="built_in">any</span>&gt;[K];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> "vue/types/vue" &#123;</span><br><span class="line">  <span class="keyword">interface</span> Vue &#123;</span><br><span class="line">    $store: NoCommitStore &amp; &#123;</span><br><span class="line">      commit: &#123;</span><br><span class="line">        (</span><br><span class="line">          <span class="keyword">type</span>: TMutations,</span><br><span class="line">          payload?: Partial&lt;TState&gt;,</span><br><span class="line">          options?: CommitOptions</span><br><span class="line">        ): <span class="built_in">void</span>;</span><br><span class="line">        &lt;P <span class="keyword">extends</span> Payload&gt;(payloadWithType: P, options?: CommitOptions): <span class="built_in">void</span>;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•å¾ˆå¿«å°±å®£å¸ƒç ´äº§äº†ï¼ŒIDEä¼šç»™å‡ºå¦‚ä¸‹çš„æç¤ºï¼š</p><p><img src="/BeCoderQ.github.io/2021/06/02/è®°ä¸€æ¬¡Vuexä¸­commitç±»å‹æ ¡éªŒçš„è¿‡ç¨‹/error.png" alt="å›¾"></p><h3 id="ä»…åˆå¹¶Vuexæš´éœ²çš„Commitç±»å‹"><a href="#ä»…åˆå¹¶Vuexæš´éœ²çš„Commitç±»å‹" class="headerlink" title="ä»…åˆå¹¶Vuexæš´éœ²çš„Commitç±»å‹"></a>ä»…åˆå¹¶Vuexæš´éœ²çš„Commitç±»å‹</h3><p>è¿™ä¸ªæ–¹æ³•è²Œä¼¼é è°±ç‚¹ï¼Œå…ˆçœ‹ä¸€ä¸‹Vuexå®˜æ–¹å£°æ˜æ–‡ä»¶ä¸­çš„<code>Commit</code>ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Commit &#123;</span><br><span class="line">  (<span class="keyword">type</span>: <span class="built_in">string</span>, payload?: <span class="built_in">any</span>, options?: CommitOptions): <span class="built_in">void</span>;</span><br><span class="line">  &lt;P <span class="keyword">extends</span> Payload&gt;(payloadWithType: P, options?: CommitOptions): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„çœ‹ç¬¬ä¸€ä¸ªå£°æ˜ï¼Œ<code>payload</code>ç±»å‹æ˜¯<code>any</code>ï¼Œè¿™å°±å¯¼è‡´æˆ‘åé¢ä¸ç®¡æ€ä¹ˆé‡è½½è¿™ä¸ªå‡½æ•°ï¼Œæœ€åç±»å‹æ°¸è¿œéƒ½æ˜¯<code>any</code>ã€‚é†‰äº†ã€‚åˆå®£å‘Šå¤±è´¥ã€‚</p><h3 id="åŠ ä¸ŠèŒƒå‹é‡è½½Commitç±»å‹"><a href="#åŠ ä¸ŠèŒƒå‹é‡è½½Commitç±»å‹" class="headerlink" title="åŠ ä¸ŠèŒƒå‹é‡è½½Commitç±»å‹"></a>åŠ ä¸ŠèŒƒå‹é‡è½½Commitç±»å‹</h3><p><code>any</code>ç±»å‹æŠŠæˆ‘ä»¬æ‹¦åœ¨é—¨å¤–ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ–°å®šä¹‰ä¸€ä¸ªé‡è½½ç±»å‹ï¼šåŠ ä¸ŠèŒƒå‹ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> "vuex/types/index" &#123;</span><br><span class="line">  <span class="keyword">interface</span> Commit &#123;</span><br><span class="line">    &lt;T <span class="keyword">extends</span> TMutations&gt;(</span><br><span class="line">      <span class="keyword">type</span>: T,</span><br><span class="line">      payload?: Partial&lt;TState&gt;,</span><br><span class="line">      options?: CommitOptions</span><br><span class="line">    ): <span class="built_in">void</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„æ—¶å€™éœ€è¦å¾€commitå‡½æ•°å†…ä¼ ä¸€ä¸ªèŒƒå‹ç±»å‹ï¼Œè¿™æ ·æ ¡éªŒä¾¿å®Œæˆäº†ï¼š</p><p><img src="/BeCoderQ.github.io/2021/06/02/è®°ä¸€æ¬¡Vuexä¸­commitç±»å‹æ ¡éªŒçš„è¿‡ç¨‹/type-1.png" alt="å›¾"></p><p>ç¬¬ä¸€ä¸ªtypeæ˜¯æ²¡é—®é¢˜çš„ï¼Œå†çœ‹çœ‹ç¬¬äºŒä¸ªå‚æ•°ï¼š</p><p><img src="/BeCoderQ.github.io/2021/06/02/è®°ä¸€æ¬¡Vuexä¸­commitç±»å‹æ ¡éªŒçš„è¿‡ç¨‹/type-2.png" alt="å›¾"></p><p>åŒæ ·æ²¡é—®é¢˜ï¼è™½ç„¶è¦å¸¦ä¸€ä¸ªèŒƒå‹æ‹–æ²¹ç“¶ï¼Œä¸è¿‡ä¹Ÿç®—æ˜¯åœ¨ä¸æ”¹å£°æ˜æºç çš„æƒ…å†µä¸‹å®Œæˆäº†ç±»å‹æ ¡éªŒã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å®é™…è¿˜æ˜¯é€šè¿‡å£°æ˜åˆå¹¶ï¼Œåˆ©ç”¨äº†<code>Commit</code>ç±»å‹å¯ä»¥é‡è½½ï¼Œæƒ³é‡å†™<code>$store</code>è‚¯å®šæ˜¯ä¸è¡Œäº†ï¼Œè¿™ä¹Ÿå¯¼è‡´<code>state</code>çš„æ ¡éªŒå‡ ä¹ä¸å¯èƒ½å®ç°ã€‚è™½ç„¶åœ¨Vuex4ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¹Ÿä¸èƒ½æŒ‡æœ›æ‰€æœ‰é¡¹ç›®éƒ½å»å‡çº§åˆ°4.xæ¥è§£å†³ç±»å‹æ ¡éªŒçš„é—®é¢˜å§ï¼Ÿç›®å‰çœ‹æ¥ï¼Œå‡ºäº†æ–­è¨€ä¼¼ä¹æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æŠ€æœ¯æ ˆæ˜¯&lt;code&gt;vue2.x&lt;/code&gt; +&lt;code&gt;typescript&lt;/code&gt;+&lt;code&gt;nuxt&lt;/code&gt;ï¼Œæ¥æ‰‹
      
    
    </summary>
    
    
      <category term="æ€»ç»“" scheme="http://localhost:4000/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="typescript" scheme="http://localhost:4000/tags/typescript/"/>
    
      <category term="vuex" scheme="http://localhost:4000/tags/vuex/"/>
    
  </entry>
  
  <entry>
    <title>Vue2.xä¸Vue3.xæ’ä»¶å¼å…¨å±€ç»„ä»¶å†™æ³•å¯¹åˆ«</title>
    <link href="http://localhost:4000/2021/05/25/Vue2-x%E4%B8%8EVue3-x%E6%8F%92%E4%BB%B6%E5%BC%8F%E5%85%A8%E5%B1%80%E7%BB%84%E4%BB%B6%E5%86%99%E6%B3%95%E5%AF%B9%E5%88%AB/"/>
    <id>http://localhost:4000/2021/05/25/Vue2-x%E4%B8%8EVue3-x%E6%8F%92%E4%BB%B6%E5%BC%8F%E5%85%A8%E5%B1%80%E7%BB%84%E4%BB%B6%E5%86%99%E6%B3%95%E5%AF%B9%E5%88%AB/</id>
    <published>2021-05-25T07:14:55.000Z</published>
    <updated>2021-05-27T06:18:29.439Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«"></a>ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«</h2><p>Vue2.xä¸­æˆ‘ä»¬ä½¿ç”¨<code>extend</code>æ–¹æ³•ä¼ å…¥ç»„ä»¶ç±»å¾—åˆ°å¯ä»¥è¢«å®ä¾‹åŒ–çš„ç±»ï¼Œä»¥æ­¤è·å¾—ç»„ä»¶ä¸Šä¸‹æ–‡çš„æ§åˆ¶æƒï¼ŒæŒ‚è½½ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ä½¿ç”¨<code>Vue.prototype.xxx = xxx</code>æŒ‚è½½åˆ°Vueæ ¹å®ä¾‹çš„åŸå‹ä¸Šã€‚ä½†åœ¨Vue3.xä¸­ï¼Œè¿™ä¸¤ä¸ªä¸œè¥¿éƒ½æ²¡æœ‰äº†ï¼Œå› æ­¤å†™æ³•ä¸Šä¼šæœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚</p><h2 id="Vue2-xå®ç°ä¸€ä¸ªå…¨å±€çš„toastç»„ä»¶"><a href="#Vue2-xå®ç°ä¸€ä¸ªå…¨å±€çš„toastç»„ä»¶" class="headerlink" title="Vue2.xå®ç°ä¸€ä¸ªå…¨å±€çš„toastç»„ä»¶"></a>Vue2.xå®ç°ä¸€ä¸ªå…¨å±€çš„toastç»„ä»¶</h2><p>2.xä¾‹å­æ˜¯æˆ‘åœ¨uni-appå®ç°çš„ï¼Œä¸è¿‡å’Œä¸€èˆ¬çš„vueå†™æ³•æ˜¯ä¸€æ ·çš„ï¼Œä¸‹é¢æ˜¯ç›®å½•ç»“æ„ï¼š</p><p><img src="/BeCoderQ.github.io/2021/05/25/Vue2-xä¸Vue3-xæ’ä»¶å¼å…¨å±€ç»„ä»¶å†™æ³•å¯¹åˆ«/2.x-menu.png" alt="å›¾"></p><p>åœ¨æ’ä»¶æš´éœ²çš„å¯¹è±¡ä¸­<code>extend</code>åï¼Œå®ä¾‹åŒ–å¯ä»¥æ‹¿åˆ°ç»„ä»¶ä¸Šä¸‹æ–‡ï¼Œä¾¿å¯ä»¥æ”¹å˜å†…éƒ¨å±æ€§äº†ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">import</span> Toast <span class="keyword">from</span> <span class="string">"./Toast.vue"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toastPlugin = &#123;</span><br><span class="line">    install</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">install</span>(<span class="params">v: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line">    <span class="comment">// 2.xé€šè¿‡extendæ–¹æ³•æ‹¿åˆ°ä¸€ä¸ªä¼ å…¥ç»„ä»¶çš„å®ä¾‹</span></span><br><span class="line">    <span class="keyword">const</span> ToastConstructor = v.extend(Toast),  </span><br><span class="line">        ins = <span class="keyword">new</span> ToastConstructor();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŒ‚è½½åœ¨ä¸€ä¸ªdomä¸Š</span></span><br><span class="line">    ins.$mount(div);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(ins.$el);</span><br><span class="line">    </span><br><span class="line">    Vue.prototype.toast = <span class="function">(<span class="params">&#123; msg = "", delay = 2000 &#125;</span>)=&gt;</span> &#123;</span><br><span class="line">        ins.msg = msg;</span><br><span class="line">        ins.delay = delay;</span><br><span class="line">        ins.show = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> toastPlugin;</span><br></pre></td></tr></table></figure><p>Toast.vueæ–‡ä»¶è¿˜æ˜¯æ­£å¸¸å†™ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;view class=&quot;toast&quot; v-show=&quot;show&quot;&gt;</span><br><span class="line">        &lt;view&gt;&#123;&#123; msg &#125;&#125;&lt;/view&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; Component, Prop, Vue &#125; from &quot;vue-property-decorator&quot;;</span><br><span class="line">    @Component(&#123;</span><br><span class="line">        components: &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    export default class Toast extends Vue &#123;</span><br><span class="line">        public msg: string = &quot;&quot;;</span><br><span class="line">        public delay: number = 2000;</span><br><span class="line">        public show: boolean = false;</span><br><span class="line"></span><br><span class="line">        mounted() &#123;</span><br><span class="line">            setTimeout(()=&gt; &#123;</span><br><span class="line">                this.show = false;</span><br><span class="line">            &#125;, this.delay);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">    .mask::before &#123;</span><br><span class="line">        background: rgba(0, 0, 0, 0.2);</span><br><span class="line">        position: fixed;</span><br><span class="line">        z-index: 9999;</span><br><span class="line">    &#125;</span><br><span class="line">    .toast &#123;</span><br><span class="line">        position: fixed;</span><br><span class="line">        background: rgba(0, 0, 0, 0.4);</span><br><span class="line">        border-radius: 10px;</span><br><span class="line">        display: flex;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        align-items: center;</span><br><span class="line">        justify-content: space-around;</span><br><span class="line">        width: 60vw;</span><br><span class="line">        min-height: 20vh;</span><br><span class="line">        top: 40%;</span><br><span class="line">        left: 50%;</span><br><span class="line">        transform: translate(-50%, -50%);</span><br><span class="line">        color: #ffffff;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº†æœ€ç®€å•çš„toast:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.toast(&#123;</span><br><span class="line">  msg: <span class="string">"åŠ è½½ä¸­"</span>,</span><br><span class="line">  delay: <span class="number">2000</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="/BeCoderQ.github.io/2021/05/25/Vue2-xä¸Vue3-xæ’ä»¶å¼å…¨å±€ç»„ä»¶å†™æ³•å¯¹åˆ«/2.x-toast.png" alt="å›¾"></p><p>å½“ç„¶ï¼Œåˆ«å¿˜äº†<code>Vue.use(Toast)</code>!</p><h2 id="vue3-xå®ç°ä¸€ä¸ªå…¨å±€notification-tips"><a href="#vue3-xå®ç°ä¸€ä¸ªå…¨å±€notification-tips" class="headerlink" title="vue3.xå®ç°ä¸€ä¸ªå…¨å±€notification(tips)"></a>vue3.xå®ç°ä¸€ä¸ªå…¨å±€notification(tips)</h2><p>åœ¨å°è¯•ä½¿ç”¨Vue3å®ç°å…¨å±€çš„notificationæç¤ºå‰ï¼Œæœ‰å‡ ä¸ªç–‘é—®ï¼š</p><ul><li>æ²¡æœ‰äº†<code>Vue.extend</code>æ–¹æ³•å¦‚ä½•è·å–ç»„ä»¶çš„ä¸Šä¸‹æ–‡ï¼Ÿ</li><li>å¦‚ä½•å®ç°ä¼ å…¥ç»„ä»¶å°†å…¶ä»¥æ’æ§½å½¢å¼æ¸²æŸ“å‡ºæ¥ï¼Ÿ</li></ul><p>ä¸‹é¢ä¸Šä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div @mouseover=&quot;onMouseOver&quot; @mouseleave=&quot;onMouseLeave&quot;&gt;</span><br><span class="line">        &lt;span v-if=&quot;msg&quot;&gt;&#123;&#123; msg &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;slot/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; defineComponent, nextTick, onMounted, ref &#125; from &quot;vue&quot;;</span><br><span class="line">    export default defineComponent(&#123;</span><br><span class="line">        props: &#123;</span><br><span class="line">            msg: &#123;</span><br><span class="line">                type: String,</span><br><span class="line">                default: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            duration: &#123;</span><br><span class="line">                type: Number,</span><br><span class="line">                default: 2000</span><br><span class="line">            &#125;,</span><br><span class="line">            resolve: &#123;</span><br><span class="line">                type: Function,</span><br><span class="line">                default: ()=&gt; &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        setup(props, &#123; attrs, emit &#125;) &#123;</span><br><span class="line">            let timer: number | null = null;</span><br><span class="line"></span><br><span class="line">            function onMouseOver() &#123;</span><br><span class="line">                timer &amp;&amp; clearTimeout(timer);</span><br><span class="line">            &#125;    </span><br><span class="line"></span><br><span class="line">            function onMouseLeave() &#123;</span><br><span class="line">                timer = setTimeout(()=&gt; &#123;</span><br><span class="line">                    document.querySelector(&quot;.tips&quot;)?.remove();</span><br><span class="line">                    props.resolve();</span><br><span class="line">                &#125;, props.duration)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            onMounted(onMouseLeave);</span><br><span class="line"></span><br><span class="line">            return &#123;</span><br><span class="line">                msg: props.msg,</span><br><span class="line">                onMouseOver,</span><br><span class="line">                onMouseLeave</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">    .tips &#123;</span><br><span class="line">        @extend .shadow-light;</span><br><span class="line">        @include br(10px);</span><br><span class="line">        padding: 10px;</span><br><span class="line">        min-width: 20vw;</span><br><span class="line">        max-width: 30vw;</span><br><span class="line">        min-height: 10vh;</span><br><span class="line">        position: relative;</span><br><span class="line">        right: 16px;</span><br><span class="line">        margin-bottom: 16px;</span><br><span class="line">        animation: rtl 1s ease;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @keyframes rtl &#123;</span><br><span class="line">        from &#123;</span><br><span class="line">            transform: translateX(-100%);</span><br><span class="line">            opacity: .1;</span><br><span class="line">        &#125;</span><br><span class="line">        to &#123;</span><br><span class="line">            transform: translateX(0);</span><br><span class="line">            opacity: 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class="line">// çˆ¶å®¹å™¨</span><br><span class="line">.tips-container &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 32px;</span><br><span class="line">    right: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>ç»„ä»¶è¿™è¾¹å¾ˆç®€å•ï¼Œpropsæ¥å—<code>msg</code>ï¼Œ<code>duration</code>ï¼Œ<code>resolve</code>ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯æ˜¾ç¤ºçš„æ–‡å­—æ¶ˆæ¯ï¼Œå±•ç¤ºçš„æ—¶é—´ï¼Œæœ€åä¸€ä¸ªå›è°ƒå‡½æ•°å®é™…æ˜¯Promiseç±»çš„resolveå›è°ƒå‡½æ•°ï¼Œç”¨æ¥å®ç°åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶åé€šçŸ¥ç”¨æˆ·ã€‚å…¶ä»–å°±æ˜¯ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼šé¼ æ ‡æ‚¬æµ®æ—¶å¸¸æ˜¾ï¼Œç§»å¼€åé‡æ–°è®¡æ—¶æ¶ˆå¤±ã€‚æœ€åè¿˜æœ‰ä¸€ä¸ªæ’æ§½ï¼Œç”¨äºæ˜¾ç¤ºç”¨æˆ·ä¼ å…¥çš„ç»„ä»¶ã€‚è¿™è¾¹æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå°±æ˜¯æœ‰ä¸€ç‚¹å¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨v-ifæ§åˆ¶æ­¤ç»„ä»¶çš„æ˜¾ç¤ºï¼Ÿå¦å¤–tipsæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿæ¥ä¸‹æ¥ä¸Šæ’ä»¶éƒ¨åˆ†çš„ä»£ç å°±æ­æ™“äº†ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createVNode, h, render, Component &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line"><span class="keyword">import</span> Tips <span class="keyword">from</span> <span class="string">"./Tips.vue"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    install(app: <span class="built_in">any</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> body = <span class="built_in">document</span>.body;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æŒ‚è½½åˆ°å…¨å±€</span></span><br><span class="line">        app.config.globalProperties.$tips = (</span><br><span class="line">          &#123; msg = <span class="string">""</span>, duration = <span class="number">2000</span>, slot &#125;: </span><br><span class="line">          &#123; msg: <span class="built_in">string</span>, duration: <span class="built_in">number</span>, slot: Component &#125;</span><br><span class="line">        )=&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> fatherDom = <span class="built_in">document</span>.querySelector(<span class="string">".tips-container"</span>);</span><br><span class="line">            <span class="keyword">let</span> tipsDiv = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>),</span><br><span class="line">                mountEl = fatherDom ? fatherDom : <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);    </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(!fatherDom) &#123;</span><br><span class="line">                mountEl.className = <span class="string">"tips-container"</span>;</span><br><span class="line">                body.appendChild(mountEl);</span><br><span class="line">            &#125;</span><br><span class="line">            mountEl.appendChild(tipsDiv);</span><br><span class="line">            tipsDiv.className = <span class="string">"tips"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> vm = createVNode(Tips, &#123;</span><br><span class="line">                    key: <span class="built_in">Date</span>.now() + <span class="built_in">Math</span>.random(),</span><br><span class="line">                    msg,</span><br><span class="line">                    duration,</span><br><span class="line">                    resolve</span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    <span class="keyword">default</span>: <span class="function"><span class="params">()</span>=&gt;</span> createVNode(slot)</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">const</span> context = vm.component?.proxy!;</span><br><span class="line">                <span class="comment">// Tipsç»„ä»¶ä¸Šä¸‹æ–‡ å¯ä»¥æ§åˆ¶ç»„ä»¶å†…éƒ¨å±æ€§</span></span><br><span class="line">                <span class="comment">// setTimeout(()=&gt; &#123;</span></span><br><span class="line">                <span class="comment">//     context.msg = "æ”¹å˜æ˜¾ç¤ºæ–‡æœ¬";</span></span><br><span class="line">                <span class="comment">// &#125;, 1000)</span></span><br><span class="line">                <span class="comment">// è¿™ä¸ªå†™æ³•æ¥è‡ªvue-nextä»“åº“issue-2097ï¼šhttps://github.com/vuejs/vue-next/issues/2097</span></span><br><span class="line">                <span class="keyword">if</span>(app._context) &#123;</span><br><span class="line">                    vm.appContext = app._context;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ ·å¼scopeè·å–</span></span><br><span class="line">                tipsDiv.setAttribute(Tips.__scopeId, <span class="string">""</span>)</span><br><span class="line">                render(vm, tipsDiv);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆè§£é‡Šä¸€ä¸‹å‰é¢çš„ç–‘é—®ï¼š</p><ul><li><p>Vue3ä¸­æ²¡æœ‰äº†<code>Vue.extend</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>createVNode</code>æ–¹æ³•æ¥å®ç°ï¼Œå®ƒçš„ç±»å‹å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="function"><span class="keyword">function</span> <span class="title">_createVNode</span>(<span class="params"><span class="keyword">type</span>: VNodeTypes | ClassComponent | <span class="keyword">typeof</span> NULL_DYNAMIC_COMPONENT, props?: (Data &amp; VNodeProps) | <span class="literal">null</span>, children?: unknown, patchFlag?: <span class="built_in">number</span>, dynamicProps?: <span class="built_in">string</span>[] | <span class="literal">null</span>, isBlockNode?: <span class="built_in">boolean</span></span>): <span class="title">VNode</span></span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å®ƒèƒ½å¤Ÿæ¥å—<code>ClassComponent</code>ï¼Œå¹¶è¿”å›<code>VNode</code>ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å°†å¯¼å…¥çš„ç»„ä»¶æ‰”è¿›å»ï¼Œç„¶åè½¬æ¢æˆ<code>VNode</code>äº†ï¼Œå¦‚å›¾å¯ä»¥çœ‹åˆ°<code>VNode</code>å¯¹è±¡ä¸­çš„å±æ€§ï¼Œå®ƒæ˜¯èƒ½æ‹¿åˆ°<code>component</code>å®ä¾‹çš„ï¼š</p><p><img src="/BeCoderQ.github.io/2021/05/25/Vue2-xä¸Vue3-xæ’ä»¶å¼å…¨å±€ç»„ä»¶å†™æ³•å¯¹åˆ«/3.x-vnode.png" alt="å›¾"></p><p>æ²¡é”™ï¼Œè¿™æ ·å°±å¯ä»¥æ‹¿åˆ°ä¸Šä¸‹æ–‡äº†ï¼Œä¸Šé¢ä»£ç æ³¨é‡Šçš„é‚£éƒ¨åˆ†å°±å¯ä»¥å“åº”å¼çš„ä¿®æ”¹ç»„ä»¶å†…å±æ€§msgçš„å€¼ã€‚</p><p>å®é™…ä¸Šï¼Œè¿˜å¯ä»¥ç”¨å¦ä¸€ç§å†™æ³•ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = h(Tips, &#123;</span><br><span class="line">  key: <span class="built_in">Date</span>.now() + <span class="built_in">Math</span>.random(),</span><br><span class="line">  msg, </span><br><span class="line">  duration,</span><br><span class="line">  resolve</span><br><span class="line">&#125;, <span class="function"><span class="params">()</span>=&gt;</span> createVNode(slot));</span><br></pre></td></tr></table></figure><p>æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æœ€åä½¿ç”¨<code>render</code>å‡½æ•°æ¸²æŸ“ã€‚</p></li><li><p>ç¬¬äºŒä¸ªé—®é¢˜ä¸Šé¢å…¶å®ä¹Ÿè§£å†³äº†ï¼Œ<code>createVNode</code>å‡½æ•°ä¹Ÿæ¥å—ä¼ å…¥ä¸€ä¸ª<code>VNode</code>ç±»å‹çš„å€¼ï¼ˆè¿™é‡Œä¼ å…¥ä¸€ä¸ªå›è°ƒè¿”å›ä¸€ä¸ª<code>VNode</code>ï¼‰,è¿™ä¸ªå€¼å°±æ˜¯æ’æ§½äº†ï¼Œå¯¹è±¡çš„keyå°±æ˜¯å…·åæ’æ§½çš„nameï¼Œé»˜è®¤æ’æ§½å³ä¸ºdefaultã€‚</p></li><li><p>æœ€åï¼Œä¸ºå•¥ä¸ç”¨v-ifæ§åˆ¶ï¼ŒåŸå› å…¶å®æ˜¯<code>createVNode</code>åˆ›é€ çš„ç»„ä»¶å¹¶ä¸ä¼šå› ä¸ºå¤šæ¬¡è°ƒç”¨è€Œç”Ÿæˆå¤šä¸ªçœŸå®çš„domèŠ‚ç‚¹ï¼Œè¿™å¯¼è‡´å¤šæ¬¡è°ƒç”¨æ€»æ˜¯åé¢ä¸€ä¸ªè¦†ç›–å‰é¢ä¸€ä¸ªï¼Œæ³¨æ„ï¼Œæˆ‘æ˜¯ä¼ äº†keyçš„ã€‚å› æ­¤åªèƒ½åœ¨<code>$tips</code>ä¸­åˆ›å»ºæ–°çš„domå¾€æ ¹èŠ‚ç‚¹é‡Œé¢æ’ã€‚</p></li></ul><p>è°ƒç”¨ä¸Šï¼Œæˆ‘åˆ©ç”¨hookåšäº†ä¸€ä¸ªç®€å•çš„ä¸Šä¸‹æ–‡æ˜ å°„ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* hook */</span></span><br><span class="line"><span class="keyword">import</span> &#123; ComponentPublicInstance, getCurrentInstance &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useContext</span>(<span class="params"></span>): <span class="title">ComponentPublicInstance</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; proxy: context &#125; = &lt;ProxyContext&gt;getCurrentInstance()</span><br><span class="line">    <span class="keyword">return</span> context</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œåœ¨vueæ–‡ä»¶ä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        ...</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">    import &#123; defineComponent, onMounted, ref &#125; from &quot;vue&quot;;</span><br><span class="line">  import &#123; useContext &#125; from &quot;@/hook/use-context&quot;;</span><br><span class="line">  // TextSlotç»„ä»¶æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬ç»„ä»¶ï¼Œæµ‹è¯•æ’æ§½åŠŸèƒ½ã€‚è¿™é‡Œå°±ä¸å†™äº†ã€‚</span><br><span class="line">  import TextSlot from &quot;./TextSlot.vue&quot;</span><br><span class="line">    export default defineComponent(&#123;</span><br><span class="line">        setup(props, &#123; attrs, emit &#125;) &#123;</span><br><span class="line">          // ä¸Šä¸‹æ–‡</span><br><span class="line">          const ctx = useContext();</span><br><span class="line">            onMounted(()=&gt; &#123;</span><br><span class="line">              ctx.$notification(&#123;</span><br><span class="line">                msg: &quot;æµ‹è¯•22&quot;,</span><br><span class="line">                duration: 8000,</span><br><span class="line">                slot: TextSlot</span><br><span class="line">              &#125;);</span><br><span class="line"></span><br><span class="line">              // å»¶è¿Ÿä¸€ç§’åå†æ¥ä¸€ä¸ª</span><br><span class="line">              setTimeout(()=&gt; &#123;</span><br><span class="line">                ctx.$notification(&#123;</span><br><span class="line">                  msg: &quot;å»¶è¿Ÿä¸€ç§’çš„&quot;,</span><br><span class="line">                  duration: 6000</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;, 3000)</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹æ•ˆæœï¼š</p><p><img src="/BeCoderQ.github.io/2021/05/25/Vue2-xä¸Vue3-xæ’ä»¶å¼å…¨å±€ç»„ä»¶å†™æ³•å¯¹åˆ«/3.x-notification.gif" alt="å›¾"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆä¼šæœ‰åŒºåˆ«&lt;/h2&gt;&lt;p&gt;Vue2.xä¸­æˆ‘ä»¬ä½¿ç”¨&lt;code&gt;extend&lt;/code&gt;æ–¹æ³•ä¼ å…¥ç»„ä»¶ç±»å¾—åˆ°å¯ä»¥è¢«å®ä¾‹åŒ–çš„ç±»ï¼Œä»¥æ­¤
      
    
    </summary>
    
    
      <category term="æ€»ç»“" scheme="http://localhost:4000/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="vue3" scheme="http://localhost:4000/tags/vue3/"/>
    
      <category term="æ’ä»¶" scheme="http://localhost:4000/tags/%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨</title>
    <link href="http://localhost:4000/2021/05/18/%E4%BD%BF%E7%94%A8JavaScript%E5%AE%9E%E7%8E%B0%E5%8D%95%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8/"/>
    <id>http://localhost:4000/2021/05/18/%E4%BD%BF%E7%94%A8JavaScript%E5%AE%9E%E7%8E%B0%E5%8D%95%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8/</id>
    <published>2021-05-18T07:52:08.000Z</published>
    <updated>2021-05-20T06:33:57.491Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><p>é“¾è¡¨ç”¨æ¥å­˜å‚¨æœ‰åºçš„å…ƒç´ é›†åˆï¼Œä¸æ•°ç»„ä¸åŒï¼Œé“¾è¡¨ä¸­çš„å…ƒç´ å¹¶éä¿å­˜åœ¨è¿ç»­çš„å­˜å‚¨ç©ºé—´å†…ï¼Œæ¯ä¸ªå…ƒç´ ç”±ä¸€ä¸ªå­˜å‚¨å…ƒç´ æœ¬èº«çš„èŠ‚ç‚¹å’Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆæ„æˆã€‚å½“è¦ç§»åŠ¨æˆ–åˆ é™¤å…ƒç´ æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ç›¸åº”å…ƒç´ ä¸Šçš„æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚å¯¹é“¾è¡¨å…ƒç´ çš„æ“ä½œè¦æ¯”å¯¹æ•°ç»„å…ƒç´ çš„æ“ä½œæ•ˆç‡æ›´é«˜</p><p><img src="/BeCoderQ.github.io/2021/05/18/ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨/linklist.png" alt="å›¾"></p><h3 id="å•å‘é“¾è¡¨"><a href="#å•å‘é“¾è¡¨" class="headerlink" title="å•å‘é“¾è¡¨"></a>å•å‘é“¾è¡¨</h3><p>é¡¾åæ€ä¹‰è¿™ä¸ªé“¾è¡¨æ˜¯å•å‘çš„ï¼Œå³å®ƒçš„æŒ‡é’ˆåªä¼šæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå•å‘é“¾è¡¨çš„ç±»ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(element) &#123;</span><br><span class="line">        <span class="keyword">this</span>.element = element;</span><br><span class="line">        <span class="keyword">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å®ç°LinkListç±»ï¼Œå…ˆçœ‹ä¸€ä¸‹éª¨æ¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPosIllegal</span>(<span class="params">pos, size</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pos &lt; <span class="number">0</span> || pos &gt; size - <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.head = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check å‘é“¾è¡¨æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkList&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    append(el) &#123;&#125;</span><br><span class="line">    <span class="comment">// @ts-check åœ¨æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;boolean&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    insertAt(pos, el) &#123;&#125;</span><br><span class="line">    <span class="comment">// @ts-check ç§»é™¤æŸå…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    remove(el) &#123;&#125;</span><br><span class="line">    <span class="comment">// @ts-check ç§»é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    removeAt(pos) &#123;&#125;</span><br><span class="line">    <span class="comment">// @ts-check è¿”å›ä¼ å…¥å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el </span></span><br><span class="line"><span class="comment">     * @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    indexOf(el) &#123;&#125;</span><br><span class="line">    <span class="comment">// @ts-check ä¼ å…¥ç´¢å¼•è¿”å›å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getElementAt(pos) &#123;&#125;</span><br><span class="line">    <span class="comment">// @ts-check é“¾è¡¨é•¿åº¦</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">get</span> size() &#123;&#125;</span><br><span class="line">    <span class="comment">// æ¸…é™¤é“¾è¡¨</span></span><br><span class="line">    clear() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•é“¾è¡¨<code>LinkList</code>ç±»ä¼šæœ‰ä¸€ä¸ª<strong>head</strong>å±æ€§ä¸<strong>length</strong>å±æ€§ï¼Œå‰è€…ä¸ºæ­¤é“¾è¡¨çš„å¤´éƒ¨å…ƒç´ ï¼Œåè€…ä¸ºé“¾è¡¨é•¿åº¦ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå®ç°getElementAtå‡½æ•°ï¼Œå› ä¸ºåé¢å¾ˆå¤šå‡½æ•°éƒ½ä¼šä½¿ç”¨å®ƒï¼Œç„¶åå®ç°appendï¼Œå®ƒçš„é€»è¾‘æ¯”è¾ƒç®€å•ã€‚</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkList</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">    <span class="comment">// @ts-check å‘é“¾è¡¨æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkList&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    append(el) &#123;</span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> LinkNode(el);</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰é“¾è¡¨ä¸ºç©ºï¼Œåˆ™æ·»åŠ çš„å°±æ˜¯head åä¹‹ï¼Œæ·»åŠ åˆ°å°¾éƒ¨</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.head === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.head = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tailNode = <span class="keyword">this</span>.getElementAt(<span class="keyword">this</span>.length - <span class="number">1</span>);</span><br><span class="line">            tailNode.next = node;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.length += <span class="number">1</span>;</span><br><span class="line">      <span class="comment">// å®ç°é“¾å¼çš„è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ä¼ å…¥ç´¢å¼•è¿”å›å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getElementAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pos; i++) &#123;</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> currentNode;</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨<code>getElementAt</code>ä¸­é¦–å…ˆä½¿ç”¨å¤–éƒ¨å·¥å…·å‡½æ•°<code>isPosIllegal</code>åˆ¤æ–­ä¼ å…¥ç´¢å¼•æ˜¯å¦åˆæ³•ï¼Œç„¶åä½¿ç”¨forå¾ªç¯ä¸æ–­çš„ç»™å˜é‡<code>currentNode</code>èµ‹å€¼ï¼Œç›´åˆ°è¾¾åˆ°ä¼ å…¥çš„ç´¢å¼•</li><li>å¯¹äº<code>append</code>å‡½æ•°ï¼ŒåŠŸèƒ½ä¸ºå°†ä¼ å…¥å…ƒç´ æ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨ï¼Œå› æ­¤åªéœ€è¦åˆ¤æ–­å½“å‰é“¾è¡¨æ˜¯å¦ä¸ºç©ºï¼Œæ˜¯ç›´æ¥èµ‹å€¼ç»™headï¼Œåä¹‹æ‹¿åˆ°å½“å‰æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°†æŒ‡é’ˆæŒ‡å‘ä¼ å…¥å…ƒç´ ã€‚</li></ul><p>æ¥ä¸‹æ¥å®ç°æ’å…¥æ“ä½œï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkList</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">    <span class="comment">// @ts-check å‘é“¾è¡¨æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkList&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    append(el) &#123;</span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> LinkNode(el);</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰é“¾è¡¨ä¸ºç©ºï¼Œåˆ™æ·»åŠ çš„å°±æ˜¯head åä¹‹ï¼Œæ·»åŠ åˆ°å°¾éƒ¨</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.head === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.head = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tailNode = <span class="keyword">this</span>.getElementAt(<span class="keyword">this</span>.length - <span class="number">1</span>);</span><br><span class="line">            tailNode.next = node;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.length += <span class="number">1</span>;</span><br><span class="line">      <span class="comment">// å®ç°é“¾å¼çš„è°ƒç”¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// @ts-check åœ¨æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;boolean&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    insertAt(pos, el) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length + <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–</span></span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> LinkNode(el);</span><br><span class="line">        <span class="comment">// å¯»æ‰¾ç›®æ ‡ç´¢å¼•çš„ä¸Šä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span>(pos === <span class="number">0</span>) &#123;</span><br><span class="line">            node.next = <span class="keyword">this</span>.head;</span><br><span class="line">            <span class="keyword">this</span>.head = node.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> prevNode = <span class="keyword">this</span>.getElementAt(pos - <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            node.next = prevNode.next;</span><br><span class="line">            prevNode.next = node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.length += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ä¼ å…¥ç´¢å¼•è¿”å›å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getElementAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pos; i++) &#123;</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> currentNode;</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºæ’å…¥ï¼Œæˆ‘ä»¬è¦è€ƒè™‘ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œå°±æ˜¯æ’å…¥å¤´éƒ¨ï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæ’å…¥å¤´éƒ¨ç›´æ¥æ›¿æ¢headå³å¯ï¼Œå…¶ä»–æƒ…å†µåŒ…æ‹¬ç´¢å¼•å¤š1çš„è¶Šç•Œå€¼éƒ½å¯ä»¥ä¸€èµ·å¤„ç†ã€‚æ¥ä¸‹æ¥å®ç°åˆ é™¤å…ƒç´ çš„å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkList</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// @ts-check ç§»é™¤æŸå…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    remove(el) &#123;</span><br><span class="line">        <span class="keyword">const</span> index = <span class="keyword">this</span>.indexOf(el);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(index !== <span class="number">-1</span>) <span class="keyword">return</span> <span class="keyword">this</span>.removeAt(index);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ç§»é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    removeAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> targetNode = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pos === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.head = <span class="keyword">this</span>.head.next;</span><br><span class="line">            targetNode = <span class="keyword">this</span>.head;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> removeNode = <span class="keyword">this</span>.getElementAt(pos),</span><br><span class="line">            prevNode = <span class="keyword">this</span>.getElementAt(pos - <span class="number">1</span>);</span><br><span class="line">            prevNode.next = removeNode.next;</span><br><span class="line">            targetNode = removeNode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.length -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> targetNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ä¼ å…¥ç´¢å¼•è¿”å›å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getElementAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pos; i++) &#123;</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> currentNode;</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ä¸‹é¢ç®€é™‹çš„å›¾ï¼š</p><p><img src="/BeCoderQ.github.io/2021/05/18/ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨/remove_single.png" alt="å›¾"></p><p>è¿˜æ˜¯è€ƒè™‘åˆ é™¤ç¬¬ä¸€ä¸ªçš„ç‰¹æ®Šæƒ…å†µï¼Œå¾ˆç®€å•ï¼Œheadæ›¿æ¢ä¸ºä¸‹ä¸€ä¸ªï¼Œå…¶ä»–æƒ…å†µéœ€è¦é¦–å…ˆæ‹¿åˆ°è¦åˆ é™¤çš„ç›®æ ‡å…ƒç´ ï¼Œç„¶åå°†ç›®æ ‡å…ƒç´ çš„ä¸Šä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆæŒ‡å‘ç›®æ ‡å…ƒç´ ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œä»¥æ­¤å®ç°åˆ é™¤æ•ˆæœã€‚å¦ä¸€ä¸ªremoveæ–¹æ³•å°±å¾ˆç®€å•äº†ï¼Œä¼ å…¥ç›®æ ‡å…ƒç´ ï¼Œéå†é“¾è¡¨æ‹¿åˆ°ç›¸åŒå€¼çš„å…ƒç´ ã€‚è¿™é‡Œåªæ˜¯ç®€å•å¤„ç†äº†åŸºæœ¬ç±»å‹å…ƒç´ ã€‚</p><p>æœ€åå‡ ä¸ªæ–¹æ³•å°±å¾ˆç®€å•äº†ï¼Œç›´æ¥ä¸Šå®Œæ•´ç‰ˆï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.head = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check å‘é“¾è¡¨æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkList&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    append(el) &#123;</span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> LinkNode(el);</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰é“¾è¡¨ä¸ºç©ºï¼Œåˆ™æ·»åŠ çš„å°±æ˜¯head åä¹‹ï¼Œæ·»åŠ åˆ°å°¾éƒ¨</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.head === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.head = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> tailNode = <span class="keyword">this</span>.getElementAt(<span class="keyword">this</span>.length - <span class="number">1</span>);</span><br><span class="line">            tailNode.next = node;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.length += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check åœ¨æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;boolean&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    insertAt(pos, el) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length + <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–</span></span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> LinkNode(el);</span><br><span class="line">        <span class="comment">// å¯»æ‰¾ç›®æ ‡ç´¢å¼•çš„ä¸Šä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span>(pos === <span class="number">0</span>) &#123;</span><br><span class="line">            node.next = <span class="keyword">this</span>.head;</span><br><span class="line">            <span class="keyword">this</span>.head = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> prevNode = <span class="keyword">this</span>.getElementAt(pos - <span class="number">1</span>);</span><br><span class="line">            </span><br><span class="line">            node.next = prevNode.next;</span><br><span class="line">            prevNode.next = node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.length += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ç§»é™¤æŸå…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    remove(el) &#123;</span><br><span class="line">        <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(currentNode.element === el) <span class="keyword">return</span> <span class="keyword">this</span>.removeAt(i);</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ç§»é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    removeAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> targetNode = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(pos === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.head = <span class="keyword">this</span>.head.next;</span><br><span class="line">            targetNode = <span class="keyword">this</span>.head;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> removeNode = <span class="keyword">this</span>.getElementAt(pos),</span><br><span class="line">            prevNode = <span class="keyword">this</span>.getElementAt(pos - <span class="number">1</span>);</span><br><span class="line">            prevNode.next = removeNode.next;</span><br><span class="line">            targetNode = removeNode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.length -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> targetNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check è¿”å›ä¼ å…¥å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el </span></span><br><span class="line"><span class="comment">     * @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    indexOf(el) &#123;</span><br><span class="line">        <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(currentNode.element === el) <span class="keyword">return</span> i;</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ä¼ å…¥ç´¢å¼•è¿”å›å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;LinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getElementAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> currentNode = <span class="keyword">this</span>.head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; pos; i++) &#123;</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> currentNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check é“¾è¡¨é•¿åº¦</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">get</span> size() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¸…é™¤é“¾è¡¨</span></span><br><span class="line">    clear() &#123;</span><br><span class="line">        <span class="keyword">this</span>.head = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.length = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œèµ·æ¥çœ‹çœ‹ï¼š</p><ul><li><p>æ’å…¥ï¼š<img src="/BeCoderQ.github.io/2021/05/18/ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨/insert_test.png" alt="å›¾"></p></li><li><p>åˆ é™¤ï¼š<img src="/BeCoderQ.github.io/2021/05/18/ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨/remove_test.png" alt="å›¾"></p></li></ul><h3 id="åŒå‘é“¾è¡¨"><a href="#åŒå‘é“¾è¡¨" class="headerlink" title="åŒå‘é“¾è¡¨"></a>åŒå‘é“¾è¡¨</h3><p><img src="/BeCoderQ.github.io/2021/05/18/ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨/db_linklist.png" alt="å›¾"><br>åŒå‘é“¾è¡¨ä¸å•å‘é“¾è¡¨ç›¸æ¯”ï¼Œè¿˜å¤šäº†ä¸€ä¸ªåªæƒ³å‰ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œæˆ‘ç”¨<code>prev</code>è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç»§æ‰¿å•å‘é“¾è¡¨ï¼Œé‡å†™éƒ¨åˆ†æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒå‘é“¾è¡¨å…ƒç´ å®ä¾‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DbLinkNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(element) &#123;</span><br><span class="line">        <span class="keyword">this</span>.element = element;</span><br><span class="line">        <span class="keyword">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">this</span>.prev = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒå‘é“¾è¡¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoubleLinkList</span> <span class="keyword">extends</span> <span class="title">LinkList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.tail = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    append(el) &#123;</span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> DbLinkNode(el);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.head === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.head = node;</span><br><span class="line">            <span class="keyword">this</span>.tail = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.tail.next = node;</span><br><span class="line">            node.prev = <span class="keyword">this</span>.tail;</span><br><span class="line">            <span class="keyword">this</span>.tail = node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.length += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ç§»é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;DbLinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    removeAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> targetNode = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(pos) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">this</span>.head = <span class="keyword">this</span>.head.next;</span><br><span class="line">                targetNode = <span class="keyword">this</span>.head;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">this</span>.length - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">this</span>.tail = <span class="keyword">this</span>.tail.prev;</span><br><span class="line">                targetNode = <span class="keyword">this</span>.tail;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// æ‹¿åˆ°è¦åˆ é™¤çš„å…ƒç´ ï¼Œé€šè¿‡å®ƒåˆèƒ½æ‹¿åˆ°å‰ä¸€ä¸ªå…ƒç´ ä¸åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                targetNode = <span class="keyword">this</span>.getElementAt(pos);</span><br><span class="line">                <span class="keyword">let</span> nextNode = targetNode.next,</span><br><span class="line">                    prevNode = targetNode.prev;</span><br><span class="line">                </span><br><span class="line">                prevNode.next = nextNode;</span><br><span class="line">                nextNode.prev = prevNode;    </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.length -= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> targetNode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; el</span></span><br><span class="line"><span class="comment">     * @return &#123;boolean&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    insertAt(pos, el) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length + <span class="number">1</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> node = <span class="keyword">new</span> DbLinkNode(el);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span>(pos) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="comment">// æ’å…¥å¤´éƒ¨ è€ƒè™‘ç©ºé“¾è¡¨ä¸éç©ºé“¾è¡¨ä¸¤ç§çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>.head === <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.head = node;</span><br><span class="line">                    <span class="keyword">this</span>.tail = node;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    node.next = <span class="keyword">this</span>.head;</span><br><span class="line">                    <span class="keyword">this</span>.head.prev = node;</span><br><span class="line">                    <span class="keyword">this</span>.head = node;   </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;     </span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">this</span>.length:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.append(el);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// åˆ¤æ–­ç¦»å¤´éƒ¨è¿‘ï¼Œè¿˜æ˜¯å°¾éƒ¨è¿‘ï¼Œå‰è€…ç›´æ¥å¤ç”¨å•é“¾è¡¨æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">if</span>(pos &gt; <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.length / <span class="number">2</span>)) &#123;</span><br><span class="line">                    <span class="keyword">let</span> targetNode = <span class="keyword">this</span>.getElementAt(pos),</span><br><span class="line">                        prevNode = targetNode.prev;</span><br><span class="line">                    <span class="comment">// æ’å…¥å…ƒç´ çš„ä¸‹ä¸€ä¸ªå³æ˜¯æ’å…¥å‰æ‰€åœ¨æ­¤ç´¢å¼•çš„å…ƒç´         </span></span><br><span class="line">                    node.next = targetNode;</span><br><span class="line">                    node.prev = prevNode;</span><br><span class="line">                    targetNode.prev = node;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">super</span>.insertAt(pos, el);</span><br><span class="line">                &#125;        </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.length += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @ts-check ä¼ å…¥ç´¢å¼•è¿”å›å…ƒç´ </span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @param &#123;number&#125; pos</span></span><br><span class="line"><span class="comment">     * @return &#123;DbLinkNode | null&#125; </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    getElementAt(pos) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPosIllegal(pos, <span class="keyword">this</span>.length)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">switch</span>(pos) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.head;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">this</span>.length - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.tail;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// åˆ¤æ–­ç¦»å¤´éƒ¨è¿‘ï¼Œè¿˜æ˜¯å°¾éƒ¨è¿‘ï¼Œå‰è€…ç›´æ¥å¤ç”¨å•é“¾è¡¨æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">if</span>(pos &gt; <span class="built_in">Math</span>.floor(<span class="keyword">this</span>.length / <span class="number">2</span>)) &#123;</span><br><span class="line">                    <span class="keyword">let</span> currentNode = <span class="keyword">new</span> DbLinkNode();</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="keyword">this</span>.length - <span class="number">1</span>; i &gt; pos; i--) &#123;</span><br><span class="line">                        currentNode = currentNode.prev;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> currentNode;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">super</span>.getElementAt(pos);</span><br><span class="line">                &#125;        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºå®ç°çš„åŸºç¡€ç‰ˆæœ¬ï¼Œä¸ç®—å¤æ‚ï¼Œè¿™é‡Œç›´æ¥ä»£ç å…¨ä¸Šäº†ï¼Œæœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š</p><ul><li><code>getElement</code>ï¼šå› ä¸ºä¸€ä¸ªå…ƒç´ å¯ä»¥çŸ¥é“å‰ä¸€ä¸ªä¸åä¸€ä¸ªï¼Œå› æ­¤<code>getElementAt</code>å‡½æ•°å¯ä»¥ä¸å¿…å…¨éå†ï¼Œå¯ä»¥å…ˆåˆ¤æ–­ä¼ å…¥çš„ç´¢å¼•ä¿¡æ¯æ˜¯ç¦»å¤´è¿‘è¿˜æ˜¯ç¦»å°¾å·´è¿‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ—¶é—´å¤æ‚åº¦ï¼Œå¹¶ä¸”å¦‚æœæ˜¯å‰è€…æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨åŸºç±»ï¼Œä¹Ÿå°±æ˜¯å•å‘é“¾è¡¨çš„<code>getElement</code>æ–¹æ³•ã€‚</li><li><code>removeAt</code>ï¼šéœ€è¦è€ƒè™‘ä¸‰ç§æƒ…å†µï¼Œå³å¤´éƒ¨å’Œå°¾éƒ¨ä»¥åŠå…¶ä»–ã€‚</li><li><code>insertAt</code>ï¼šæœ¬è´¨ä¸Šè¿˜æ˜¯ä¸‰ç§æƒ…å†µï¼Œä¸è¿‡æ’å…¥å¤´éƒ¨æ—¶æˆ‘ä»¬è¦åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å½“å‰æ˜¯ç©ºé“¾è¡¨ï¼Œå°¾éƒ¨çš„æƒ…å†µå¯ä»¥ç›´æ¥è°ƒç”¨<code>append</code>æ–¹æ³•ï¼Œå…¶ä»–æƒ…å†µç±»ä¼¼<code>getElement</code>æ–¹æ³•ï¼Œé€šè¿‡åˆ¤æ–­ç¦»å¤´éƒ¨è¿‘è¿˜æ˜¯å°¾éƒ¨è¿‘ï¼Œå¯ä»¥å¤ç”¨åŸºç±»çš„æ–¹æ³•ã€‚</li></ul><p>è¿è¡Œçœ‹çœ‹ï¼š</p><ul><li>æ’å…¥ï¼š<img src="/BeCoderQ.github.io/2021/05/18/ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨/db_insert_test.png" alt="å›¾"></li><li>åˆ é™¤ï¼š<img src="/BeCoderQ.github.io/2021/05/18/ä½¿ç”¨JavaScriptå®ç°å•åŒå‘é“¾è¡¨/db_remove_test.png" alt="å›¾"></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…³äºæ•°ç»„å’Œé“¾è¡¨ï¼Œæ€»ç»“ä»¥ä¸‹ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>æ•°ç»„å¯ä»¥åˆ©ç”¨ä¸‹æ ‡å¿«é€Ÿæ‰¾åˆ°å…ƒç´ ï¼Œä½†å› ä¸ºæ•°ç»„æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥åœ¨æ’å…¥ä¸åˆ é™¤å…ƒç´ æ—¶ä¼šç§»åŠ¨å…¶ä»–å…ƒç´ ã€‚</li><li>é“¾è¡¨æ˜¯ä¸è¿ç»­çš„ï¼Œå› æ­¤æ’å…¥ä¸åˆ é™¤çš„æ•ˆç‡é«˜ï¼Œå†…å­˜åˆ©ç”¨ç‡æ›´é«˜ï¼Œä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¼šæ¯”æ•°ç»„ä½ã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é“¾è¡¨&quot;&gt;&lt;a href=&quot;#é“¾è¡¨&quot; class=&quot;headerlink&quot; title=&quot;é“¾è¡¨&quot;&gt;&lt;/a&gt;é“¾è¡¨&lt;/h2&gt;&lt;p&gt;é“¾è¡¨ç”¨æ¥å­˜å‚¨æœ‰åºçš„å…ƒç´ é›†åˆï¼Œä¸æ•°ç»„ä¸åŒï¼Œé“¾è¡¨ä¸­çš„å…ƒç´ å¹¶éä¿å­˜åœ¨è¿ç»­çš„å­˜å‚¨ç©ºé—´å†…ï¼Œæ¯ä¸ªå…ƒç´ ç”±ä¸€ä¸ªå­˜å‚¨å…ƒç´ æœ¬èº«çš„èŠ‚ç‚¹å’Œä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆæ„
      
    
    </summary>
    
    
      <category term="æ€»ç»“" scheme="http://localhost:4000/categories/%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="æ•°æ®ç»“æ„ï¼Œé“¾è¡¨" scheme="http://localhost:4000/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%8C%E9%93%BE%E8%A1%A8/"/>
    
  </entry>
  
  <entry>
    <title>å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ(è½¬è½½)</title>
    <link href="http://localhost:4000/2021/04/24/%E5%80%9F%E5%8A%A9babel%E7%9A%84AST%E8%A7%A3%E6%9E%90%EF%BC%8C%E8%AE%A9%E8%80%81%E4%BB%A3%E7%A0%81%E9%87%8D%E8%8E%B7%E6%96%B0%E7%94%9F-%E8%BD%AC%E8%BD%BD/"/>
    <id>http://localhost:4000/2021/04/24/%E5%80%9F%E5%8A%A9babel%E7%9A%84AST%E8%A7%A3%E6%9E%90%EF%BC%8C%E8%AE%A9%E8%80%81%E4%BB%A3%E7%A0%81%E9%87%8D%E8%8E%B7%E6%96%B0%E7%94%9F-%E8%BD%AC%E8%BD%BD/</id>
    <published>2021-04-24T07:12:36.000Z</published>
    <updated>2021-05-14T09:24:57.690Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>åœ¨æœ€è¿‘çš„å·¥ä½œä¸­ï¼Œæ¥æ‰‹äº†ä¸€ä¸ªå¤è€çš„é¡¹ç›®ï¼Œå…¶ä¸­çš„ JS ä»£ç æ˜¯ä¸€æ•´å¨çš„é¢æ¡ä»£ç ï¼Œçº¦ 3000 è¡Œçš„ä»£ç å…¨å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç»´æŠ¤èµ·æ¥ç€å®è®©äººå¤´ç–¼ã€‚</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾1.png" alt="å›¾"></p><p>æƒ³ä¸é€šä¸ºå•¥ä¹‹å‰ç»´æŠ¤é¡¹ç›®çš„åŒå­¦èƒ½å¤Ÿå¿å—è¿™ä¹ˆéš¾ä»¥ç»´æŠ¤çš„ä»£ç â€¦â€¦æ—¢ç„¶ç°åœ¨è¿™ä¸ªé”…è¢«æˆ‘æ‹¿ä¸‹äº†ï¼Œæ€ä¹ˆç€ä¹Ÿä¸èƒ½å®¹å¿å¦‚æ­¤ä¸‘é™‹çš„ä»£ç ç»§ç»­å­˜åœ¨ç€ï¼Œå¿…é¡»æŠŠå®ƒä¼˜åŒ–ä¸€ä¸‹ã€‚</p><p>æ¨ªç«–çœ‹äº†åŠå¤©ï¼Œç”±äºé€»è¾‘éƒ½æ‰åœ¨äº†ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œçœ‹éƒ½çœ‹å¾—çœ¼èŠ±ç¼­ä¹±ï¼Œå½“åŠ¡ä¹‹æ€¥ä¾¿æ˜¯æŠŠå®ƒè¿›è¡Œæ¨¡å—åŒ–æ‹†åˆ†ï¼ŒæŠŠè¿™ä¸€å¤§å¨é¢æ¡çŠ¶ä»£ç æ‹†åˆ†æˆä¸€ä¸ªä¸ªæ¨¡å—å¹¶æŠ½ç¦»æˆæ–‡ä»¶ï¼Œè¿™æ ·æ‰æ–¹ä¾¿åç»­çš„æŒç»­ä¼˜åŒ–ã€‚</p><h2 id="ç»“æ„åˆ†æ"><a href="#ç»“æ„åˆ†æ" class="headerlink" title="ç»“æ„åˆ†æ"></a>ç»“æ„åˆ†æ</h2><p>è¯´å¹²å°±å¹²ï¼Œæ—¢ç„¶è¦æ‹†åˆ†æˆæ¨¡å—ï¼Œé¦–å…ˆå°±è¦åˆ†ææºç çš„ç»“æ„ã€‚è™½ç„¶æºç å†…å®¹å¾ˆé•¿å¾ˆå¤æ‚ï¼Œä½†ä¸‡å¹¸çš„æ˜¯å®ƒè¿˜æ˜¯æœ‰ä¸€ä¸ªæ¸…æ™°çš„ç»“æ„ï¼Œç®€åŒ–ä¸€ä¸‹ï¼Œå°±æ˜¯ä¸‹é¢è¿™ç§å½¢å¼ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾2.png" alt="å›¾"></p><p>å¾ˆå®¹æ˜“çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ç§ ES5 æ—¶ä»£çš„ç»å…¸ä»£ç ç»„ç»‡æ–¹å¼ï¼Œåœ¨ä¸€ä¸ª IIFE é‡Œé¢æ”¾ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°çš„ <code>protorype</code> ä¸ŠæŒ‚è½½ä¸åŒçš„æ–¹æ³•ï¼Œä»¥å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚æ—¢ç„¶ä»£ç ç»“æ„æ˜¯æ¸…æ™°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦åšæ¨¡å—åŒ–çš„æ€è·¯ä¹Ÿå¾ˆæ¸…æ™°ï¼Œå°±æ˜¯æƒ³åŠæ³•æŠŠæ‰€æœ‰ç»‘å®šåœ¨æ„é€ å‡½æ•°çš„ <code>prototype</code> ä¸Šçš„æ–¹æ³•æŠ½ç¦»å‡ºæ¥ï¼Œä»¥æ¨¡å—æ–‡ä»¶çš„å½¢å¼æ”¾ç½®ï¼Œè€Œæºç åˆ™ä½¿ç”¨ ES6 çš„ <code>import</code> è¯­å¥æŠŠæ¨¡å—å¼•å…¥è¿›æ¥ï¼Œå®Œæˆä»£ç çš„æ¨¡å—åŒ–ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾3.png" alt="å›¾"></p><p>ä¸ºäº†å®Œæˆè¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© <code>@babel</code> å…¨å®¶æ¡¶æ¥æ„é€ æˆ‘ä»¬çš„è½¬åŒ–è„šæœ¬ã€‚</p><h2 id="åˆ©ç”¨ASTåˆ†æä»£ç ç»“æ„"><a href="#åˆ©ç”¨ASTåˆ†æä»£ç ç»“æ„" class="headerlink" title="åˆ©ç”¨ASTåˆ†æä»£ç ç»“æ„"></a>åˆ©ç”¨ASTåˆ†æä»£ç ç»“æ„</h2><p>å…³äº AST çš„ç›¸å…³èµ„æ–™ä¸€æœä¸€å¤§å †ï¼Œåœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šå€ŸåŠ© AST å»åˆ†ææºç ï¼ŒæŒ‘é€‰æºç ä¸­éœ€è¦è¢«æŠ½ç¦»ã€æ”¹é€ çš„éƒ¨åˆ†ï¼Œå› æ­¤ AST å¯ä»¥è¯´æ˜¯æœ¬æ–‡çš„æ ¸å¿ƒã€‚åœ¨ <a href="https://astexplorer.net/" target="_blank" rel="noopener">https://astexplorer.net/</a> è¿™ä¸ªç½‘ç«™ï¼Œæˆ‘ä»¬å¯ä»¥è´´å…¥ç¤ºä¾‹ä»£ç ï¼Œåœ¨çº¿æŸ¥çœ‹å®ƒçš„ AST é•¿ä»€ä¹ˆæ ·ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾4.png" alt="å›¾"></p><p>ä»å³ä¾§çš„ AST æ ‘ä¸­å¯ä»¥å¾ˆæ¸…æ™°åœ°çœ‹åˆ°ï¼Œ <code>Demo.prototype.func=function(){}</code> å±äº <code>AssignmentExpression</code> èŠ‚ç‚¹ï¼Œå³ä¸ºâ€œèµ‹å€¼è¯­å¥â€ï¼Œæ‹¥æœ‰å·¦å³ä¸¤ä¸ªä¸åŒçš„èŠ‚ç‚¹ï¼ˆ <code>left</code>ï¼Œ <code>right</code>ï¼‰ã€‚</p><p>ç”±äºä¸€æ®µ JS ä»£ç é‡Œå¯èƒ½å­˜åœ¨å¤šç§èµ‹å€¼è¯­å¥ï¼Œè€Œæˆ‘ä»¬åªæƒ³å¤„ç†å½¢å¦‚ <code>Demo.prototype.func=function(){}</code> çš„æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»§ç»­å¯¹å…¶å·¦å³ä¸¤ä¾§çš„èŠ‚ç‚¹è¿›è¡Œæ·±å…¥åˆ†æã€‚</p><p>é¦–å…ˆçœ‹å·¦ä¾§çš„èŠ‚ç‚¹ï¼Œå®ƒå±äºä¸€ä¸ªâ€œMemberExpressionâ€ï¼Œå…¶ç‰¹å¾å¦‚ä¸‹å›¾ç®­å¤´æ‰€ç¤ºï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾5.png" alt="å›¾"></p><p>å¯¹äºå·¦ä¾§çš„èŠ‚ç‚¹ï¼Œåªè¦å®ƒçš„ <code>object.property.name</code> çš„å€¼ä¸º <code>prototype</code> å³å¯ï¼Œé‚£ä¹ˆå¯¹åº”çš„å‡½æ•°åå°±æ˜¯è¯¥èŠ‚ç‚¹çš„ <code>property.name</code>ã€‚</p><p>æ¥ç€çœ‹å³ä¾§çš„èŠ‚ç‚¹ï¼Œå®ƒå±äºä¸€ä¸ªâ€œFunctionExpressionâ€ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾6.png" alt="å›¾"></p><p>æˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯æŠŠå®ƒæå–å‡ºæ¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ã€‚</p><p>åˆ†æå®Œäº† AST ä»¥åï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“éœ€è¦è¢«å¤„ç†çš„ä»£ç éƒ½æœ‰ä¸€äº›ä»€ä¹ˆæ ·çš„ç‰¹å¾ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é’ˆå¯¹è¿™äº›ç‰¹å¾è¿›è¡Œæ“ä½œäº†ï¼Œè¿™æ—¶å€™å°±éœ€è¦æˆ‘ä»¬çš„ <code>@babel</code> å…¨å®¶æ¡¶å‡ºåœºäº†ï¼</p><h2 id="å¤„ç†ä»£ç "><a href="#å¤„ç†ä»£ç " class="headerlink" title="å¤„ç†ä»£ç "></a>å¤„ç†ä»£ç </h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…å››ä¸ªå·¥å…·ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š</p><ul><li><code>@babel/parser</code>ï¼šç”¨äºæŠŠ JS æºç è½¬åŒ–æˆ ASTï¼›</li><li><code>@babel/traverse</code>ï¼šç”¨äºéå† AST æ ‘ï¼Œè·å–å½“ä¸­çš„èŠ‚ç‚¹å†…å®¹ï¼›</li><li><code>@babel/generator</code>ï¼šæŠŠ AST èŠ‚ç‚¹è½¬åŒ–æˆå¯¹åº”çš„ JS ä»£ç ï¼›</li><li><code>@babel/types</code>ï¼šæ–°å»º AST èŠ‚ç‚¹ã€‚</li></ul><p>æ¥ä¸‹æ¥æ–°å»ºä¸€ä¸ª <code>index.js</code> æ–‡ä»¶ï¼Œå¼•å…¥ä¸Šé¢å››ä¸ªå·¥å…·ï¼Œå¹¶è®¾æ³•åŠ è½½æˆ‘ä»¬çš„æºç ï¼ˆæºç ä¸º <code>demo/es5code.js</code>ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</span><br><span class="line">&#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>),</span><br><span class="line">      parser = <span class="built_in">require</span>(<span class="string">'@babel/parser'</span>),</span><br><span class="line">traverse = <span class="built_in">require</span>(<span class="string">'@babel/traverse'</span>).defaultconst, </span><br><span class="line">      generator = <span class="built_in">require</span>(<span class="string">'@babel/generator'</span>).defaultconst, </span><br><span class="line">      t = <span class="built_in">require</span>(<span class="string">'@babel/types'</span>);</span><br><span class="line"><span class="keyword">const</span> INPUT_CODE = resolve(__dirname, <span class="string">'../demo/es5code.js'</span>);</span><br><span class="line"><span class="keyword">const</span> code = fs.readFileSync(<span class="string">`<span class="subst">$&#123;INPUT_CODE&#125;</span>`</span>, <span class="string">'utf-8'</span>);</span><br></pre></td></tr></table></figure><p>æ¥ç€ä½¿ç”¨ <code>@babel/parser</code> è·å–æºç çš„ ASTï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ast = parser.parse(code)</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ° AST ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>@babel/traverse</code> æ¥éå†å®ƒçš„èŠ‚ç‚¹ã€‚ä»ä¸Šä¸€èŠ‚çš„ AST åˆ†æå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨â€œAssignmentExpressionâ€èŠ‚ç‚¹å³å¯ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">traverse(ast, &#123;  AssignmentExpression (&#123; node &#125;) &#123;    <span class="comment">/* ... */</span>  &#125;&#125;)</span><br></pre></td></tr></table></figure><p>å½“å‰èŠ‚ç‚¹å³ä¸ºå‚æ•° <code>node</code>ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æå®ƒå·¦å³ä¸¤ä¾§çš„èŠ‚ç‚¹ã€‚åªæœ‰å½“å·¦ä¾§èŠ‚ç‚¹çš„ç±»å‹ä¸ºâ€œMemberExpressionâ€ä¸”å³ä¾§èŠ‚ç‚¹çš„ç±»å‹ä¸ºâ€œFunctionExpressionâ€æ‰éœ€è¦è¿›å…¥ä¸‹ä¸€æ­¥åˆ†æï¼ˆå› ä¸ºå½¢å¦‚ <code>a=1</code> ä¹‹ç±»çš„èŠ‚ç‚¹ä¹Ÿå±äº AssignmentExpression ç±»å‹ï¼Œä¸åœ¨æˆ‘ä»¬çš„å¤„ç†èŒƒå›´å†…ï¼‰ã€‚</p><p>ç”±äº JS ä¸­å¯èƒ½å­˜åœ¨ä¸åŒçš„ MemberExpression èŠ‚ç‚¹ï¼Œå¦‚ <code>a.b.c=function(){}</code>ï¼Œä½†æˆ‘ä»¬ç°åœ¨åªéœ€è¦å¤„ç† <code>a.prototype.func</code> çš„æƒ…å†µï¼Œæ„å‘³ç€è¦ç›¯ç€å…³é”®å­— <code>prototype</code>ã€‚é€šè¿‡åˆ†æ AST èŠ‚ç‚¹ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå…³é”®å­—ä½äºå·¦ä¾§èŠ‚ç‚¹çš„ <code>object.property.name</code> å±æ€§ä¸­ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾7.png" alt="å›¾"></p><p>åŒæ—¶å¯¹åº”çš„å‡½æ•°ååˆ™è—åœ¨å·¦ä¾§èŠ‚ç‚¹çš„ <code>property.name</code> å±æ€§ä¸­ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾8.png" alt="å›¾"></p><p>å› æ­¤ä¾¿å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æå–å‡º<strong>æ–¹æ³•å</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">traverse(ast, &#123; </span><br><span class="line">    AssignmentExpression(&#123; node &#125;) &#123; </span><br><span class="line">        <span class="keyword">const</span> &#123; left, right &#125; = node; </span><br><span class="line">        <span class="keyword">if</span> (left.type === <span class="string">'MemberExpression'</span> &amp;&amp; right.type === <span class="string">'FunctionExpression'</span>) &#123; </span><br><span class="line">            <span class="keyword">const</span> &#123; object, property &#125; = left; </span><br><span class="line">            <span class="keyword">if</span> (object.property.name === <span class="string">'prototype'</span>) &#123; </span><br><span class="line">                <span class="keyword">const</span> funcName = property.name; </span><br><span class="line">                <span class="built_in">console</span>.log(funcName) </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æŠŠæ–¹æ³•åæ‰“å°å‡ºæ¥æ£€æŸ¥ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾9.png" alt="å›¾"></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»åˆ†æå®Œå·¦ä¾§èŠ‚ç‚¹çš„ä»£ç ï¼Œæå–å‡ºäº†æ–¹æ³•åã€‚æ¥ä¸‹æ¥åˆ™æ˜¯å¤„ç†å³ä¾§èŠ‚ç‚¹ã€‚ç”±äºå³ä¾§ä»£ç ç›´æ¥å°±æ˜¯ä¸€ä¸ª FunctionExpression èŠ‚ç‚¹ï¼Œå› æ­¤æˆ‘ä»¬è¦åšçš„å°±æ˜¯é€šè¿‡ <code>@babel/generator</code> æŠŠè¯¥èŠ‚ç‚¹è½¬åŒ–æˆ JS ä»£ç ï¼Œå¹¶å†™å…¥æ–‡ä»¶ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬ä¹Ÿè¦æŠŠåŸæ¥çš„ä»£ç ä» <code>Demo.prototype.func=function(){}</code> è½¬åŒ–æˆ <code>Demo.prototype.func=func</code> çš„å½¢å¼ï¼Œå› æ­¤å³ä¾§çš„èŠ‚ç‚¹éœ€è¦ä»â€œFuncitionExpressionâ€ç±»å‹è½¬åŒ–æˆâ€œIdentifierâ€ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© <code>@babel/types</code> æ¥å¤„ç†ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªäº‹æƒ…åˆ«å¿˜äº†ï¼Œå°±æ˜¯æˆ‘ä»¬å·²ç»æŠŠå³ä¾§èŠ‚ç‚¹çš„ä»£ç æŠ½ç¦»æˆäº† JS æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿåº”è¯¥åœ¨æœ€ç»ˆæ”¹é€ å®Œçš„æºæ–‡ä»¶é‡ŒæŠŠå®ƒä»¬ç»™å¼•å…¥è¿›æ¥ï¼Œå½¢å¦‚ <code>importfunc1from&#39;./func1&#39;</code>è¿™ç§å½¢å¼ï¼Œå› æ­¤å¯ä»¥ç»§ç»­ä½¿ç”¨ <code>@babel/types</code> çš„ <code>importDeclaration()</code> å‡½æ•°æ¥ç”Ÿæˆå¯¹åº”çš„ä»£ç ã€‚è¿™ä¸ªå‡½æ•°å‚æ•°æ¯”è¾ƒå¤æ‚ï¼Œå¯ä»¥å°è£…æˆä¸€ä¸ªå‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createImportDeclaration</span>(<span class="params">funcName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t.importDeclaration(</span><br><span class="line">        [t.importDefaultSpecifier(t.identifier(funcName))], </span><br><span class="line">        t.stringLiteral(<span class="string">`./<span class="subst">$&#123;funcName&#125;</span>`</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€è¦ä¼ å…¥ä¸€ä¸ª <code>funcName</code>ï¼Œå°±å¯ä»¥ç”Ÿæˆä¸€æ®µ <code>importfuncNamefrom&#39;./funcName&#39;</code> ä»£ç ã€‚</p><p>æœ€ç»ˆæ•´ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>),</span><br><span class="line">    &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>),</span><br><span class="line">    parser = <span class="built_in">require</span>(<span class="string">'@babel/parser'</span>),</span><br><span class="line">    traverse = <span class="built_in">require</span>(<span class="string">'@babel/traverse'</span>).defaultconst,</span><br><span class="line">    generator = <span class="built_in">require</span>(<span class="string">'@babel/generator'</span>).defaultconst,</span><br><span class="line">    t = <span class="built_in">require</span>(<span class="string">'@babel/types'</span>);</span><br><span class="line"><span class="keyword">const</span> INPUT_CODE = resolve(__dirname, <span class="string">'../demo/es5code.js'</span>);</span><br><span class="line"><span class="keyword">const</span> code = fs.readFileSync(<span class="string">`<span class="subst">$&#123;INPUT_CODE&#125;</span>`</span>, <span class="string">'utf-8'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span>(<span class="params">filename, code</span>) </span>&#123; </span><br><span class="line">    fs.writeFileSync(<span class="string">`<span class="subst">$&#123;OUTPUT_FOLDER&#125;</span>/<span class="subst">$&#123;filename&#125;</span>.js`</span>, code, <span class="string">'utf-8'</span>) ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createImportDeclaration</span>(<span class="params">funcName</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> t.importDeclaration(</span><br><span class="line">        [t.importDefaultSpecifier(t.identifier(funcName))], t.stringLiteral(<span class="string">`./<span class="subst">$&#123;funcName&#125;</span>`</span>)</span><br><span class="line">    ); </span><br><span class="line">&#125;</span><br><span class="line">traverse(ast, &#123;</span><br><span class="line">    AssignmentExpression(&#123; node &#125;) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; left, right &#125; = node; <span class="keyword">if</span> (left.type === <span class="string">'MemberExpression'</span> &amp;&amp; right.type === <span class="string">'FunctionExpression'</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; object, property &#125; = left; <span class="keyword">if</span> (object.property.name === <span class="string">'prototype'</span>) &#123;            <span class="comment">// è·å–å·¦ä¾§èŠ‚ç‚¹çš„æ–¹æ³•å</span></span><br><span class="line">                <span class="keyword">const</span> funcName = property.name;</span><br><span class="line">                <span class="comment">// è·å–å³ä¾§èŠ‚ç‚¹å¯¹åº”çš„ JS ä»£ç         </span></span><br><span class="line">                <span class="keyword">const</span> &#123; <span class="attr">code</span>: funcCode &#125; = generator(right);</span><br><span class="line">                <span class="comment">// å³ä¾§èŠ‚ç‚¹æ”¹ä¸º Identifier        </span></span><br><span class="line">                <span class="keyword">const</span> replacedNode = t.identifier(funcName);</span><br><span class="line">                node.right = replacedNode</span><br><span class="line">                <span class="comment">// å€ŸåŠ© `fs.writeFileSync()` æŠŠå³ä¾§èŠ‚ç‚¹çš„ JS ä»£ç å†™å…¥å¤–éƒ¨æ–‡ä»¶        </span></span><br><span class="line">                createFile(funcName, <span class="string">'export default '</span> + funcCode);</span><br><span class="line">                <span class="comment">// åœ¨æ–‡ä»¶å¤´éƒ¨å¼•å…¥æŠ½ç¦»çš„æ–‡ä»¶        </span></span><br><span class="line">                ast.program.body.unshift(createImportDeclaration(funcName))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œè„šæœ¬"><a href="#è¿è¡Œè„šæœ¬" class="headerlink" title="è¿è¡Œè„šæœ¬"></a>è¿è¡Œè„šæœ¬</h2><p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®ç›®å½•ä¸­ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">.â”œâ”€â”€</span> <span class="string">demoâ”‚</span>   <span class="string">â””â”€â”€</span> <span class="string">es5code.jsâ”œâ”€â”€</span> <span class="string">outputâ”œâ”€â”€</span> <span class="string">package.jsonâ””â”€â”€</span> <span class="string">src</span>    <span class="string">â””â”€â”€</span> <span class="string">index.js</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬ï¼Œ <code>demo/es5code.js</code> çš„ä»£ç å°†ä¼šè¢«å¤„ç†ï¼Œç„¶åè¾“å‡ºåˆ° <code>output</code> ç›®å½•ï¼š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">.â”œâ”€â”€</span> <span class="string">demoâ”‚</span>   <span class="string">â””â”€â”€</span> <span class="string">es5code.jsâ”œâ”€â”€</span> <span class="string">outputâ”‚</span>   <span class="string">â”œâ”€â”€</span> <span class="string">es6code.jsâ”‚</span>   <span class="string">â”œâ”€â”€</span> <span class="string">func1.jsâ”‚</span>   <span class="string">â”œâ”€â”€</span> <span class="string">func2.jsâ”‚</span>   <span class="string">â””â”€â”€</span> <span class="string">func3.jsâ”œâ”€â”€</span> <span class="string">package.jsonâ””â”€â”€</span> <span class="string">src</span>    <span class="string">â””â”€â”€</span> <span class="string">index.js</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œå‰åä»£ç ï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾10.png" alt="å›¾"></p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾11.png" alt="å›¾"></p><p>å¤§åŠŸå‘Šæˆï¼æŠŠè„šæœ¬è¿ç”¨åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œç”šè‡³å¯ä»¥å‘ç°åŸæ¥çš„çº¦ 3000 è¡Œä»£ç ï¼Œå·²ç»è¢«æ•´ç†æˆäº† 300 å¤šè¡Œï¼š</p><p><img src="/BeCoderQ.github.io/2021/04/24/å€ŸåŠ©babelçš„ASTè§£æï¼Œè®©è€ä»£ç é‡è·æ–°ç”Ÿ-è½¬è½½/å›¾12.png" alt="å›¾"></p><p>æ”¾åˆ°çœŸå®ç¯å¢ƒå»è·‘ä¸€éè¿™æ®µä»£ç ï¼ŒåŸæœ‰åŠŸèƒ½ä¸å—å½±å“ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜&quot;&gt;&lt;a href=&quot;#é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜&quot;&gt;&lt;/a&gt;é—®é¢˜&lt;/h2&gt;&lt;p&gt;åœ¨æœ€è¿‘çš„å·¥ä½œä¸­ï¼Œæ¥æ‰‹äº†ä¸€ä¸ªå¤è€çš„é¡¹ç›®ï¼Œå…¶ä¸­çš„ JS ä»£ç æ˜¯ä¸€æ•´å¨çš„é¢æ¡ä»£ç ï¼Œçº¦ 3000 è¡Œçš„ä»£ç å…¨å†™åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç»´æŠ¤èµ·æ¥ç€å®è®©äººå¤´ç–¼ã€‚&lt;
      
    
    </summary>
    
    
      <category term="å­¦ä¹ " scheme="http://localhost:4000/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="babel" scheme="http://localhost:4000/tags/babel/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹ä½¿ç”¨flutterå¼€å‘ä¸€æ¬¾æœ¬åœ°é˜…è¯»å™¨</title>
    <link href="http://localhost:4000/2021/03/03/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8flutter%E5%BC%80%E5%8F%91%E4%B8%80%E6%AC%BE%E6%9C%AC%E5%9C%B0%E9%98%85%E8%AF%BB%E5%99%A8/"/>
    <id>http://localhost:4000/2021/03/03/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8flutter%E5%BC%80%E5%8F%91%E4%B8%80%E6%AC%BE%E6%9C%AC%E5%9C%B0%E9%98%85%E8%AF%BB%E5%99%A8/</id>
    <published>2021-03-03T05:20:04.000Z</published>
    <updated>2021-03-08T02:36:06.370Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‚è°ˆ"><a href="#æ‚è°ˆ" class="headerlink" title="æ‚è°ˆ"></a>æ‚è°ˆ</h2><p>åœ¨å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™è¿™ä¸ªappå®é™…å¼€å‘æ—¶é•¿å·²ç»é›¶é›¶ç¢ç¢æœ‰åŠä¸ªå¤šæœˆäº†ï¼Œéƒ½æ˜¯åˆ©ç”¨ä¸‹ç­ä»¥åŠå‘¨æœ«çš„æ—¶é—´å¼€å‘ï¼Œç¡®å®é‡åˆ°äº†éå¸¸éå¸¸å¤šçš„é—®é¢˜ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›åˆ°ç°åœ¨(21å¹´3æœˆ3æ—¥)è¿˜æœªè§£å†³çš„ç–‘éš¾æ‚ç—‡ï¼Œè™½ç„¶æ²¡äººçœ‹ï¼Œä¸è¿‡åæœŸä¼šæŒç»­æ›´æ–°ã€‚</p><h2 id="ç”¨åˆ°çš„åº“"><a href="#ç”¨åˆ°çš„åº“" class="headerlink" title="ç”¨åˆ°çš„åº“"></a>ç”¨åˆ°çš„åº“</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">dio:</span> <span class="string">^3.0.9</span></span><br><span class="line">  <span class="attr">shared_preferences:</span> <span class="string">^0.5.12+4</span></span><br><span class="line">  <span class="attr">path_provider:</span> <span class="string">^1.6.24</span></span><br><span class="line">  <span class="attr">intl:</span> <span class="string">^0.16.1</span></span><br><span class="line">  <span class="attr">provider:</span> <span class="string">^4.3.2+3</span></span><br><span class="line">  <span class="attr">permission_handler:</span> <span class="string">^5.0.1+1</span></span><br><span class="line">  <span class="attr">gbk2utf8:</span> <span class="string">^1.0.1</span></span><br><span class="line">  <span class="attr">fluttertoast:</span> <span class="string">^7.1.6</span></span><br><span class="line">  <span class="attr">file_picker:</span> <span class="string">^2.1.4</span></span><br><span class="line">  <span class="attr">screen:</span> <span class="string">^0.0.5</span></span><br><span class="line">  <span class="attr">event_bus:</span> <span class="string">^1.1.1</span></span><br><span class="line">  <span class="attr">get_ip:</span> <span class="string">^0.4.0</span></span><br></pre></td></tr></table></figure><h2 id="æœ€åˆé‡åˆ°çš„é—®é¢˜"><a href="#æœ€åˆé‡åˆ°çš„é—®é¢˜" class="headerlink" title="æœ€åˆé‡åˆ°çš„é—®é¢˜"></a>æœ€åˆé‡åˆ°çš„é—®é¢˜</h2><p>è¿™ä¸ªé˜…è¯»å™¨æˆ‘æ„æƒ³çš„æ—¶å€™å°±åªæ‰“ç®—è§£ætxtæ–‡æœ¬ï¼Œæœ¬æƒ³txtæ–‡æœ¬è§£æåº”è¯¥å¾ˆç®€å•ï¼Œä½†å¾ˆå¿«æˆ‘ä¾¿é‡åˆ°äº†ä¸€å †é—®é¢˜ã€‚</p><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><p><img src="/BeCoderQ.github.io/2021/03/03/ä»é›¶å¼€å§‹ä½¿ç”¨flutterå¼€å‘ä¸€æ¬¾æœ¬åœ°é˜…è¯»å™¨/structure.png" alt="æ’ä»¶"></p><p>libæ–‡ä»¶ä¸­åˆ†çš„åŒ…æœ‰ç‚¹å¤šï¼Œæˆ‘æŠŠä¸€äº›é«˜æœç”¨çš„æ§ä»¶æ”¾åˆ°äº†<code>widgets</code>æ–‡ä»¶ï¼Œé¡µé¢ä»¥åŠå…¶ç›¸å…³è€¦åˆåº¦é«˜çš„æ§ä»¶æ”¾åˆ°<code>pages</code>æ–‡ä»¶å¤¹å†…ï¼Œå…¶å®åŸºæœ¬å’Œä¸»æµçš„åˆ†åŒ…å·®ä¸å¤šï¼Œæ¯”è¾ƒç‰¹æ®Šçš„æ˜¯<code>layout</code>æ–‡ä»¶å†…ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹appçš„ç•Œé¢:</p><p><img src="/BeCoderQ.github.io/2021/03/03/ä»é›¶å¼€å§‹ä½¿ç”¨flutterå¼€å‘ä¸€æ¬¾æœ¬åœ°é˜…è¯»å™¨/home.png" alt="æ’ä»¶"></p><p>å½“ç„¶è¿˜åªæ˜¯ä¸€ä¸ªdemoï¼Œä¸è¿‡ç»“æ„ç¡®å®šäº†ï¼šåº•éƒ¨çš„èˆµå¼å¯¼èˆªåˆ†åˆ«æ˜¯æœ¬åœ°ä¹¦æ¶ã€åœ¨çº¿ä¹¦åŸã€ä¸ªäººé¡µé¢ã€‚äºæ˜¯ä¹æˆ‘å°†tabbarç‹¬ç«‹å‡ºæ¥ï¼Œå°±åƒReactä¸Vueä¸­çš„åµŒå¥—è·¯ç”±(nested router)ä¸€æ ·ä½¿ç”¨ï¼Œä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/cupertino.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:simple_reader/pages/bookshelf/bookshelf_page.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:simple_reader/pages/mine/mine_page.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'package:simple_reader/pages/online/online_page.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Layout</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;StatefulWidget&gt; createState()=&gt; _LayoutState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LayoutState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">Layout</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">int</span> activePage = <span class="number">0</span>;</span><br><span class="line">PageController _pageController = PageController(initialPage: <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// åº•éƒ¨å¯¼èˆªæ </span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span>&lt;BottomNavigationBarItem&gt; bottomNavItems = [</span><br><span class="line">BottomNavigationBarItem(</span><br><span class="line">icon: Icon(Icons.offline_bolt),</span><br><span class="line">      label: <span class="string">""</span></span><br><span class="line">),</span><br><span class="line">BottomNavigationBarItem(</span><br><span class="line">icon: Icon(Icons.whatshot),</span><br><span class="line">      label: <span class="string">""</span></span><br><span class="line">),</span><br><span class="line">BottomNavigationBarItem(</span><br><span class="line">icon: Icon(Icons.person),</span><br><span class="line">label: <span class="string">""</span></span><br><span class="line">)</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ»‘åŠ¨pageViewç»„ä»¶åˆ‡æ¢é¡µé¢</span></span><br><span class="line"><span class="keyword">void</span> _onPageChange(<span class="built_in">int</span> index) &#123;</span><br><span class="line">setState(() &#123;</span><br><span class="line">activePage = index;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span> </span><br><span class="line"><span class="keyword">void</span> dispose() &#123;</span><br><span class="line">_pageController.dispose();</span><br><span class="line"><span class="keyword">super</span>.dispose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      backgroundColor: Theme.of(context).backgroundColor,</span><br><span class="line">      body: PageView(</span><br><span class="line">        children: [Bookshelf(), Online(), Mine()],</span><br><span class="line">        controller: _pageController,</span><br><span class="line">        onPageChanged: _onPageChange,</span><br><span class="line">      ),</span><br><span class="line">      bottomNavigationBar: SizedBox(</span><br><span class="line">        child: BottomNavigationBar(</span><br><span class="line">          <span class="comment">// backgroundColor: Theme.of(context).primaryColor,</span></span><br><span class="line">          backgroundColor: Colors.white,</span><br><span class="line">          items: bottomNavItems,</span><br><span class="line">          currentIndex: activePage,</span><br><span class="line">          type: BottomNavigationBarType.fixed, </span><br><span class="line">          showSelectedLabels: <span class="keyword">false</span>,</span><br><span class="line">          showUnselectedLabels: <span class="keyword">false</span>,</span><br><span class="line">          fixedColor: Colors.cyan, <span class="comment">// é€‰ä¸­çš„é¢œè‰²</span></span><br><span class="line">          onTap: (index) &#123;</span><br><span class="line">            _pageController.jumpToPage(index);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–‡æœ¬çš„ç¼–ç é—®é¢˜"><a href="#æ–‡æœ¬çš„ç¼–ç é—®é¢˜" class="headerlink" title="æ–‡æœ¬çš„ç¼–ç é—®é¢˜"></a>æ–‡æœ¬çš„ç¼–ç é—®é¢˜</h3><p>ç”¨æˆ·ä»ç½‘ç»œä¸‹è½½çš„è™½ç„¶éƒ½æ˜¯txtæ–‡æœ¬ï¼Œä½†æ˜¯ç¼–ç å´æœ‰å¯èƒ½ä¸ä¸€æ ·ï¼Œä¸­æ–‡å°è¯´æœ€å¸¸è§çš„å¯èƒ½æ˜¯utf-8ã€gbk2312ï¼Œè€ŒæŸ¥çœ‹flutterçš„æ–‡æœ¬è§£ææºç ä¼šå‘ç°å®˜æ–¹å¹¶æ²¡æœ‰æä¾›gbk2312çš„ç¼–ç è§£æï¼Œè¿™ä¹Ÿå¯¼è‡´äº†ç›´æ¥å°†Fileç±»ç›´æ¥è°ƒç”¨readAsLinesç­‰æ–¹æ³•ä¼šæœ‰ä¹±ç ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>è¿™ä¸ªé—®é¢˜å±å®æœ‰ç‚¹ç¡¬æ ¸ï¼Œä¸è¿‡å¥½åœ¨å¤§ä½¬æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œgithubä¸Šä¸€ä½å¤§ç¥è‡ªå·±å†™äº†ä¸€å¥—gbk2312çš„è§£æåº“<code>gbk2utf8</code>ï¼š<a href="https://github.com/best-flutter/gbk2utf8ã€‚" target="_blank" rel="noopener">https://github.com/best-flutter/gbk2utf8ã€‚</a></p><h3 id="è§£ææ–‡æœ¬å¯¼è‡´å¡é¡¿"><a href="#è§£ææ–‡æœ¬å¯¼è‡´å¡é¡¿" class="headerlink" title="è§£ææ–‡æœ¬å¯¼è‡´å¡é¡¿"></a>è§£ææ–‡æœ¬å¯¼è‡´å¡é¡¿</h3><p>æ¯æ¬¡ç‚¹å‡»ä¹¦ç±è¿›å…¥ï¼Œç›®å‰æ˜¯æ ¹æ®å­˜å‚¨çš„è·¯å¾„è·å–æ–‡ä»¶æ¥æŒ‰è¡Œè¯»å–ï¼š</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  lineText = <span class="keyword">await</span> file.readAsLines();</span><br><span class="line">&#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœæ–‡æœ¬ä»¥utf8è§£ç å‡ºé”™ï¼Œé‚£ä¹ˆå°±æŒ‰gbkæ ¼å¼è§£ç </span></span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">int</span>&gt; bytes = <span class="keyword">await</span> file.readAsBytes();</span><br><span class="line">  lineText = gbk.decode(bytes).split(<span class="string">"\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä¼šè·å–å…¨æ–‡æŒ‰æ¢è¡Œæ¥åˆ†å‰²ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èƒ½è½»æ¾çš„æ‹¿åˆ°ç« èŠ‚ã€‚ä¸è¿‡æ–‡ç« å¤ªé•¿äº†ï¼Œå¦‚ä¸€ç¯‡å››äº”ç™¾ä¸‡å­—çš„æ–‡ç« æ—¶ï¼Œç‚¹å‡»åæ˜æ˜¾å°±ä¼šå¡1ç§’ï¼Œè¿™ä¸ªä½¿ç”¨ä½“éªŒæ˜¯éå¸¸ç³Ÿç³•çš„ã€‚</p><p><img src="/BeCoderQ.github.io/2021/03/03/ä»é›¶å¼€å§‹ä½¿ç”¨flutterå¼€å‘ä¸€æ¬¾æœ¬åœ°é˜…è¯»å™¨/calcTime.png" alt="æ’ä»¶"></p><p>å¯ä»¥çœ‹åˆ°è§£æä¸€ä¸ª330ä¸‡å­—çš„å°è¯´éœ€è¦è€—æ—¶700msï¼Œéå¸¸è€—æ—¶ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>Dartå’ŒJavaScriptä¸€æ ·æ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€ï¼ŒåŒæ ·æ˜¯ç†Ÿæ‚‰çš„Event Loopï¼ŒMicroTaskã€‚å°±ç®—æˆ‘ä»¬ä½¿ç”¨Futureå¼‚æ­¥æ¥è§£ææ–‡æœ¬ï¼Œä»–æœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šè·‘ï¼Œå› æ­¤ä½¿ç”¨ç®€å•çš„å¼‚æ­¥æ˜¯è§£å†³ä¸äº†é—®é¢˜çš„ï¼Œé‚£ä¹ˆå°±è¦å¼•å…¥Dartä¸­çš„â€å¤šçº¿ç¨‹â€æ¦‚å¿µï¼š<code>isolate</code>:<strong>ã€ŒIsolateã€åœ¨ Flutter ä¸­å¹¶ä¸å…±äº«å†…å­˜ã€‚ä¸åŒã€ŒIsolateã€ä¹‹é—´é€šè¿‡ã€Œæ¶ˆæ¯ã€è¿›è¡Œé€šä¿¡ã€‚</strong>éœ€è¦æ³¨æ„çš„æ˜¯isolateä¼ å…¥çš„å›è°ƒå‡½æ•°å¿…é¡»æ˜¯top-levelï¼Œå³ä¸èƒ½æ˜¯classå†…éƒ¨çš„ï¼Œä½†å¯ä»¥æ˜¯é™æ€å‡½æ•°ã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ–°çº¿ç¨‹çš„å›è°ƒå‡½æ•°å¿…é¡»æ˜¯é¡¶å±‚å‡½æ•° top-level æˆ–è€…é™æ€å‡½æ•° static function of an instance</span></span><br><span class="line">Future&lt;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, ChapterTextDictionary&gt;&gt; getText(<span class="built_in">String</span> path) <span class="keyword">async</span> &#123;</span><br><span class="line">  FileToArticle fileInfo = <span class="keyword">await</span> FileOperate.getFile(path);</span><br><span class="line">  <span class="keyword">return</span> fileInfo.chapterTextDictionary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xxx</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">xxx</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// å¼€è¾Ÿå­çº¿ç¨‹è§£ææ–‡æœ¬</span></span><br><span class="line">  Future&lt;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, ChapterTextDictionary&gt;&gt; _isolateGetText() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(isLoaded) <span class="keyword">return</span> chapterTextDictionary;</span><br><span class="line">    isLoaded = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„computeå³æ˜¯isolateï¼Œåœ¨ä¸éœ€è¦å¤šä¸ªisolateé€šä¿¡æ—¶ç›´æ¥ä½¿ç”¨computeæ›´ç®€å•</span></span><br><span class="line">    <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, ChapterTextDictionary&gt; response = <span class="keyword">await</span> compute(getText, widget.book.path);</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      <span class="comment">// æ­¤ä¹¦çš„æ­£æ–‡ä¸ç« èŠ‚</span></span><br><span class="line">      chapterTextDictionary = response;</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–èœå•åˆ—è¡¨</span></span><br><span class="line">      chapterList = chapterTextDictionary.keys.toList();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// æ­£æ–‡æ€»ç« èŠ‚æ•°</span></span><br><span class="line">    widget.book.totalChapters = chapterList.length;</span><br><span class="line">    brightness = <span class="keyword">await</span> Screen.brightness;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶è§£ææ—¶é—´æ²¡å˜ ï¼Œä½†å¤§é‡çš„è§£æå·¥ä½œå·²ç»ä¸ä¼šå½±å“appçš„å…¶ä»–æ“ä½œäº†ã€‚å¯ä»¥åŠ ä¸Šä¸€ä¸ªåŠ¨ç”»æ¥æå‡ä½“éªŒã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·¯ç”±çš„ç¼©æ”¾åŠ¨ç”»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">ZoomRoute</span> <span class="keyword">extends</span> <span class="title">PageRouteBuilder</span></span>&#123;</span><br><span class="line">  <span class="keyword">final</span> Widget widget;</span><br><span class="line">   ZoomRoute(<span class="keyword">this</span>.widget):<span class="keyword">super</span>(</span><br><span class="line">    transitionDuration:<span class="built_in">Duration</span>(milliseconds: <span class="number">1500</span>),</span><br><span class="line">    pageBuilder:(</span><br><span class="line">       BuildContext context,</span><br><span class="line">        Animation&lt;<span class="built_in">double</span>&gt;animation1,</span><br><span class="line">        Animation&lt;<span class="built_in">double</span>&gt;animation2,</span><br><span class="line">    )&#123;</span><br><span class="line">      <span class="keyword">return</span> widget;</span><br><span class="line">    &#125;,</span><br><span class="line">    transitionsBuilder:(</span><br><span class="line">     BuildContext context,</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt;animation1,</span><br><span class="line">      Animation&lt;<span class="built_in">double</span>&gt;animation2,</span><br><span class="line">       Widget child</span><br><span class="line">    )&#123;</span><br><span class="line">       <span class="comment">// ç¼©æ”¾çš„æ•ˆæœ</span></span><br><span class="line">     <span class="keyword">return</span> ScaleTransition(</span><br><span class="line">        scale: Tween(</span><br><span class="line">            begin: <span class="number">0.0</span>,end: <span class="number">1.0</span>).animate(CurvedAnimation(</span><br><span class="line">            parent: animation1,</span><br><span class="line">            curve: Curves.fastOutSlowIn</span><br><span class="line">        )),</span><br><span class="line">        child: child,</span><br><span class="line">      );</span><br><span class="line">     &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªé˜…è¯»appçš„å¼€å‘è®°å½•å°†ä½œä¸ºä¸€ä¸ªç³»åˆ—æ¥å†™ï¼Œé˜…è¯»appéš¾ç‚¹å°±æ˜¯æ–‡æœ¬çš„è§£æï¼Œåˆ†é¡µè®¡ç®—ï¼Œå„ç§é˜…è¯»è®°å½•ï¼Œæœ¬æ–‡è¿˜æ²¡è®²åˆ°ï¼Œå¦å¤–å…³äºç‚¹å¼€æŸæœ¬æœ¬åœ°ä¹¦ç±åï¼Œæ˜¯å¦è¯¥æ¯æ¬¡éƒ½è§£ææ•´æœ¬ä¹¦ï¼Œæˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªå‡†ç¡®çš„ç­”æ¡ˆï¼Œå¤§é‡è§£æè€—è´¹èµ„æºï¼Œå“ªæ€•æ˜¯ä½¿ç”¨isloateï¼Œä¹Ÿæ— æ³•è§£å†³æ—¶é—´é—®é¢˜ï¼Œä½†æ˜¯ä¸è§£æå…¨æ–‡ï¼Œå½“ç”¨æˆ·é€šè¿‡ç›®å½•éšæ„è·³åŠ¨æ—¶ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿè¿™äº›é—®é¢˜åœ¨åç»­å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä¹Ÿä¼šå»ç ”ç©¶ï¼Œä¸è¿‡ç›®å‰æ¥çœ‹ä¼¼ä¹å¾ˆå¤šappéƒ½æ˜¯æ¯æ¬¡éƒ½é‡æ–°è§£æå…¨æ–‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ‚è°ˆ&quot;&gt;&lt;a href=&quot;#æ‚è°ˆ&quot; class=&quot;headerlink&quot; title=&quot;æ‚è°ˆ&quot;&gt;&lt;/a&gt;æ‚è°ˆ&lt;/h2&gt;&lt;p&gt;åœ¨å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™è¿™ä¸ªappå®é™…å¼€å‘æ—¶é•¿å·²ç»é›¶é›¶ç¢ç¢æœ‰åŠä¸ªå¤šæœˆäº†ï¼Œéƒ½æ˜¯åˆ©ç”¨ä¸‹ç­ä»¥åŠå‘¨æœ«çš„æ—¶é—´å¼€å‘ï¼Œç¡®å®é‡åˆ°äº†éå¸¸éå¸¸å¤šçš„é—®é¢˜ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›åˆ°ç°
      
    
    </summary>
    
    
      <category term="è®°å½•" scheme="http://localhost:4000/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="flutter" scheme="http://localhost:4000/tags/flutter/"/>
    
      <category term="dart" scheme="http://localhost:4000/tags/dart/"/>
    
      <category term="android" scheme="http://localhost:4000/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>typescriptæ­£ç¡®é£Ÿç”¨å§¿åŠ¿ä¹‹é›†æˆpont-engineç™½å«–åç«¯</title>
    <link href="http://localhost:4000/2021/01/01/typescript%E6%AD%A3%E7%A1%AE%E9%A3%9F%E7%94%A8%E5%A7%BF%E5%8A%BF%E4%B9%8B%E9%9B%86%E6%88%90pont-engine%E7%99%BD%E5%AB%96%E5%90%8E%E7%AB%AF/"/>
    <id>http://localhost:4000/2021/01/01/typescript%E6%AD%A3%E7%A1%AE%E9%A3%9F%E7%94%A8%E5%A7%BF%E5%8A%BF%E4%B9%8B%E9%9B%86%E6%88%90pont-engine%E7%99%BD%E5%AB%96%E5%90%8E%E7%AB%AF/</id>
    <published>2021-01-01T06:53:25.000Z</published>
    <updated>2021-03-08T02:38:48.198Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é¡¹ç›®ç¯å¢ƒä»‹ç»"><a href="#é¡¹ç›®ç¯å¢ƒä»‹ç»" class="headerlink" title="é¡¹ç›®ç¯å¢ƒä»‹ç»"></a>é¡¹ç›®ç¯å¢ƒä»‹ç»</h2><p>å…¬å¸é¡¹ç›®å…¨çº¿ä¸Šäº†vue3ï¼Œå› æ­¤å‰ç«¯æ¡†æ¶è¿˜æ˜¯vue3ï¼Œè„šæ‰‹æ¶ç”±viteæ”¹å›äº†vue.cli4ï¼ŒåŸå› è¿˜æ˜¯éƒ¨åˆ†åº“çš„å…¼å®¹æ€§é—®é¢˜â•æ‰“åŒ…åçš„ä¸€äº›å¤§å¤§å°å°çš„é—®é¢˜ã€‚ä¸»è¦çš„æŠ€æœ¯æ ˆå¦‚ä¸‹</p><ul><li><p>Vue 3.x</p></li><li><p>Typescript 4.0.5</p></li><li><p>Vuex 4.x</p></li><li><p>VueRouter 4.x</p></li><li><p>ç«¯åˆ°ç«¯æµ‹è¯•å·¥å…·Cypress</p></li><li><p>Swaggeræ¥å£ç”Ÿæˆå·¥å…·pont-engineã€‚</p></li></ul><h2 id="Pont-engine"><a href="#Pont-engine" class="headerlink" title="Pont-engine"></a>Pont-engine</h2><p>Pont-engineæ˜¯é˜¿é‡Œå‡ºçš„ä¸€ä¸ªè§£å†³å‰åç«¯æ•°æ®æœåŠ¡å±‚çš„ä¸€ä¸ªåº“ï¼Œä»“åº“åœ°å€: <a href="https://github.com/alibaba/pont" target="_blank" rel="noopener">https://github.com/alibaba/pont</a>  è¿™ä¸ªåº“çš„åŸç†å®é™…å°±æ˜¯çˆ¬å–swaggerçš„æ•°æ®ç„¶åç”Ÿæˆå‰ç«¯çš„æ¥å£ï¼Œå¹¶ä¸”æ”¯æŒé«˜åº¦è‡ªå®šä¹‰ï¼Œè€Œä¸”ä»–çš„æºç éå¸¸æ˜“è¯»ï¼Œå¯ä»¥è¯´èƒ½å®ç°ç»ç»ç»å¤§å¤šæ•°çš„é¡¹ç›®éœ€æ±‚ã€‚å½“ç„¶å‰ææ˜¯åç«¯çš„åŒå­¦å¿…é¡»ç”¨swaggerï¼Œå…·ä½“ç»†èŠ‚å¯ä»¥çœ‹ä»“åº“ä»‹ç»ï¼Œè¿™é‡Œæˆ‘åªè¯´ä¸€ä¸‹å®‰è£…æµç¨‹å’Œæˆ‘çš„å°è£…ã€‚</p><h2 id="ä½¿ç”¨Pont"><a href="#ä½¿ç”¨Pont" class="headerlink" title="ä½¿ç”¨Pont"></a>ä½¿ç”¨Pont</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>æˆ‘æ˜¯ä½¿ç”¨çš„npmç®¡ç†åŒ…ï¼Œæ‰€ä»¥é¦–å…ˆå…¨å±€å®‰è£…pont: <code>npm i -g pont-engine</code></p><p>æ¥ä¸‹æ¥å¦‚æœä½ ä½¿ç”¨çš„vscode é‚£ä¹ˆå°±éå¸¸ç®€å•äº†ï¼Œç›´æ¥åœ¨æ’ä»¶å•†åŸæœpontï¼Œå®‰è£…ä¹‹ååº•éƒ¨å°±ä¼šæœ‰å¦‚ä¸‹é€‰é¡¹</p><p><img src="/BeCoderQ.github.io/2021/01/01/typescriptæ­£ç¡®é£Ÿç”¨å§¿åŠ¿ä¹‹é›†æˆpont-engineç™½å«–åç«¯/plugin.png" alt="æ’ä»¶"></p><ul><li><p>sync: é‡æ–°è¯·æ±‚è¿œç¨‹æ¥å£æ•°æ®ï¼Œé‡æ–°è®¡ç®—æœ¬åœ°æ¥å£æ•°æ®å’Œè¿œç¨‹æ¥å£æ•°æ®åœ¨æ¥å£æ¨¡å—å’Œæ¥å£è¿”å›å¯¹è±¡ï¼ˆåŸºç±»ï¼‰ä¸Šçš„å·®å¼‚ã€‚</p></li><li><p>all: å°†æœ¬åœ°æ‰€æœ‰æ¥å£æ¨¡å—ã€æ¥å£è¿”å›å¯¹è±¡ä¸è¿œç¨‹å·²æ›´æ–°æ•°æ®ä¿æŒä¸€è‡´ã€‚</p></li><li><p>mod: é€‰æ‹©å¹¶åŒæ­¥æœ¬åœ°æ¥å£æ¨¡å—ï¼Œä¸è¿œç¨‹æ¥å£æ•°æ®ä¿æŒä¸€è‡´ã€‚ç‚¹å‡»æ’ä»¶çš„ mod(å·®å¼‚é‡) åï¼Œæ’ä»¶å°†æ˜¾ç¤ºæœ¬åœ°ä¸è¿œç¨‹æ•°æ®æœ‰å·®å¼‚çš„æ¨¡å—</p></li><li><p>bo: é€‰æ‹©å¹¶åŒæ­¥æœ¬åœ°åŸºç±»ï¼Œä¸è¿œç¨‹æ¥å£æ•°æ®ä¿æŒä¸€è‡´ã€‚ç‚¹å‡»æ’ä»¶çš„ bo(å·®å¼‚é‡) åï¼Œæ’ä»¶å°†æ˜¾ç¤ºæœ¬åœ°ä¸è¿œç¨‹æ•°æ®æœ‰å·®å¼‚çš„åŸºç±»</p></li><li><p>generate: ä»¥æœ¬åœ°æ¥å£æ¨¡å—ã€åŸºç±»ç”Ÿæˆæ¥å£å±‚ä»£ç ã€‚</p></li></ul><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>æœ‰å‡ ä¸ªé‡è¦çš„æ–‡ä»¶ï¼š</p><p><img src="/BeCoderQ.github.io/2021/01/01/typescriptæ­£ç¡®é£Ÿç”¨å§¿åŠ¿ä¹‹é›†æˆpont-engineç™½å«–åç«¯/config.png" alt="æ’ä»¶"></p><ul><li>pont-config.jsonä¸­é…ç½®åŸºæœ¬çš„ä¿¡æ¯ï¼Œå¦‚çˆ¬å–swaggeræ¥å£æ–‡ä»¶çš„åœ°å€ï¼Œä½ çš„æ¨¡æ¿æ–‡ä»¶çš„ä½ç½®ï¼Œç”Ÿæˆçš„ä»£ç çš„ä½ç½®</li><li>pont-template.tsæ˜¯ä½ è‡ªå®šä¹‰ç”Ÿäº§ä»£ç çš„æ¨¡æ¿æ–‡ä»¶ï¼Œåç§°å½“ç„¶æ˜¯å¯ä»¥è‡ªå·±éšä¾¿å–çš„ï¼Œä¸è¿‡è®°å¾—åœ¨configæ–‡ä»¶ä¸­åŒæ­¥</li><li>pont-transformè¿™ä¸ªæ–‡ä»¶ä¼šåœ¨è½¬æ¢jsonå‰è°ƒç”¨é‡Œé¢çš„å›è°ƒï¼Œå…·ä½“ä½¿ç”¨å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</li></ul><h3 id="ç”Ÿæˆä»£ç çš„ç›®å½•"><a href="#ç”Ÿæˆä»£ç çš„ç›®å½•" class="headerlink" title="ç”Ÿæˆä»£ç çš„ç›®å½•"></a>ç”Ÿæˆä»£ç çš„ç›®å½•</h3><p><img src="/BeCoderQ.github.io/2021/01/01/typescriptæ­£ç¡®é£Ÿç”¨å§¿åŠ¿ä¹‹é›†æˆpont-engineç™½å«–åç«¯/apitree.png" alt="apiç›®å½•"></p><p>modsä»£è¡¨modelsï¼Œè¿™äº›å…¶å®æ˜¯åç«¯çš„åŒå­¦åˆ†çš„ï¼Œå‡ ä¸ªindex.tsä½œä¸ºå¯¼å‡ºçš„æ–‡ä»¶ã€‚api.d.tsä¸­æœ‰ä¾›å…¨å±€ä½¿ç”¨çš„ç±»å‹ã€‚è°ƒç”¨æ–¹å¼<code>defs.xxx</code></p><p>å®é™…ä¸Šå®˜æ–¹é»˜è®¤ä½ ä¼šç”¨<code>API.è¯·æ±‚Library.æ¨¡å—.æ¨¡å—è¯·æ±‚å‡½æ•°</code>æ¥å‘èµ·è¯·æ±‚ï¼Œä½†è¯´å®è¯æˆ‘æ„Ÿè§‰å¤ªé•¿äº†ï¼Œç‚¹äº†ä¸€å¤§å †ï¼Œå› æ­¤æˆ‘çš„ä½¿ç”¨æ˜¯æŠŠæ‰€æœ‰æ¨¡å—å…¨éƒ¨æ‹†å¼€æŒ‰éœ€å¯¼å…¥ç„¶åç›´æ¥<code>æ¨¡å—.userInfoRequest()</code>è¿™æ ·å‘èµ·è¯·æ±‚ã€‚</p><h2 id="é…ç½®æ¨¡æ¿ä»£ç "><a href="#é…ç½®æ¨¡æ¿ä»£ç " class="headerlink" title="é…ç½®æ¨¡æ¿ä»£ç "></a>é…ç½®æ¨¡æ¿ä»£ç </h2><p>è¿™ä¸€æ­¥å…¶å®æ‰æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºæ¯ä¸ªäººæ¯ä¸ªå…¬å¸é¡¹ç›®ç»“æ„éœ€æ±‚éƒ½ä¸åŒï¼Œæ¥å£è¯·æ±‚çš„æ–¹å¼ä¹Ÿæ˜¯â€œåƒå¥‡ç™¾æ€ªâ€ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­ç»§æ‰¿pontæš´éœ²å‡ºæ¥çš„<code>CodeGenerator</code>ç±»æ¥é‡å†™ä¸€äº›ç”Ÿæˆä»£ç çš„å‡½æ•°ï¼Œä¸‹é¢ä¼šä»‹ç»å‡ ä¸ªå®˜æ–¹æ²¡æœ‰è¯¦ç»†è¯´æ˜ï¼Œä½†å¾ˆé‡è¦çš„åŸºç±»å‡½æ•°ã€‚</p><h3 id="getInterfaceContentå‡½æ•°"><a href="#getInterfaceContentå‡½æ•°" class="headerlink" title="getInterfaceContentå‡½æ•°"></a>getInterfaceContentå‡½æ•°</h3><p>è¿™ä¸ªå½“ç„¶ä¸å±äºå®˜æ–¹æ²¡æœ‰ä»‹ç»çš„å‡½æ•°ï¼Œè¿™ä¸ªåœ¨å®˜ç½‘çš„demoä¸­æœ‰ï¼Œæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä»–è¿”å›çš„æ¨¡æ¿å­—ç¬¦ä¸²ä¼šç”Ÿæˆæ¯ä¸ªè¯·æ±‚å‡½æ•°ã€‚<strong>æœ‰ä¸€ä¸ªå›è°ƒå‚æ•°interfaceï¼Œè¿™ä¸ªå¯¹è±¡èƒ½æ‹¿åˆ°è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å‚æ•°ç­‰é‡è¦æ•°æ®</strong>ã€‚</p><h3 id="getModIndexå‡½æ•°"><a href="#getModIndexå‡½æ•°" class="headerlink" title="getModIndexå‡½æ•°"></a>getModIndexå‡½æ•°</h3><p>è¿™ä¸ªå‡½æ•°æ˜¯é‡å†™ä¸Šé¢modsç›®å½•ä¸‹æ¯ä¸ªæ¨¡å—çš„å¯¼å‡ºæ–¹å¼ï¼Œåˆä¸€ä¸ªå›è°ƒå‚æ•°<code>mod</code>ï¼Œå¯ä»¥è·å–åˆ°è¿™ä¸ªæ¨¡å—ä¸‹æŸä¸ªè¯·æ±‚çš„å„ç§ä¿¡æ¯ã€‚</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> MyGenerator <span class="keyword">extends</span> CodeGenerator &#123;</span><br><span class="line"><span class="comment">/* å…¶ä»–ä»£ç  */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**@override é‡å†™é‡Œå±‚Modså¯¼å‡ºæ¨¡æ¿,æ”¯æŒç›´æ¥è¿”å›è¯·æ±‚å‡½æ•°*/</span></span><br><span class="line">  getModIndex(mod: <span class="built_in">any</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                  /**</span></span><br><span class="line"><span class="string">                  * @description <span class="subst">$&#123;mod.description&#125;</span></span></span><br><span class="line"><span class="string">                  */</span></span><br><span class="line"><span class="string">                  <span class="subst">$&#123;mod.interfaces.map((inters: Interface) =&gt; &#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">                      <span class="keyword">return</span> <span class="string">`import * as <span class="subst">$&#123;inters.name&#125;</span> from './<span class="subst">$&#123;inters.name&#125;</span>';`</span>;</span></span></span><br><span class="line"><span class="string"><span class="subst">                  &#125;</span>).join('\n')&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                  <span class="subst">$&#123;mod.interfaces.map(</span></span></span><br><span class="line"><span class="string"><span class="subst">                      (inters: Interface) =&gt; <span class="string">`export const <span class="subst">$&#123;inters.name&#125;</span>Request = <span class="subst">$&#123;inters.name&#125;</span>.request;`</span></span></span></span><br><span class="line"><span class="string"><span class="subst">                  ).join(<span class="string">'; \n'</span>)&#125;</span></span></span><br><span class="line"><span class="string">              `</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘é‡å†™äº†å¯¼å‡ºæ–¹å¼ï¼Œæœ€åä¸€ä¸ªæ¨¡å—ä¸‹çš„index.tså¯¼å‡ºæ–‡ä»¶ä¼šå˜æˆå¦‚ä¸‹å½¢å¼</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @description ç”¨æˆ·ç®¡ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> getUser <span class="keyword">from</span> <span class="string">'./getUser'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> listUsers <span class="keyword">from</span> <span class="string">'./listUsers'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> login <span class="keyword">from</span> <span class="string">'./login'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserRequest = getUser.request;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> listUsersRequest = listUsers.request;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> loginRequest = login.request;</span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œè¿™æ ·çš„è¯ä½¿ç”¨å°±éå¸¸ç®€æ´äº†ï¼š<code>æ¨¡å—å.getUserRequest()</code></p><h3 id="getInterfaceContentInDeclarationå‡½æ•°"><a href="#getInterfaceContentInDeclarationå‡½æ•°" class="headerlink" title="getInterfaceContentInDeclarationå‡½æ•°"></a>getInterfaceContentInDeclarationå‡½æ•°</h3><p>è¿™ä¸ªå‡½æ•°ä¼šä¿®æ”¹api.d.tsè¿™ä¸ªå£°æ˜æ–‡ä»¶å†…çš„ç±»å‹å£°æ˜ï¼Œå¦‚æœè¦è‡ªå®šä¹‰çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªä¹Ÿæ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå› ä¸ºå¦‚æœä½ ä¸é‡å†™è¿™ä¸ªå‡½æ•°çš„è¯ï¼Œä½ çš„æ‰€æœ‰ç±»å‹éƒ½æ˜¯é”™è¯¯çš„ï¼</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**@override é‡å†™apiå£°æ˜æ–‡ä»¶æ¨¡æ¿ï¼Œå…¼å®¹è‡ªå®šä¹‰çš„axiosæ‰©å±•å±æ€§*/</span></span><br><span class="line">getInterfaceContentInDeclaration(inter: Interface) &#123;</span><br><span class="line">        <span class="keyword">const</span> bodyParams = inter.getBodyParamsCode();</span><br><span class="line"><span class="keyword">const</span> requestParams = (inter.path.includes(<span class="string">'&#123;'</span>) ? <span class="string">`pathParams = &#123;&#125;, `</span> : <span class="string">''</span>) +</span><br><span class="line">                      (bodyParams ? <span class="string">`bodyParams: Params = &#123;&#125;`</span> : <span class="string">`params: Params = &#123;&#125;`</span>) + </span><br><span class="line">  <span class="string">`, options: import('@/service/types').PickCustomConfig = &#123;&#125;`</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">export <span class="subst">$&#123;inter.getParamsCode(<span class="string">'Params'</span>, <span class="keyword">this</span>.surrounding)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export type Response = <span class="subst">$&#123;inter.responseType&#125;</span>;</span></span><br><span class="line"><span class="string">export const init: Response;</span></span><br><span class="line"><span class="string">export function request(<span class="subst">$&#123;requestParams&#125;</span>): Promise&lt;[import('axios').AxiosError | null, <span class="subst">$&#123;inter.responseType&#125;</span> | null]&gt;;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>é‡å†™å¾ˆç®€å•ï¼Œä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåœ¨å£°æ˜æ–‡ä»¶ä¸­ä¸èƒ½ç›´æ¥å¯¼å…¥ç±»å‹æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥çœ‹åˆ°è¿™é‡Œæˆ‘ä½¿ç”¨import(â€˜åº“â€™).xxxæ¥å®ç°å¤–éƒ¨çš„ç±»å‹å£°æ˜ï¼Œè¿™ä¸ªå‡½æ•°åŒæ ·æœ‰ä¸€ä¸ªInterfaceç±»å‹çš„å›è°ƒå‚æ•°ã€‚</p><h3 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h3>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é¡¹ç›®ç¯å¢ƒä»‹ç»&quot;&gt;&lt;a href=&quot;#é¡¹ç›®ç¯å¢ƒä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;é¡¹ç›®ç¯å¢ƒä»‹ç»&quot;&gt;&lt;/a&gt;é¡¹ç›®ç¯å¢ƒä»‹ç»&lt;/h2&gt;&lt;p&gt;å…¬å¸é¡¹ç›®å…¨çº¿ä¸Šäº†vue3ï¼Œå› æ­¤å‰ç«¯æ¡†æ¶è¿˜æ˜¯vue3ï¼Œè„šæ‰‹æ¶ç”±viteæ”¹å›äº†vue.cli4ï¼ŒåŸå› è¿˜æ˜¯éƒ¨åˆ†åº“çš„
      
    
    </summary>
    
    
      <category term="è®°å½•" scheme="http://localhost:4000/categories/%E8%AE%B0%E5%BD%95/"/>
    
    
      <category term="vue3" scheme="http://localhost:4000/tags/vue3/"/>
    
      <category term="typescript" scheme="http://localhost:4000/tags/typescript/"/>
    
      <category term="pont" scheme="http://localhost:4000/tags/pont/"/>
    
  </entry>
  
  <entry>
    <title>vite+vue3+vue-router4.0+vuex4.0+ts4.0æ­å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¶å­</title>
    <link href="http://localhost:4000/2020/10/29/vite-vue3-vue-router4-0-vuex4-0-ts4-0%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9E%B6%E5%AD%90/"/>
    <id>http://localhost:4000/2020/10/29/vite-vue3-vue-router4-0-vuex4-0-ts4-0%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%A1%B9%E7%9B%AE%E6%9E%B6%E5%AD%90/</id>
    <published>2020-10-29T07:52:34.000Z</published>
    <updated>2021-03-08T06:46:14.169Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vite"><a href="#vite" class="headerlink" title="vite"></a>vite</h2><p>æŒ‰ç…§githubçš„æ–‡æ¡£æ‰€è¯´ï¼Œviteæ˜¯åŸºäºåŸç”Ÿçš„ES Moduleå¯¼å…¥æ‰“åŒ…ï¼ŒåŒæ ·æ˜¯æ”¯æŒåˆ†å—æ‰“åŒ…ã€çƒ­é‡è½½ã€æ‘‡æ ‘ä¼˜åŒ–ç­‰åŠŸèƒ½ï¼Œä½†æ¯”èµ·webpackçš„æ‰“åŒ…é€Ÿåº¦ä¼šæœ‰å·¨å¤§çš„æå‡ï¼Œå¹¶ä¸”ä¸ä¼šéšç€é¡¹ç›®çš„å¢å¤§è€Œå˜æ…¢ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆå§‹åŒ–viteè„šæ‰‹æ¶</span></span><br><span class="line">npm init vite-app &lt;é¡¹ç›®åç§°&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…ä¾èµ–</span></span><br><span class="line">npm install</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨é¡¹ç›®</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…å…¶ä»–ä¾èµ–"><a href="#å®‰è£…å…¶ä»–ä¾èµ–" class="headerlink" title="å®‰è£…å…¶ä»–ä¾èµ–"></a>å®‰è£…å…¶ä»–ä¾èµ–</h3><p>é¡¹ç›®ä¸»è¦è¿˜ç”¨äº†<code>vuex</code>ã€<code>vue-router</code>ã€<code>typescript</code>ã€<code>axios</code>ï¼Œéœ€è¦æ³¨æ„vuexä¸vue-routerå› ä¸ºvue3ä¸å†æš´éœ²Vueæ„é€ å‡½æ•°çš„åŸå› ï¼Œå¿…é¡»ä½¿ç”¨4.0ç‰ˆæœ¬(æ²¡é”™ï¼Œä¸¤è€…éƒ½æ˜¯4.0)ï¼Œæš‚æ—¶éƒ½è¿˜æ˜¯betaç‰ˆæœ¬ï¼Œåç»­è¿˜æ˜¯è¦å…³æ³¨githubé¡¹ç›®çš„åŠ¨å‘ã€‚</p><p>å¯¹äºtypescriptï¼Œå› ä¸ºå…¨å±€å®‰è£…è¿‡ï¼Œç›´æ¥åœ¨é¡¹ç›®åœ°å€è¾“å…¥<code>tsc --init</code>ï¼Œç”Ÿæˆä¸€ä¸ªtsconfig.jsonæ–‡ä»¶ï¼Œè¿›è¡Œé…ç½®å³å¯ï¼Œaxioså®‰è£…ç…§æ—§ã€‚</p><h3 id="é…ç½®vite-config-tsæ–‡ä»¶"><a href="#é…ç½®vite-config-tsæ–‡ä»¶" class="headerlink" title="é…ç½®vite.config.tsæ–‡ä»¶"></a>é…ç½®vite.config.tsæ–‡ä»¶</h3><p>æ—¢ç„¶æ•´ä¸ªé¡¹ç›®æ˜¯tså†™çš„ï¼Œé‚£ä¹ˆé…ç½®æ–‡ä»¶ä¹Ÿåº”è¯¥æ”¹ä¸ºtsæ–‡ä»¶ï¼Œè¿˜æœ‰ä¸ªæœ€å¤§å¥½å¤„æ˜¯èƒ½æ‹¿åˆ°viteé…ç½®çš„ç±»å‹ã€‚ä¸‹é¢è´´ä¸Šä¸€äº›å¸¸ç”¨çš„é…ç½®å±æ€§</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; UserConfig, Plugin <span class="keyword">as</span> VitePlugin &#125; <span class="keyword">from</span> <span class="string">'vite'</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">'path'</span></span><br><span class="line"><span class="keyword">const</span> viteConfig: UserConfig = &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç«¯å£å·</span></span><br><span class="line"><span class="comment">     * @default '3000'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    port: <span class="number">9876</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœåŠ¡åœ°å€</span></span><br><span class="line"><span class="comment">     * @default 'localhost'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    hostname: <span class="string">'localhost'</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿è¡Œè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨Â·</span></span><br><span class="line"><span class="comment">     * @default 'false'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    open: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‹ç¼©ä»£ç </span></span><br><span class="line"><span class="comment">     *  boolean | 'terser' | 'esbuild'</span></span><br><span class="line"><span class="comment">     * @default 'terser'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// minify: dev ? 'esbuild' : 'terser',</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºæœ¬å…¬å…±è·¯å¾„</span></span><br><span class="line"><span class="comment">     * @default '/'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    base: <span class="string">'/'</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰“åŒ…è¾“å…¥è·¯å¾„</span></span><br><span class="line"><span class="comment">     * @default 'dist'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    outDir: <span class="string">'dist'</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @default 'false'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    sourcemap: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * èµ„æºè¾“å‡ºè·¯å¾„</span></span><br><span class="line"><span class="comment">     * @default '_assets'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    assetsDir: <span class="string">'_assets'</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é™æ€èµ„æºå°äºè¯¥å¤§å°å°†ä¼šå†…è”ï¼Œé»˜è®¤4096kb</span></span><br><span class="line"><span class="comment">     * @default '4096'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    assetsInlineLimit: <span class="number">4096</span>,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * esbuildè½¬æ¢ç›®æ ‡ã€‚</span></span><br><span class="line"><span class="comment">     * @default 'es2020'</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    esbuildTarget: <span class="string">'es2020'</span>,</span><br><span class="line">    silent: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// åˆ«å</span></span><br><span class="line">    alias: &#123;</span><br><span class="line">        <span class="string">'/@/'</span>: path.resolve(__dirname, <span class="string">'.'</span>, <span class="string">'src'</span>),</span><br><span class="line">        <span class="string">'@/'</span>: path.resolve(__dirname, <span class="string">'.'</span>, <span class="string">'src'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// cssé¢„å¤„ç†</span></span><br><span class="line">    cssPreprocessOptions: &#123;</span><br><span class="line">        scss: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ä¼šä½¿ç”¨ rollup å¯¹ åŒ…é‡æ–°ç¼–è¯‘ï¼Œå°†ç¼–è¯‘æˆç¬¦åˆ esm æ¨¡å—è§„èŒƒçš„æ–°çš„åŒ…æ”¾å…¥ node_modules/.vite_opt_cache</span></span><br><span class="line">    optimizeDeps: &#123;</span><br><span class="line">        include: [</span><br><span class="line">            <span class="string">'echarts'</span>,</span><br><span class="line">            <span class="string">'echarts/map/js/china'</span>,</span><br><span class="line">            <span class="string">'ant-design-vue/es/locale/zh_CN'</span>,</span><br><span class="line">            <span class="string">'@ant-design/icons-vue'</span>,</span><br><span class="line">            <span class="string">'moment/locale/zh-cn'</span>,</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// plugins: [PurgeIcons(), ...vitePlugins],</span></span><br><span class="line">    rollupOutputOptions: &#123;&#125;,</span><br><span class="line">    rollupInputOptions: &#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">        <span class="comment">// external: VITE_USE_CDN ? externals : [],</span></span><br><span class="line">        <span class="comment">// plugins: rollupPlugins,</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// module.exports = viteConfig</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; </span><br><span class="line">    ...viteConfig</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Vue3-0çš„ä½¿ç”¨"><a href="#Vue3-0çš„ä½¿ç”¨" class="headerlink" title="Vue3.0çš„ä½¿ç”¨"></a>Vue3.0çš„ä½¿ç”¨</h2><p>viteçš„é¡¹ç›®ç»“æ„ä¸vue.cliæ²¡æœ‰ä»€ä¹ˆå·®åˆ«ï¼ŒåŸºäºä¹‹å‰ç”¨2.xå†™tsçš„ç»éªŒï¼Œæˆ‘åœ¨<code>src</code>ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ª<code>shims-vue.d.ts</code>ç”¨äºå£°æ˜Vueæ–‡ä»¶ï¼Œä¸ç„¶tsæ˜¯ä¸è®¤è¯†vueç»“å°¾çš„æ–‡ä»¶çš„:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> "*.vue" &#123;</span><br><span class="line">    <span class="keyword">import</span> &#123; defineComponent &#125; <span class="keyword">from</span> <span class="string">"vue"</span>;</span><br><span class="line">  <span class="comment">// éœ€è¦defineComponentçš„è¿”å›ç±»å‹ è¿™é‡ŒReturnTypeæ˜¯ä¸€ä¸ªæ˜ å°„ç±»å‹ï¼Œé€šè¿‡inferèƒ½å¤Ÿæ¨æ–­å‡ºå‡½æ•°çš„è¿”å›ç±»å‹</span></span><br><span class="line">    <span class="keyword">const</span> component: ReturnType&lt;<span class="keyword">typeof</span> defineComponent&gt;;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> component;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨mainæ–‡ä»¶ä¸­ï¼š</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'/@/router'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'/@/store'</span></span><br><span class="line"><span class="keyword">import</span> Antd, &#123; message, notification &#125; <span class="keyword">from</span> <span class="string">'ant-design-vue'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'ant-design-vue/dist/antd.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">app.use(router)</span><br><span class="line">   .use(store)</span><br><span class="line">   .use(Antd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><p>ç°åœ¨vueä¸å†æš´éœ²Vueå®ä¾‹ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªcreateAppå‡½æ•°æ¥æŒ‚è½½é¡µé¢</p><h3 id="ä½¿ç”¨demo"><a href="#ä½¿ç”¨demo" class="headerlink" title="ä½¿ç”¨demo"></a>ä½¿ç”¨demo</h3><p>åˆ›å»ºä¸€ä¸ªvueæ–‡ä»¶ï¼Œå¼€å¹²</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"home"</span>&gt;</span></span><br><span class="line">        &#123;&#123; data.name &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">a-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"count++"</span>&gt;</span></span><br><span class="line">            &#123;&#123; count &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">"ts"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="meta"><span class="meta-keyword">import</span> &#123; </span></span></span><br><span class="line">        defineComponent, </span><br><span class="line">        onMounted, </span><br><span class="line">        reactive, </span><br><span class="line">        ref, </span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">from</span> <span class="string">"vue"</span></span></span><br><span class="line">  </span><br><span class="line"><span class="javascript">    <span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span></span><br><span class="line">        setup(props, context) &#123;</span><br><span class="line"><span class="actionscript">            <span class="comment">// åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„å¯¹è±¡</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">const</span> data = reactive(&#123;</span></span><br><span class="line"><span class="actionscript">                name: <span class="string">'zhou'</span></span></span><br><span class="line">            &#125;), count = ref(0)</span><br><span class="line"></span><br><span class="line"><span class="javascript">            onMounted(<span class="keyword">async</span> ()=&gt; &#123;</span></span><br><span class="line"><span class="actionscript">                <span class="comment">// do something</span></span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> &#123;</span></span><br><span class="line">                data,</span><br><span class="line">              count</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨ç¬¬ä¸€æ¬¡ç”¨çš„æ—¶å€™æœ‰ä¸¤ä¸ªç–‘é—®:</p><ul><li>è¿™ç§æš´éœ²å‡½æ•°çš„å½¢å¼ï¼Œè™½ç„¶defineComponentå‡½æ•°å·²ç»æœ‰äº†ç±»å‹éªŒè¯ï¼Œä½†æ˜¯ä¼¼ä¹è¿™æ ·å†™å°±ç”¨ä¸äº†è£…é¥°å™¨äº†ï¼Ÿ</li><li>æ²¡æœ‰Vue.prototypeï¼Œå…¨å±€æŒ‚è½½å¦‚ä½•å®ç°ï¼ŸæŒ‚è½½åçš„ç±»å‹å¦‚ä½•éªŒè¯</li></ul><p>ä¸‹é¢æ¥è¯´è¯´</p><h3 id="å¦‚ä½•ä½¿ç”¨è£…é¥°å™¨"><a href="#å¦‚ä½•ä½¿ç”¨è£…é¥°å™¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨è£…é¥°å™¨"></a>å¦‚ä½•ä½¿ç”¨è£…é¥°å™¨</h3><p>ç­”æ¡ˆå¾ˆçœŸå®ï¼Œå°±æ˜¯ä¸ä½¿ç”¨è£…é¥°å™¨XDDDDâ€¦.</p><h3 id="å¦‚ä½•å…¨å±€æŒ‚è½½å±æ€§"><a href="#å¦‚ä½•å…¨å±€æŒ‚è½½å±æ€§" class="headerlink" title="å¦‚ä½•å…¨å±€æŒ‚è½½å±æ€§"></a>å¦‚ä½•å…¨å±€æŒ‚è½½å±æ€§</h3><p>Vue3ä¸­å…¨å±€æŒ‚è½½éœ€è¦åœ¨configå±æ€§ä¸‹:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">'dayjs'</span></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"><span class="comment">// åœ¨appä¸‹configé…ç½®å±æ€§ä¸­çš„globalPropertiesä¸ŠæŒ‚è½½å…¨å±€å±æ€§</span></span><br><span class="line">app.config.globalProperties.$dayjs = dayjs</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &lt;script lang="ts"&gt;</span></span><br><span class="line">    <span class="keyword">import</span> &#123; </span><br><span class="line">        defineComponent, </span><br><span class="line">        getCurrentInstance, </span><br><span class="line">        onMounted, </span><br><span class="line">        reactive, </span><br><span class="line">        ref, </span><br><span class="line">    &#125; <span class="keyword">from</span> <span class="string">"vue"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">        setup(props, context) &#123;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">            onMounted(<span class="keyword">async</span> ()=&gt; &#123;</span><br><span class="line">              <span class="comment">// è¿™ä¹Ÿå¤ªå¤¸å¼ äº†</span></span><br><span class="line">              <span class="built_in">console</span>.log(getCurrentInstance().appContext.app.config.globalProperties.$dayjs)</span><br><span class="line"><span class="comment">// è¯•è¯•ä¸‹é¢çš„Proxyå±æ€§å‘¢</span></span><br><span class="line">              <span class="built_in">console</span>.log(getCurrentInstance().Proxy.$dayjs)</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">// &lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§è‚¯å®šæ˜¯é—¹ç€ç©çš„ï¼Œç¬¬äºŒç§å°±å¯è¡Œäº†ï¼Œä¸è¿‡è¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰ç±»å‹å£°æ˜ï¼Œä¼šæŠ¥é”™ï¼Œtså¹¶ä¸çŸ¥é“$dayjsçš„å­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å†™ä¸Šç±»å‹,åœ¨<code>main.ts</code>æ–‡ä»¶ä¸­:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">'/@/router'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'/@/store'</span></span><br><span class="line"><span class="keyword">import</span> Antd, &#123; message, notification &#125; <span class="keyword">from</span> <span class="string">'ant-design-vue'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'ant-design-vue/dist/antd.css'</span>;</span><br><span class="line"><span class="keyword">import</span> dayjs <span class="keyword">from</span> <span class="string">'dayjs'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> '@vue/runtime-core' &#123;</span><br><span class="line">    <span class="keyword">interface</span> ComponentCustomProperties &#123;</span><br><span class="line">        $dayjs: <span class="keyword">typeof</span> dayjs,</span><br><span class="line">        $message: <span class="keyword">typeof</span> message,</span><br><span class="line">        $notification: <span class="keyword">typeof</span> notification</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App)</span><br><span class="line"></span><br><span class="line">app.config.globalProperties.$dayjs = dayjs</span><br><span class="line"></span><br><span class="line">app.use(router)</span><br><span class="line">   .use(store)</span><br><span class="line">   .use(Antd)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = app.mount(<span class="string">'#app'</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦å†™åœ¨main.tsæ–‡ä»¶è¿™ä¸ªé—®é¢˜æˆ‘è¿˜æ²¡æ‰¾åˆ°ç­”æ¡ˆï¼Œæˆ‘æœ¬æ¥æ˜¯æŠŠdeclareæ”¾åœ¨srcç›®å½•ä¸‹çš„ä¸€ä¸ªd.tså£°æ˜æ–‡ä»¶ä¸‹çš„ï¼Œå¯ä»–å°±æ˜¯ä¸è®¤ï¼Œæœ€åæ”¾åˆ°mainæ–‡ä»¶ä¸­æ‰ç”Ÿæ•ˆï¼</p><p><img src="/BeCoderQ.github.io/2020/10/29/vite-vue3-vue-router4-0-vuex4-0-ts4-0æ­å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¶å­/interface.png" alt="è‡ªå®šä¹‰å±æ€§"></p><p>é‡è½½äº†<code>ComponentCustomProperties</code>æ¥å£ï¼Œå»æºç çœ‹å¾ˆè´´å¿ƒçš„å†™äº†ä¾‹å­ï¼Œè¯¶ï¼Œåœ¨è¿™å„¿æ‰å‘ç°äººå®¶ä¾‹å­å°±æ˜¯æŠŠdeclareæ”¾mainæ–‡ä»¶ä¸­çš„ï¼</p><p>æ¥ä¸‹æ¥åŠ å·¥ä¸€ä¸‹<code>getCurrentInstance</code>å‡½æ•°ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œåšäº†ä¸€ç‚¹å‡†å¤‡å·¥ä½œï¼Œåœ¨tool-type.d.tsæ–‡ä»¶ä¸­ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç±»å‹å·¥å…·:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ƒç¥–ç±»å‹è½¬è”åˆç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> TupleTypeToUnions&lt;T, K = <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> <span class="built_in">Array</span>&lt;K&gt; ? T[<span class="built_in">number</span>] : T </span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–Uä¸­çš„Tç±»å‹</span></span><br><span class="line"><span class="keyword">type</span> IncludeKey&lt;T,U&gt; = T <span class="keyword">extends</span> (U <span class="keyword">extends</span> <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt; ? TupleTypeToUnions&lt;U&gt; : U) ? T : never</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†Uä¸­çš„Tç±»å‹è½¬ä¸ºæ˜ å°„å‡ºæ¥</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> IncludeType&lt;T, U&gt; = &#123;</span><br><span class="line">    [K <span class="keyword">in</span> IncludeKey&lt;keyof T, U&gt;]: T[K]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸‰ä¸ªç±»å‹è½¬æ¢åé¢å•ç‹¬å†™ä¸ªåšå®¢ï¼Œå®é™…å°±æ˜¯ä¸€äº›ç®€å•çš„ç±»å‹æ˜ å°„ï¼Œæ€»ä¹‹æœ€åå¯ä»¥å®ç°ä»¥ä¸‹æ•ˆæœ</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &lt;script&gt;</span></span><br><span class="line"><span class="keyword">type</span> ProxyContext = &#123;</span><br><span class="line">        proxy: NonNullable&lt;IncludeType&lt;ComponentInternalInstance, <span class="string">'proxy'</span>&gt;[<span class="string">'proxy'</span>]&gt;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span><br><span class="line">        setup(props, context) &#123;</span><br><span class="line">         </span><br><span class="line"></span><br><span class="line">            <span class="keyword">const</span> &#123; proxy: ins &#125;: ProxyContext = &lt;ProxyContext&gt;getCurrentInstance()</span><br><span class="line">            onMounted(<span class="keyword">async</span> ()=&gt; &#123;</span><br><span class="line">              <span class="comment">// ç°åœ¨å¯ä»¥æˆåŠŸæ¨æ–­</span></span><br><span class="line">                ins.$message.success(<span class="string">'æˆåŠŸ'</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">// &lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ€åæŠŠ<code>getCurrentInstance</code>çš„<code>proxy</code>å±æ€§è§£æ„å‘½åä¸ºinsï¼Œå¯ä»¥çœ‹åˆ°å·²ç»èƒ½å¤Ÿæ¨æ–­äº†ã€‚</p><p><img src="/BeCoderQ.github.io/2020/10/29/vite-vue3-vue-router4-0-vuex4-0-ts4-0æ­å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¶å­/assert.png" alt="æ¨æ–­æˆåŠŸ"></p><p>å¯ä»¥çœ‹åˆ°ç°åœ¨å…¨å±€å·²ç»æŒ‚è½½å®Œæˆäº†ï¼</p><ul><li>è¿™é‡Œä½¿ç”¨äº†<code>IncludeType</code>æ¨æ–­<code>ComponentInternalInstance</code>ï¼Œç¬¬äºŒä¸ªå€¼ä¼ å…¥proxyæˆ‘ä»¬å°±æ‹¿åˆ°äº†proxyä¸å…¶ç±»å‹çš„é”®å€¼(ç±»å‹)å¯¹</li><li>ç„¶åç±»ä¼¼å¯¹è±¡ä¸æ•°ç»„çš„å–å€¼ï¼Œ[â€˜proxyâ€™]æ‹¿åˆ°proxyçš„ç±»å‹</li><li>æœ€åç”¨å†…ç½®çš„NonNullableå»æ‰nullå€¼(è¿™ä¸€æ­¥ä¼¼ä¹æœ‰ç‚¹å¤šä½™)</li></ul><h2 id="ä½¿ç”¨æ–°çš„Vuex"><a href="#ä½¿ç”¨æ–°çš„Vuex" class="headerlink" title="ä½¿ç”¨æ–°çš„Vuex"></a>ä½¿ç”¨æ–°çš„Vuex</h2><p>Vuexçš„ä½¿ç”¨ä¸Šæˆ‘é‡‡å–äº†ä¸åŒçš„æ–¹æ³•ï¼Œå› ä¸ºé¡¹ç›®éœ€æ±‚ï¼Œæšä¸¾å­—æ®µä¼šä»åç«¯è¿”å›ï¼Œå¹¶ä¸”æšä¸¾å­—æ®µå¾ˆå¤š(å¯èƒ½ä¸Šç™¾ä¸ª)ï¼Œé‚£ä¹ˆå¯¹äºæšä¸¾å­—æ®µï¼Œæˆ‘å°±æ”¾å¼ƒäº†Vuex-decoratorçš„å†™æ³•ï¼Œå› ä¸ºè¿™æ ·å¤ªè´¹æ—¶è´¹åŠ›äº†ï¼Œè¿™æ„å‘³ç€æˆ‘å†™ä¸€ä¸ªå±æ€§å°±å¾—å†™ä¸€ä¸ªMutationï¼Œå› æ­¤æˆ‘é€‰æ‹©è‡ªåŠ¨ç”ŸæˆMutationã€‚ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">genaratorMutation</span>&lt;<span class="title">T</span>&gt;(<span class="params">state: &#123; [K <span class="keyword">in</span> keyof T]: T[K] &#125;</span>): <span class="title">MutationTree</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> mutationMap: MutationTree&lt;T&gt; = &#123;&#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(state).forEach(<span class="function">(<span class="params">key: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">Object</span>.assign(mutationMap, &#123;</span><br><span class="line">            [key]: <span class="function">(<span class="params">$state: <span class="keyword">typeof</span> state, value: T[keyof T]</span>) =&gt;</span> &#123;</span><br><span class="line">                $state[key <span class="keyword">as</span> keyof T] = value</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> mutationMap</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨æ¨¡å—æ–‡ä»¶å†…:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> userType &#123;</span><br><span class="line">    <span class="string">"ç”¨æˆ·"</span> = <span class="number">1</span>,</span><br><span class="line">    <span class="string">"ç®¡ç†å‘˜"</span> = <span class="number">2</span>,</span><br><span class="line">    <span class="string">"è¶…çº§ç®¡ç†å‘˜"</span> = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> sexType &#123;</span><br><span class="line">    <span class="string">"ç”·"</span> = <span class="number">1</span></span><br><span class="line">    <span class="string">"å¥³"</span> = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> enumState = &#123;</span><br><span class="line">    sexType,</span><br><span class="line">    userType</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> enumMutations = genaratorMutation&lt;Partial&lt;<span class="keyword">typeof</span> enumState&gt;&gt;(enumState)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    state: enumState,</span><br><span class="line">    namespaced: <span class="literal">true</span>,</span><br><span class="line">    mutations: enumMutations,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;vite&quot;&gt;&lt;a href=&quot;#vite&quot; class=&quot;headerlink&quot; title=&quot;vite&quot;&gt;&lt;/a&gt;vite&lt;/h2&gt;&lt;p&gt;æŒ‰ç…§githubçš„æ–‡æ¡£æ‰€è¯´ï¼Œviteæ˜¯åŸºäºåŸç”Ÿçš„ES Moduleå¯¼å…¥æ‰“åŒ…ï¼ŒåŒæ ·æ˜¯æ”¯æŒåˆ†å—æ‰“åŒ…ã€çƒ­é‡è½½ã€æ‘‡æ ‘ä¼˜åŒ–ç­‰
      
    
    </summary>
    
    
      <category term="å­¦ä¹ " scheme="http://localhost:4000/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="vue3" scheme="http://localhost:4000/tags/vue3/"/>
    
      <category term="typescript" scheme="http://localhost:4000/tags/typescript/"/>
    
      <category term="vite" scheme="http://localhost:4000/tags/vite/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºVueåŒ…è£…ä¸€ä¸ªé“¾å¼æ³¨é”€çš„å…¨å±€äº‹ä»¶æ€»çº¿</title>
    <link href="http://localhost:4000/2020/09/30/%E5%9F%BA%E4%BA%8EVue%E5%8C%85%E8%A3%85%E4%B8%80%E4%B8%AA%E9%93%BE%E5%BC%8F%E6%B3%A8%E9%94%80%E7%9A%84%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/"/>
    <id>http://localhost:4000/2020/09/30/%E5%9F%BA%E4%BA%8EVue%E5%8C%85%E8%A3%85%E4%B8%80%E4%B8%AA%E9%93%BE%E5%BC%8F%E6%B3%A8%E9%94%80%E7%9A%84%E5%85%A8%E5%B1%80%E4%BA%8B%E4%BB%B6%E6%80%BB%E7%BA%BF/</id>
    <published>2020-09-30T05:45:27.000Z</published>
    <updated>2020-09-30T05:59:52.517Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h2><p>å…¬å¸çš„æŸä¸ªé¡¹ç›®ç»„ä»¶å°è£…å¾—ä¸æ˜¯å¾ˆå¥½ï¼Œåˆ°å¤„éƒ½åœ¨ç”¨å…¨å±€äº‹ä»¶æ€»çº¿ï¼Œå¹¶ä¸”<code>@on</code>æ³¨å†Œåè¿˜ä»æ¥éƒ½ä¸æ³¨é”€ï¼Œè™½ç„¶é¡¹ç›®ä¸å¤§ä¸å­˜åœ¨çˆ†æ ˆçš„é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œå› æ­¤å†³å®šå†™ä¸€ä¸ªå·¥å‚å‡½æ•°æ¥è®©æ³¨é”€äº‹ä»¶ç®€å•ä¸€ç‚¹ã€‚</p><h2 id="ç›®æ ‡æ•ˆæœ"><a href="#ç›®æ ‡æ•ˆæœ" class="headerlink" title="ç›®æ ‡æ•ˆæœ"></a>ç›®æ ‡æ•ˆæœ</h2><p>æœ€åå®ç°çš„æ•ˆæœå¤§æ¦‚æ˜¯è¿™æ ·:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="keyword">this</span>.$bus.$on(<span class="string">'customize-event'</span>, msg=&gt; &#123;</span><br><span class="line">      <span class="comment">// do sth</span></span><br><span class="line">    &#125;).off(<span class="keyword">this</span>, <span class="string">'customize-event'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¾€Vueå®ä¾‹ä¸­_eventså±æ€§ä¸­æ¨å…¥äº‹ä»¶åï¼Œç›´æ¥åœ¨<code>@on</code>åé¢è°ƒç”¨offäº‹ä»¶æ³¨é”€äº‹ä»¶ï¼Œå½“ç„¶è¿™ä¸ªæ³¨é”€ä¸æ˜¯é©¬ä¸Šæ³¨é”€ï¼Œè€Œæ˜¯åœ¨<code>beforeDestory</code>é’©å­å‡½æ•°è§¦å‘æ—¶æ³¨é”€ã€‚å¦å¤–ï¼Œæˆ‘ä»¬è¿˜è¦å‘ä¸‹å…¼å®¹åŸç”Ÿçš„äº‹ä»¶ã€‚</p><h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ExtendGlobalEvent,ç»§æ‰¿è‡ªVue,è°ƒç”¨å…¨å±€æ€»çº¿è°ƒç”¨åŒåŸç”Ÿäº‹ä»¶æ€»çº¿ç›¸åŒï¼Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExtendGlobalEvent</span> <span class="keyword">extends</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @override</span></span><br><span class="line">  <span class="comment">// æ³¨æ„åå­—åˆ«å†™é‡äº†</span></span><br><span class="line">    _on(...args) &#123;</span><br><span class="line">        <span class="keyword">super</span>.$on(...args)</span><br><span class="line">    &#125;</span><br><span class="line">    _emit(...args) &#123;</span><br><span class="line">        <span class="keyword">super</span>.$emit(...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€äº‹ä»¶çš„å·¥å‚å‡½æ•°ï¼Œä¸ºäº†å…¼å®¹åŸç”Ÿ$onçš„è°ƒç”¨æ–¹å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">EventGloablFactory</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Event = <span class="keyword">new</span> ExtendGlobalEvent()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        $on(...args) &#123;</span><br><span class="line">            Event._on(...args)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">        &#125;,</span><br><span class="line">        $emit(...args) &#123;</span><br><span class="line">            Event._emit(...args)</span><br><span class="line">        &#125;,</span><br><span class="line">        $off(...args) &#123;</span><br><span class="line">            Event.$off(...args)</span><br><span class="line">        &#125;,</span><br><span class="line">        off(context, eventName) &#123;</span><br><span class="line">            <span class="keyword">if</span> (context &amp;&amp; context._isVue) &#123;</span><br><span class="line">                context.$once(<span class="string">'hook:beforeDestroy'</span>, () =&gt; &#123;</span><br><span class="line">                    <span class="keyword">this</span>.$off(eventName)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æš´éœ²å‡ºå»çš„å®é™…æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„keyä¸åŸç”Ÿçš„å…¨å±€äº‹ä»¶çš„keyç›¸åŒï¼Œä»–ä»¬ä¼šæ‰§è¡Œè¢«ExtendGlobalEventå®ä¾‹åŒ–åçš„Eventï¼Œè€ŒExtendGlobalEventå†…éƒ¨åˆæ˜¯ç»§æ‰¿è‡ªVueï¼Œå®ƒè§¦å‘çš„ä¹Ÿæ˜¯åŸç”Ÿçš„$emitã€$onã€$offã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h2&gt;&lt;p&gt;å…¬å¸çš„æŸä¸ªé¡¹ç›®ç»„ä»¶å°è£…å¾—ä¸æ˜¯å¾ˆå¥½ï¼Œåˆ°å¤„éƒ½åœ¨ç”¨å…¨å±€äº‹ä»¶æ€»çº¿ï¼Œå¹¶ä¸”&lt;code&gt;@on&lt;/code&gt;æ³¨å†Œåè¿˜ä»æ¥éƒ½ä¸æ³¨é”€ï¼Œè™½ç„¶é¡¹ç›®ä¸å¤§ä¸å­˜åœ¨çˆ†æ ˆçš„
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="bus" scheme="http://localhost:4000/tags/bus/"/>
    
      <category term="Vue" scheme="http://localhost:4000/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>æœ€è¿‘é¡¹ç›®ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜æˆ–ä¸€äº›æ€»ç»“</title>
    <link href="http://localhost:4000/2020/09/30/%E6%9C%80%E8%BF%91%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%88%96%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/"/>
    <id>http://localhost:4000/2020/09/30/%E6%9C%80%E8%BF%91%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%88%96%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/</id>
    <published>2020-09-30T02:31:10.000Z</published>
    <updated>2020-09-30T05:28:48.148Z</updated>
    
    <content type="html"><![CDATA[<h2 id="uni-appçš„scroll-viewç»„ä»¶è§¦åº•æ¦‚ç‡ä¸è§¦å‘é—®é¢˜"><a href="#uni-appçš„scroll-viewç»„ä»¶è§¦åº•æ¦‚ç‡ä¸è§¦å‘é—®é¢˜" class="headerlink" title="uni-appçš„scroll-viewç»„ä»¶è§¦åº•æ¦‚ç‡ä¸è§¦å‘é—®é¢˜"></a>uni-appçš„scroll-viewç»„ä»¶è§¦åº•æ¦‚ç‡ä¸è§¦å‘é—®é¢˜</h2><p>å‰æ®µæ—¶é—´ç”¨uni-appåšç§»åŠ¨ç«¯é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨<code>scroll-view</code>æ ‡ç­¾<code>@scrolltolower</code>äº‹ä»¶æ—¶ï¼Œä¼šæœ‰ä¸€å®šæ¦‚ç‡ä¸è§¦å‘è§¦åº•äº‹ä»¶ï¼Œè‡³äºåŸå› æˆ‘æ²¡æœ‰å»ç ”ç©¶ï¼Œä¸è¿‡æš‚æ—¶æ‰¾åˆ°ä¸€ä¸ªè§£å†³åŠæ³•:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scroll-view</span> </span></span><br><span class="line"><span class="tag"><span class="attr">:scroll-top</span>=<span class="string">"prevScrollTop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"load-more-list"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">scroll-y</span>=<span class="string">"true"</span> </span></span><br><span class="line"><span class="tag">@<span class="attr">scrolltolower</span>=<span class="string">"reachBottom"</span></span></span><br><span class="line"><span class="tag">@<span class="attr">scroll</span>=<span class="string">"onScroll"</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-on</span>=<span class="string">"$listeners"</span></span></span><br><span class="line"><span class="tag"><span class="attr">:style</span>=<span class="string">"&#123; height: height || `calc(100vh - $&#123;_cache.statusHeight&#125;px - 44px` &#125;"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">:list</span>=<span class="string">"renderList"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">loading-animation</span> </span></span><br><span class="line"><span class="tag"><span class="attr">:no-more</span>=<span class="string">"noMore"</span> </span></span><br><span class="line"><span class="tag"><span class="attr">:data</span>=<span class="string">"renderList"</span> </span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘æœ‰ä¸€ä¸ªä¸Šæ‹‰åŠ è½½æ›´å¤šç»„ä»¶ï¼ŒHTMLéƒ¨åˆ†å¤§æ¦‚æ˜¯è¿™æ ·</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">'lodash'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      prevScrollTop: <span class="number">0</span>,</span><br><span class="line">      currentScrollTop: <span class="number">0</span>,</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  methods: &#123;</span><br><span class="line">    ...</span><br><span class="line">    _scroll: _.debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.prevScrollTop = <span class="keyword">this</span>.currentScrollTop</span><br><span class="line">    &#125;, <span class="number">700</span>),</span><br><span class="line">    onScroll(&#123; <span class="attr">detail</span>: &#123; scrollTop &#125; &#125;) &#123;</span><br><span class="line">      <span class="keyword">this</span>._scroll()</span><br><span class="line">      <span class="keyword">this</span>.currentScrollTop = scrollTop</span><br><span class="line">    &#125;,</span><br><span class="line">    _onReachBottom: _.debounce(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.noMore) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">this</span>.pageNum++</span><br><span class="line">      <span class="keyword">this</span>.getData()</span><br><span class="line">    &#125;, <span class="number">500</span>),</span><br><span class="line">    reachBottom() &#123;</span><br><span class="line">      <span class="keyword">this</span>._onReachBottom()</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªè´´äº†å…³é”®ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘é™¤äº†ç»‘å®šäº†<code>@scrolltolower</code>è§¦åº•äº‹ä»¶ï¼Œè¿˜åŠ äº†ä¸€ä¸ªæ»šåŠ¨äº‹ä»¶<code>@scroll</code>ã€æ»šåŠ¨è·ç¦»å±æ€§<code>scroll-top</code>ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸¤ä¸ªå˜é‡ï¼ŒprevScrollTopä¸currentScrollTopï¼Œåå­—å¯èƒ½ä¸å¤ªå¥‘åˆï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯åœ¨æ»šåŠ¨åå°†å½“å‰æ»šåŠ¨çš„è·ç¦»èµ‹å€¼ç»™<code>scroll-view</code>æ ‡ç­¾ã€‚</p><h2 id="awaitçš„é”™è¯¯æ•è·"><a href="#awaitçš„é”™è¯¯æ•è·" class="headerlink" title="awaitçš„é”™è¯¯æ•è·"></a>awaitçš„é”™è¯¯æ•è·</h2><p>æœ€è¿‘æ¥æ‰‹ä¸€ä¸ªåˆ«äººçš„å†™çš„é¡¹ç›®é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œè¯·æ±‚æ¥å£æ—¶ï¼Œå½“æ¥å£æ­£å¸¸åº”ç­”å¯ä»¥æ­£å¸¸æ‹¿åˆ°æ•°æ®ï¼Œå½“æ¥å£æŠ¥é”™äº†å°±æ‹¿ä¸åˆ°ä»»ä½•ä¸œè¥¿ï¼Œæ‰“å¼€æ§åˆ¶å°ä¸€çœ‹ï¼Œuncaught (in promise)ã€‚äºæ˜¯å»çœ‹äº†ä¸‹å°è£…çš„è¯·æ±‚åº“ï¼Œå‘ç°äº†é—®é¢˜ï¼Œå› ä¸ºå°è£…çš„å¾ˆä¹±ï¼Œæ‰€ä»¥æˆ‘å°±æ‹¿å…¸å‹çš„é”™è¯¯ä¸¾ä¾‹</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åº“</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">req</span>(<span class="params">å‚æ•°</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">request(å¤„ç†åçš„å‚æ•°)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">å‚æ•°</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span> &#123;</span><br><span class="line">      axios(å‚æ•°)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;...; resolve(response.data)&#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">error</span>=&gt;</span> &#123;...; reject(error)&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="keyword">this</span>.req(å„ç§å‚æ•°)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å’‹ä¸€çœ‹å¥½åƒæ²¡é—®é¢˜ï¼Œä¸è¿‡æœ‰ä¸‰ä¸ªæ¯”è¾ƒçªå‡ºçš„é—®é¢˜:</p><ul><li>æ—¢ç„¶å°è£…äº† è¿˜ä½¿ç”¨äº†axiosï¼Œé‚£ä¹ˆå°±åº”è¯¥ç”¨æ‹¦æˆªå™¨ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨axiosæ¥å°è£…</li><li>reqå‡½æ•°åªæ˜¯è°ƒç”¨äº†requestå‡½æ•°ï¼Œæ²¡æœ‰åšé”™è¯¯æ•æ‰ç­‰å¤„ç†</li><li>ä½¿ç”¨asyncä¸awaitæ¥åŒæ­¥åŒ–å¼‚æ­¥æ“ä½œï¼Œä½†æ˜¯è¿”å›çš„ç»“æœæ— æ³•åŒºåˆ†åˆ°åº•å‡ºæ²¡å‡ºé”™</li></ul><p>ä¿®æ”¹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">req</span>(<span class="params">å‚æ•°</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">let</span> res = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    res = <span class="keyword">await</span> <span class="keyword">this</span>.request(å‚æ•°)</span><br><span class="line">    <span class="keyword">return</span> [<span class="literal">null</span>, res]</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="keyword">return</span> [err, res]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params">å‚æ•°</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span> &#123;</span><br><span class="line">      axios(å‚æ•°)</span><br><span class="line">        .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;...; resolve(response.data)&#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">error</span>=&gt;</span> &#123;...; reject(error)&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="keyword">this</span>.req(å„ç§å‚æ•°)</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="comment">// åšæ¥å£é”™è¯¯åçš„ç›¸å…³äº‹å®œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¿®æ”¹åï¼Œç”¨try catchæ•è·äº†é”™è¯¯ï¼Œå¹¶ä¸”å°†ä»£ç é£æ ¼æ”¹ä¸ºäº†error-firstï¼Œç®€å•æ˜äº†ï¼Œè®©è°ƒç”¨åæ›´å¥½åŒºåˆ†ã€‚</p><h2 id="TypeScriptä¸€äº›æ€»ç»“"><a href="#TypeScriptä¸€äº›æ€»ç»“" class="headerlink" title="TypeScriptä¸€äº›æ€»ç»“"></a>TypeScriptä¸€äº›æ€»ç»“</h2><p>æœ€è¿‘ä½¿ç”¨äº†nuxt+tsï¼Œå¦å¤–ç”¨tså°è£…äº†ä¸€ä¸ªä»£ç†vuexçš„åº“ï¼Œé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œæ€»ç»“ä¸€ä¸‹</p><h3 id="tsä¸­å¸¸ç”¨çš„å‡ ç§å¯¼å…¥æ–¹å¼"><a href="#tsä¸­å¸¸ç”¨çš„å‡ ç§å¯¼å…¥æ–¹å¼" class="headerlink" title="tsä¸­å¸¸ç”¨çš„å‡ ç§å¯¼å…¥æ–¹å¼"></a>tsä¸­å¸¸ç”¨çš„å‡ ç§å¯¼å…¥æ–¹å¼</h3><ul><li><p><code>import something from &#39;something&#39;</code>ä¸ <code>import { something } from &#39;library&#39;</code>åŒjsä¸­ä¸€æ ·ï¼Œæœ€æ ‡å‡†çš„AMDå¯¼å…¥ï¼Œè¿™ç§æ–¹æ³•å¯¼å…¥çš„ä¸œè¥¿æ˜¯å¸¦æœ‰ç±»å‹æ ¡éªŒçš„ï¼Œå½“ç„¶ï¼Œå‰ææ˜¯æœ‰å£°æ˜æ–‡ä»¶ã€‚</p></li><li><p><code>import * as $ from &#39;xxx&#39;</code>ï¼Œè¿™æ ·çš„å¯¼å…¥æ–¹å¼åŠæ˜¯å°†ç›®æ ‡æ–‡ä»¶ä¸­æ‰€æœ‰çš„<code>export</code>é¡¹å­˜å…¥<code>namespace</code>å˜é‡$ä¸­ï¼Œè°ƒç”¨æ—¶å‡ä»¥$.è°ƒç”¨ï¼ŒåŒæ ·æœ‰ç±»å‹æ ¡éªŒã€‚</p></li><li><code>import something = require(&#39;something&#39;)</code>ï¼Œè¿™ä¸ªè°ƒç”¨æ–¹å¼ä¸<code>const something = require(&#39;something&#39;)</code>çš„åŒºåˆ«æ˜¯å‰è€…é™¤äº†å¯¼å…¥æ¨¡å—å¤–ï¼Œè¿˜å°†å®ƒçš„ç±»å‹å¯¼å…¥äº†ï¼Œå½“ä½ ä½¿ç”¨tsæ—¶ï¼Œå‰è€…å¯¼å…¥çš„<code>something</code>ä¼šåœ¨ä½¿ç”¨æ—¶è¿›è¡Œç±»å‹æ ¡éªŒï¼Œåè€…åˆ™ä¸ä¼šï¼Œå› ä¸ºtså°†åè€…çš„ç±»å‹å®šä¹‰ä¸ºanyã€‚</li></ul><h3 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h3><p>ç±»å‹æ–­è¨€å¹¶æ²¡æœ‰å¼ºåˆ¶è½¬æ¢ç±»å‹ï¼Œè€Œæ˜¯è®©æˆ‘ä»¬åšä¸€ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­:</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params">value: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(value.length) <span class="keyword">return</span> value.length</span><br><span class="line">  <span class="keyword">return</span> value.toString().length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç¼–è¯‘ä¼šå‡ºé”™ï¼Œå› ä¸ºnumberç±»å‹å¹¶æ²¡æœ‰lengthå±æ€§ï¼Œè®¿é—®è”åˆç±»å‹æ—¶ï¼Œè¿™ä¸ªå±æ€§å¿…é¡»æ—¶ä¸¤ä¸ªç±»å‹çš„äº¤é›†ï¼Œä¹Ÿå°±æ˜¯è¯´lengthå¿…é¡»æ˜¯ä¸¤è€…éƒ½å…·æœ‰çš„å±æ€§æ‰èƒ½ç¼–è¯‘é€šè¿‡ã€‚</p><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params">value: <span class="built_in">string</span> | <span class="built_in">number</span></span>): <span class="title">number</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>((&lt;<span class="built_in">string</span>&gt;value).length) <span class="keyword">return</span> (&lt;<span class="built_in">string</span>&gt;value).length</span><br><span class="line">  <span class="keyword">return</span> value.toString().length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨data-setä¸ºä¼ªç±»åŠ¨æ€èµ‹å€¼"><a href="#ä½¿ç”¨data-setä¸ºä¼ªç±»åŠ¨æ€èµ‹å€¼" class="headerlink" title="ä½¿ç”¨data-setä¸ºä¼ªç±»åŠ¨æ€èµ‹å€¼"></a>ä½¿ç”¨data-setä¸ºä¼ªç±»åŠ¨æ€èµ‹å€¼</h2><p>ä¹‹å‰åšäº†ä¸€ä¸ªé¡µé¢ï¼Œå››ä¸ªå°æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å·¦ä¸Šè§’æ˜¯ä¸€ä¸ªæ ‡é¢˜ï¼Œå½“æ—¶å¹¶ä¸æƒ³ä¸ºæ²¡æœ‰ä»€ä¹ˆå¤æ‚æ ·å¼çš„æ ‡é¢˜ä¸“é—¨å†™ä¸€ä¸ªæ ‡ç­¾ï¼Œå› æ­¤æƒ³åˆ°äº†ä¼ªç±»ã€‚code:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"card violation-count"</span> <span class="attr">:data-title</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">v-for</span>=<span class="string">"meta in typeMeta"</span> <span class="attr">:key</span>=<span class="string">"meta.title"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123; meta.title &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123; meta.count &#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    ...</span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="actionscript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="actionscript">    title: <span class="string">'åŠ¨æ€çš„æ ‡é¢˜'</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>csséƒ¨åˆ†ï¼š</p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.card</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="selector-tag">&amp;</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: attr(data-title);</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œå°±è¿™ä¹ˆç®€å•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨lessã€sassé¢„ç¼–è¯‘å™¨çš„å¾ªç¯åŠŸèƒ½æ¥ä¸ºå¤šä¸ªä¼ªç±»èµ‹å€¼ã€‚</p><h2 id="åœ¨Vueä¸­æ³¨é”€watchç›‘å¬"><a href="#åœ¨Vueä¸­æ³¨é”€watchç›‘å¬" class="headerlink" title="åœ¨Vueä¸­æ³¨é”€watchç›‘å¬"></a>åœ¨Vueä¸­æ³¨é”€watchç›‘å¬</h2><p>æœ€è¿‘åšçš„è¿™ä¸ªé¡¹ç›®æ•°æ®æºåªæœ‰ä¸‰ä¸ªæ¥å£ï¼Œè¿™ä¸‰ä¸ªæ¥å£çš„æ•°æ®ä¼šç”±ä¸€ä¸ªæ ¹ç»„ä»¶æ³¨å…¥åˆ°ä¸‹é¢çš„æ‰€æœ‰å­æ¨¡å—ä¸­ï¼Œå¹¶ä¸”ä¼šè½®è¯¢è®¿é—®ã€‚ä¸‹é¢çš„å­æ¨¡å—watchç›‘å¬åˆ°æ•°æ®å˜åŒ–åæ›´æ–°è§†å›¾ã€‚ç„¶åæœ‰ä¸€ä¸ªé¡µé¢çš„éœ€æ±‚æ˜¯åªéœ€è¦ä¸€æ¬¡ç›‘å¬ï¼Œèµ‹å€¼ï¼Œç„¶åå°±ä¸å†ç›‘å¬ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨çš„<code>$watch</code>äº†ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    list: &#123;</span><br><span class="line">      type: <span class="built_in">Array</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="function"><span class="params">()</span>=&gt;</span> []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    <span class="keyword">const</span> destoryWatch = <span class="keyword">this</span>.$watch(<span class="string">'list'</span>, (newList, oldList)=&gt; &#123;</span><br><span class="line">      <span class="comment">// do something</span></span><br><span class="line">      destoryWatch()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§vueå®˜ç½‘2.xçš„APIæ‰€è¿°ï¼Œ$watchç›‘å¬åä¼šè¿”å›ä¸€ä¸ªå–æ¶ˆè§‚å¯Ÿå‡½æ•°ï¼Œæ‰§è¡Œå®ƒä¹‹åç›‘å¬å‡½æ•°å°†ä¼šè¢«é”€æ¯ã€‚æ–‡æ¡£è¯¦æƒ…:<a href="https://cn.vuejs.org/v2/api/#vm-options" target="_blank" rel="noopener">https://cn.vuejs.org/v2/api/#vm-options</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;uni-appçš„scroll-viewç»„ä»¶è§¦åº•æ¦‚ç‡ä¸è§¦å‘é—®é¢˜&quot;&gt;&lt;a href=&quot;#uni-appçš„scroll-viewç»„ä»¶è§¦åº•æ¦‚ç‡ä¸è§¦å‘é—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;uni-appçš„scroll-viewç»„ä»¶è§¦åº•æ¦‚ç‡ä¸è§¦å‘é—®é¢˜&quot;&gt;
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="æ€»ç»“" scheme="http://localhost:4000/tags/%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>è§£æåç«¯æŒ‰ä½è¿ç®—çš„æšä¸¾å€¼</title>
    <link href="http://localhost:4000/2020/09/10/%E8%A7%A3%E6%9E%90%E5%90%8E%E7%AB%AF%E6%8C%89%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E6%9E%9A%E4%B8%BE%E5%80%BC/"/>
    <id>http://localhost:4000/2020/09/10/%E8%A7%A3%E6%9E%90%E5%90%8E%E7%AB%AF%E6%8C%89%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E6%9E%9A%E4%B8%BE%E5%80%BC/</id>
    <published>2020-09-10T01:04:32.000Z</published>
    <updated>2020-09-30T02:18:00.822Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½è¿ç®—æšä¸¾å€¼"><a href="#ä½è¿ç®—æšä¸¾å€¼" class="headerlink" title="ä½è¿ç®—æšä¸¾å€¼"></a>ä½è¿ç®—æšä¸¾å€¼</h2><p>ä½è¿ç®—çš„æšä¸¾å€¼å¤§æ¦‚æ˜¯ä¸‹é¢çš„æ ·å­:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dictionary = &#123;</span><br><span class="line">  <span class="number">1</span>: <span class="string">'æšä¸¾å€¼one'</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">'æšä¸¾å€¼two'</span>,</span><br><span class="line">  <span class="number">4</span>: <span class="string">'æšä¸¾å€¼three'</span>,</span><br><span class="line">  <span class="number">8</span>: <span class="string">'æšä¸¾å€¼four'</span>,</span><br><span class="line">  <span class="number">16</span>: <span class="string">'æšä¸¾å€¼five'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œå¾ˆå¤šæ—¶å€™æšä¸¾å€¼ä¼šæœ‰å åŠ ï¼Œæ¯”å¦‚è¯¥æšä¸¾å€¼æ˜¯æŒ‡è¿è§„é¡¹ï¼Œé‚£ä¹ˆå¯¹åº”çš„å°±ä¼šå­˜åœ¨åŒæ—¶æœ‰å¤šç§è¿è§„ï¼Œæ¯”å¦‚åŒæ—¶è¿åäº†ç¬¬ä¸€é¡¹å’Œç¬¬ä¸‰é¡¹ï¼Œé‚£ä¹ˆåç«¯å°±ä¼šè¿”å›æšä¸¾å€¼5(1+4)ã€‚</p><h2 id="ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4ã€8"><a href="#ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4ã€8" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4ã€8"></a>ä¸ºä»€ä¹ˆæ˜¯1ã€2ã€4ã€8</h2><p>é¦–å…ˆè¿™äº›æ•°éƒ½æ˜¯åè¿›åˆ¶ï¼Œæˆ‘ä»¬è¯´çš„å·¦ç§»å³ç§»æ˜¯é’ˆå¯¹äºŒè¿›åˆ¶æ¥è¯´çš„ï¼Œæ¯”å¦‚0001ï¼Œæˆ‘ä»¬å·¦ç§»åä¼šå˜æˆ0010ï¼Œæ­¤æ—¶0010è½¬ä¸º10è¿›åˆ¶å°±æ˜¯2äº†ï¼Œå¯¹äº2å†å·¦ç§»ï¼Œå°±ä¼šå˜æˆ0100å¯¹åº”çš„åè¿›åˆ¶å°±æ˜¯8ï¼Œä»¥æ­¤ç±»æ¨</p><h2 id="è§£æä½è¿ç®—"><a href="#è§£æä½è¿ç®—" class="headerlink" title="è§£æä½è¿ç®—"></a>è§£æä½è¿ç®—</h2><p>æˆ‘ä»¬å¹¶ä¸éœ€è¦å»æ’åˆ—ç»„åˆï¼Œä½¿ç”¨JavaScriptæä¾›çš„å·¦ç§»å³ç§»æ“ä½œç¬¦å¯ä»¥éå¸¸ç®€æ´çš„å®Œæˆæšä¸¾è½¬æ¢ï¼Œç›´æ¥æ¥å®Œæ•´çš„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dictByBit</span>(<span class="params">dictObj, value, separate = <span class="string">'ã€'</span>, result = <span class="string">""</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Object</span>.prototype.toString.call(dictObj) != <span class="string">"[object Object]"</span>)  <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> dictLocation = []</span><br><span class="line">    <span class="comment">// å°†æšä¸¾è¡¨ä¸­æ¯ä¸€ç§å¯èƒ½çš„æšä¸¾å€¼æ¨å…¥ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(dictObj).forEach(<span class="function"><span class="params">bit</span>=&gt;</span> &#123;</span><br><span class="line">        dictLocation.push(bit)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span>(dictObj[value]) &#123;</span><br><span class="line">        <span class="keyword">return</span> (result?(result + separate):<span class="string">''</span>) + dictObj[value]</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; <span class="number">1024</span>; i++) &#123;</span><br><span class="line">       <span class="comment">// è¿™é‡Œæˆ‘ä»¬å‡è®¾æšä¸¾ä¸Šé™åˆ°1024ï¼Œä½¿ç”¨è¯¥å€¼ç´¯åŠ ï¼Œç›´åˆ°å³ç§»åç­‰äº1</span></span><br><span class="line">       <span class="keyword">if</span>(value &gt;&gt; i === <span class="number">1</span>) &#123;</span><br><span class="line">           <span class="keyword">let</span> afterMove = value - dictLocation[i]</span><br><span class="line">           <span class="keyword">return</span> dictByBit(dictObj, afterMove, separate, (result?(result + separate):<span class="string">''</span>) + dictObj[dictLocation[i]])</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‡½æ•°æ¥å—å››ä¸ªå‚æ•°</p><ul><li>dictObj: æšä¸¾è¡¨</li><li>value: åç«¯è¿”å›çš„æšä¸¾å€¼</li><li>separate: åˆ†éš”ç¬¦ï¼Œå¦‚æšä¸¾å€¼åŒæ—¶æ˜¯3ï¼Œé‚£ä¹ˆå°±æ˜¯1+2ï¼Œå¦‚ã€åˆ†éš”ç¬¦ï¼Œå­—å…¸ç¿»è¯‘åä¼šè¿”å›æšä¸¾å€¼1ã€æšä¸¾å€¼2</li><li>result: è¿™ä¸ªå‚æ•°æ˜¯é€’å½’æ—¶å‡½æ•°é—´ä¼ é€’çš„ï¼Œè°ƒç”¨æ—¶ä¸éœ€è¦</li></ul><p>çœ‹ä¸€ä¸‹ä¸Šé¢çš„å‡½æ•°ï¼Œæœ€é‡è¦çš„éƒ¨åˆ†å°±æ˜¯ä¸‹é¢forå¾ªç¯åçš„å³ç§»ä½ï¼Œæˆ‘è¿™é‡Œä»¥1024ä½ä½œä¸º(å®é™…ä¸å¯èƒ½æšä¸¾åˆ°è¿™ä¹ˆå¤š)å³ç§»ä¸Šé™ã€‚<strong>ç°åœ¨æˆ‘ä»¬å‡è®¾åç«¯è¿”å›äº†ä¸€ä¸ªæšä¸¾å€¼7</strong>ï¼Œæˆ‘ä»¬çš„æšä¸¾è¡¨è¿˜æ˜¯æœ€ä¸Šæ–¹çš„é‚£ä¸ªï¼Œç°åœ¨åˆ†æè¿™ä¸ªå‡½æ•°çš„åŸç†ï¼š</p><ul><li>åç«¯è¿”å›äº†ä¸€ä¸ªæšä¸¾å€¼ä¸º7çš„çš„æšä¸¾å€¼ï¼Œé‚£ä¹ˆå°±ä¸€å®šæ˜¯1+2+4ï¼Œå¯¹äºä½è¿ç®—çš„æšä¸¾ï¼Œåªä¼šæœ‰ä¸€ç§ç»“æœ</li><li>æˆ‘ä»¬å°†7è¿™ä¸ªæšä¸¾å€¼å³ç§»ï¼Œå½“æˆ‘ä»¬<strong>å³ç§»åˆ°å€¼ä¸º1æ—¶</strong>ï¼Œå°±æ‹¿åˆ°äº†è¿™ä¸ªæšä¸¾å€¼ç”±?+?+?ç›¸åŠ çš„<strong>æœ€åä¸€ä½çš„ç´¢å¼•</strong>ï¼Œæˆ‘ä»¬ä»¥æ­¤ä¸ºæ¡ä»¶ï¼Œé€’å½’ï¼Œä»æœ€åä¸€ä½æ‹¿åˆ°ç¬¬ä¸€ä½ï¼Œæœ€åçš„ç»“æœå°±æ˜¯2 1 0ï¼Œè¿™å®é™…æ˜¯ç´¢å¼•ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸€å¼€å§‹æˆ‘ä»¬è¦æŠŠæšä¸¾è¡¨ä¸­çš„å€¼ä¾æ¬¡æ¨å…¥ä¸€ä¸ªæ•°ç»„çš„åŸå› ï¼Œæˆ‘ä»¬é€šè¿‡ç´¢å¼•ä¾¿å¯ä»¥ç›´æ¥æ‹¿åˆ°å¯¹åº”ç¿»è¯‘åçš„å€¼äº†ã€‚</li></ul><p>ä¸ºä»€ä¹ˆè¦å³ç§»å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå› ä¸ºåç«¯å·¦ç§»äº†ï¼Œæˆ‘ä»¬è¦è¿˜åŸå•Šï¼è¿˜æ˜¯ä»¥7ä¸ºä¾‹å­:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> &lt;&lt; <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="number">1</span> &lt;&lt; <span class="number">1</span> <span class="comment">// 2 </span></span><br><span class="line"><span class="number">1</span> &lt;&lt; <span class="number">2</span> <span class="comment">// 4 </span></span><br><span class="line"><span class="number">1</span>+<span class="number">2</span>+<span class="number">4</span> = <span class="number">7</span></span><br></pre></td></tr></table></figure><p>é€’å½’å‡½æ•°æ¯æ¬¡ä¼šè§£æå‡ºä¸€ä¸ªæšä¸¾å€¼ï¼Œæ¯”å¦‚ä¸Šé¢è¯´çš„7ï¼Œæ˜¯1+2+4ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä¸¤æ¬¡é€’å½’ï¼ŒafterMoveå˜é‡éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä¿å­˜äº†æœ¬æ¬¡å€’é€€çš„æšä¸¾å€¼å<strong>å‰©ä¸‹çš„æšä¸¾å’Œ</strong>ã€‚è¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­æ¥çœ‹</p><ul><li>ç¬¬ä¸€æ¬¡æˆ‘ä»¬ä¼ å…¥æšä¸¾å€¼7è¿›å»åï¼Œæ‰§è¡Œå³ç§»ï¼Œå½“i = 2æ—¶ï¼Œå³ç§»å€¼æ˜¯1ï¼Œæ­¤æ—¶2å°±æ˜¯1+2+4çš„æšä¸¾å€¼4ï¼Œå¯¹åº”dictionaryå­—å…¸ä¸­å°±æ˜¯â€æšä¸¾å€¼threeâ€œ</li><li>æˆ‘ä»¬ç”¨7 - 4 = 3ï¼Œ<strong>(è¿™ä¸ª4å°±æ˜¯bitæ•°ç»„[1,2,4,8,16]ä¸­çš„ç´¢å¼•2)</strong>ï¼Œ3å°±æ˜¯ä¸‹ä¸€è½®çš„æšä¸¾å’Œï¼Œä»¥åŒæ ·çš„æ–¹å¼ï¼Œ3å³ç§»1ä½ç­‰äº1ï¼Œé‚£ä¹ˆæ‰§è¡Œ3-2</li><li>æœ€åä¸€è½®æˆ‘ä»¬æ‹¿åˆ°äº†å€¼1ï¼Œ1æœ¬èº«å°±æ˜¯å­—å…¸ä¸­çš„å€¼äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»“æŸé€’å½’ï¼Œæ‹¿åˆ°äº†7å¯¹åº”çš„ä¸‰ä¸ªç»“æœï¼Œä¹Ÿå°±æ˜¯1ã€2ã€4</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä½è¿ç®—æšä¸¾å€¼&quot;&gt;&lt;a href=&quot;#ä½è¿ç®—æšä¸¾å€¼&quot; class=&quot;headerlink&quot; title=&quot;ä½è¿ç®—æšä¸¾å€¼&quot;&gt;&lt;/a&gt;ä½è¿ç®—æšä¸¾å€¼&lt;/h2&gt;&lt;p&gt;ä½è¿ç®—çš„æšä¸¾å€¼å¤§æ¦‚æ˜¯ä¸‹é¢çš„æ ·å­:&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;tab
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="ä½è¿ç®—" scheme="http://localhost:4000/tags/%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    
      <category term="JavaScript" scheme="http://localhost:4000/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡åå°æƒé™ä¸è·¯ç”±çš„é‡æ„</title>
    <link href="http://localhost:4000/2020/08/31/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%90%8E%E5%8F%B0%E6%9D%83%E9%99%90%E4%B8%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E9%87%8D%E6%9E%84/"/>
    <id>http://localhost:4000/2020/08/31/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%90%8E%E5%8F%B0%E6%9D%83%E9%99%90%E4%B8%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E9%87%8D%E6%9E%84/</id>
    <published>2020-08-31T00:39:55.000Z</published>
    <updated>2020-09-30T02:30:04.293Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦é‡æ„"><a href="#ä¸ºä»€ä¹ˆè¦é‡æ„" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é‡æ„"></a>ä¸ºä»€ä¹ˆè¦é‡æ„</h2><p>è€å®è¯´é‡æ„æˆ‘ä¸€ç›´è§‰å¾—æ˜¯ä¸€ä»¶è´¹åŠ›ä¸è®¨å¥½çš„äº‹å„¿ï¼Œä½†æ˜¯è¿™æ¬¡çš„åå°é¡¹ç›®è·¯ç”±é‚£å—ç¡®å®å¤ªä¹±äº†ï¼Œå¤åˆ¶ç²˜è´´ä»¥å‰é¡¹ç›®çš„ï¼Œéå¸¸ç”Ÿç¡¬ï¼Œè¿™ä¹Ÿå¯¼è‡´æƒé™çš„éªŒè¯éå¸¸éº»çƒ¦ï¼Œå› æ­¤è¶ç€è¿˜æ²¡ä¸Šçº¿ï¼ŒèŠ±äº†å¤§åŠå¤©ç»™æ”¹å®Œäº†ã€‚</p><h2 id="é‡æ„çš„æ€è·¯"><a href="#é‡æ„çš„æ€è·¯" class="headerlink" title="é‡æ„çš„æ€è·¯"></a>é‡æ„çš„æ€è·¯</h2><p>è¿™ä¸ªåå°ç®¡ç†æ˜¯æœ‰ä¸¤çº§èœå•çš„ï¼Œå¦‚ä¸‹å›¾</p><p><img src="/BeCoderQ.github.io/2020/08/31/è®°ä¸€æ¬¡åå°æƒé™ä¸è·¯ç”±çš„é‡æ„/power-menu.png" alt="èœå•ç»“æ„"></p><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸¤çº§èœå•ï¼Œé¡¶å±‚çš„èœå•æ§åˆ¶åˆ‡æ¢æ¨¡å—ï¼Œå¹¶å¸¦åŠ¨å·¦ä¾§çš„è¾¹æ èœå•çš„å˜åŒ–ï¼Œè¿™é‡Œå› ä¸ºé¡¹ç›®ç»“æ„çš„å†å²åŸå› ï¼Œé¡¶éƒ¨çš„ä¸€çº§èœå•å’Œå·¦ä¾§çš„èœå•æ˜¯å®Œå…¨åˆ†å¼€ä¸”æ²¡æœ‰å…³ç³»çš„ã€‚é‚£ä¹ˆæˆ‘çš„æ€è·¯å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ æ­¥</p><ul><li>åœ¨æ•°æ®ä¸Šè€¦åˆä¸€çº§èœå•ä¸äºŒçº§èœå•</li><li>å› ä¸ºé¡µé¢å¹¶ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥èœå•å°±ç›´æ¥é€šè¿‡æš´éœ²å‡ºçš„è·¯ç”±å…ƒæ•°æ®æ¥æ¸²æŸ“</li><li>æƒé™é…ç½®ä¸Šï¼Œå› ä¸ºåå°è¿”å›çš„æ˜¯idï¼Œå› æ­¤è¿™äº›idå¯ä»¥ç›´æ¥å†™åœ¨è·¯ç”±é…ç½®çš„metaå±æ€§ä¸­</li><li>åœ¨åç«¯è¿”å›æƒé™çš„é…ç½®æ•°æ®ï¼Œå‰ç«¯å¯¹æ¯”å½“å‰è·¯ç”±åï¼Œé€šè¿‡ä¸€ä¸ªresetRouterå‡½æ•°æ›¿æ¢è·¯ç”±(æ›¿æ¢çš„è·¯ç”±æ˜¯å‰”é™¤æ‰æ— æƒé™é¡µé¢çš„)</li></ul><p>å¤§ä½“ä¸Šå°±æ˜¯è¿™å‡ ä¸ªç‚¹ï¼Œä¸‹é¢çœ‹ä»£ç è¯¦ç»†è¯´</p><h2 id="è€¦åˆä¸€äºŒçº§èœå•"><a href="#è€¦åˆä¸€äºŒçº§èœå•" class="headerlink" title="è€¦åˆä¸€äºŒçº§èœå•"></a>è€¦åˆä¸€äºŒçº§èœå•</h2><p>è€¦åˆä¸¤çº§èœå•éå¸¸ç®€å•ï¼Œæˆ‘çš„åŠæ³•æ˜¯ä½¿ç”¨webpackçš„require.contextæ–¹æ³•ï¼Œé€šè¿‡æ–‡ä»¶åä½œä¸ºkeyè€¦åˆä¸¤çº§èœå•ï¼Œå¹¶å­˜å‚¨åœ¨vuexä¸­ï¼Œå…ˆçœ‹ä¸€ä¸‹è·¯ç”±ç»“æ„ï¼š</p><p><img src="/BeCoderQ.github.io/2020/08/31/è®°ä¸€æ¬¡åå°æƒé™ä¸è·¯ç”±çš„é‡æ„/router-menu.png" alt="è·¯ç”±ç»“æ„"></p><p>modulesæ–‡ä»¶ä¸‹æ˜¯æ‰€æœ‰è·¯ç”±çš„å…ƒæ•°æ®ï¼Œrouter-configæ–‡ä»¶æ˜¯ä¸€äº›é…ç½®è·¯ç”±çš„åŠŸèƒ½å‡½æ•°ï¼Œç„¶åå†çœ‹ä¸€ä¸‹ç”¨äºå­˜å‚¨èœå•æ•°æ®çš„vuexæ•°æ®ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">rootMenus: [</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'é¦–é¡µ'</span>, <span class="attr">path</span>: <span class="string">'/synthesize/home'</span>, <span class="attr">subs</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'é¥æ„Ÿç›‘æµ‹'</span>, <span class="attr">path</span>: <span class="string">'/synthesize/remote-sensing-map'</span>, <span class="attr">id</span>: <span class="string">'remote'</span>, <span class="attr">subs</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'åˆ†è¡¨è®¡ç”µ'</span>, <span class="attr">path</span>: <span class="string">'/synthesize/product-run'</span>, <span class="attr">id</span>: <span class="string">'electric'</span>, <span class="attr">subs</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'æ‰¬å°˜ç›‘æµ‹'</span>, <span class="attr">path</span>: <span class="string">'/synthesize/monitor-map'</span>, <span class="attr">id</span>: <span class="string">'raise-dust'</span>, <span class="attr">subs</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'OBDç›‘æµ‹'</span>, <span class="attr">path</span>: <span class="string">'/synthesize/obd-map'</span>, <span class="attr">id</span>: <span class="string">'obd'</span>, <span class="attr">subs</span>: [] &#125;,</span><br><span class="line">    &#123; <span class="attr">title</span>: <span class="string">'ç³»ç»Ÿç®¡ç†'</span>, <span class="attr">path</span>: <span class="string">'/synthesize/car-setting'</span>, <span class="attr">id</span>: <span class="string">'system'</span>, <span class="attr">subs</span>: [] &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œidå°±æ˜¯å¯¹åº”æ¯ä¸ªæ¨¡å—çš„æ–‡ä»¶åï¼Œsubså°±æ˜¯äºŒçº§èœå•æ•°ç»„ã€‚</p><h3 id="é€šè¿‡require-contextå®Œæˆèœå•çš„åˆæˆ"><a href="#é€šè¿‡require-contextå®Œæˆèœå•çš„åˆæˆ" class="headerlink" title="é€šè¿‡require.contextå®Œæˆèœå•çš„åˆæˆ"></a>é€šè¿‡require.contextå®Œæˆèœå•çš„åˆæˆ</h3><p>åœ¨router-configä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// associateMenuå°†æ ¹æ®æ–‡ä»¶åä¸storeä¸­é¢„è®¾çš„èœå•idå…³è”ï¼Œå°†é¡¶çº§èœå•ä¸äºŒçº§èœå•ç»“åˆ</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">associateMenu</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// getStateæ–¹æ³•æ˜¯æˆ‘å°è£…çš„è·å–storeä¸­stateçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">let</span> rootMenus = getState(<span class="string">'cache'</span>, <span class="string">'rootMenus'</span>),</span><br><span class="line">        originRouters = []</span><br><span class="line">    <span class="keyword">const</span> moduleFiles = <span class="built_in">require</span>.context(<span class="string">'./modules'</span>, <span class="literal">true</span>, /\.js$/)</span><br><span class="line">    moduleFiles.keys().map(<span class="function"><span class="keyword">function</span> (<span class="params">modulePath</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(moduleFiles(modulePath).default) &#123;</span><br><span class="line">            originRouters.push(moduleFiles(modulePath).default)</span><br><span class="line">            rootMenus.map(<span class="function"><span class="params">menu</span>=&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// æ ¹æ®idç»‘å®šåœ¨ä¸€èµ·</span></span><br><span class="line">                <span class="keyword">if</span>(modulePath.includes(menu.id)) &#123;</span><br><span class="line">                    menu.subs = moduleFiles(modulePath).default</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    setState(<span class="string">'cache'</span>, <span class="string">'rootMenus'</span>, rootMenus)</span><br><span class="line">    <span class="comment">// è¿™é‡Œè¿”å›ä¸€ä¸ªåŸå§‹çš„è·¯ç”±å…ƒæ•°æ®ï¼Œç”¨äºè·¯ç”±çš„æ³¨å†Œ</span></span><br><span class="line">    <span class="keyword">return</span> originRouters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è·¯ç”±çš„index.jså¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; associateMenu &#125; <span class="keyword">from</span> <span class="string">'./router-config'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"><span class="keyword">const</span> sonMenus = [].concat(...associateMenu())</span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">&#123;</span><br><span class="line">path: <span class="string">'/synthesize'</span>,</span><br><span class="line">        redirect: <span class="string">'/synthesize'</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "about" */</span> <span class="string">'@/views/frame/Home.vue'</span>),</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">          name: <span class="string">'home'</span>,</span><br><span class="line">          path: <span class="string">'home'</span>,</span><br><span class="line">          component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "home" */</span> <span class="string">'@/views/home/index'</span>),</span><br><span class="line">            meta: &#123;</span><br><span class="line">              title: <span class="string">'é¦–é¡µ'</span>,</span><br><span class="line">              icon: <span class="string">'el-icon-home'</span></span><br><span class="line">            &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">        ...sonMenus</span><br><span class="line">        ]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'/'</span>,</span><br><span class="line">redirect: <span class="string">'/login'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">title: <span class="string">'ç™»å½•'</span>,</span><br><span class="line">path: <span class="string">'/login'</span>,</span><br><span class="line">name: <span class="string">"Login"</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span>=&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/base/login/LoginPageNew'</span>),</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'*'</span>,</span><br><span class="line">redirect: <span class="string">'/404'</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'/404'</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span>=&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/base/error-page/404'</span>),</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™æ ·èœå•å°±åšå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æƒé™äº†</p><h2 id="æƒé™é…ç½®"><a href="#æƒé™é…ç½®" class="headerlink" title="æƒé™é…ç½®"></a>æƒé™é…ç½®</h2><p>æƒé™é€šè¿‡vuexä¸­rootMenusä¸­çš„æƒé™idå±æ€§æ¥åˆ¤æ–­å“ªäº›è·¯ç”±ä¼šè¢«åˆ é™¤</p><h3 id="åŠ¨æ€åˆ·æ–°è·¯ç”±"><a href="#åŠ¨æ€åˆ·æ–°è·¯ç”±" class="headerlink" title="åŠ¨æ€åˆ·æ–°è·¯ç”±"></a>åŠ¨æ€åˆ·æ–°è·¯ç”±</h3><p>é¦–å…ˆçœ‹ä¸€ä¸‹æ€ä¹ˆå®ç°è·¯ç”±çš„åŠ¨æ€åˆ·æ–°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">const</span> createRouter = <span class="function">(<span class="params">routes</span>) =&gt;</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">base: process.env.NODE_ENV === <span class="string">'development'</span>?<span class="string">'/'</span>:<span class="string">'/synthesize/'</span>,</span><br><span class="line">routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(routes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æƒé™è·å–åæ›¿æ¢è·¯ç”±</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resetRouter</span>(<span class="params">routes</span>) </span>&#123;</span><br><span class="line"><span class="keyword">const</span> newRouter = createRouter(routes)</span><br><span class="line">router.matcher = newRouter.matcher</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡æ›¿æ¢è·¯ç”±çš„matcherï¼Œå³åŒ¹é…è§„åˆ™ï¼Œå®ç°åŠ¨æ€çš„è·¯ç”±æ›´æ¢ï¼Œä¸‹é¢æ ¹æ®éœ€è¦ä¿®æ”¹ä¸Šé¢çš„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; associateMenu &#125; <span class="keyword">from</span> <span class="string">'./router-config'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"><span class="keyword">const</span> sonMenus = [].concat(...associateMenu())</span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">&#123;</span><br><span class="line">path: <span class="string">'/synthesize'</span>,</span><br><span class="line">        redirect: <span class="string">'/synthesize'</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "about" */</span> <span class="string">'@/views/frame/Home.vue'</span>),</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">          name: <span class="string">'home'</span>,</span><br><span class="line">          path: <span class="string">'home'</span>,</span><br><span class="line">          component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "home" */</span> <span class="string">'@/views/home/index'</span>),</span><br><span class="line">            meta: &#123;</span><br><span class="line">              title: <span class="string">'é¦–é¡µ'</span>,</span><br><span class="line">                icon: <span class="string">'el-icon-home'</span></span><br><span class="line">            &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">        ...sonMenus</span><br><span class="line">        ]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'/'</span>,</span><br><span class="line">redirect: <span class="string">'/login'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">title: <span class="string">'ç™»å½•'</span>,</span><br><span class="line">path: <span class="string">'/login'</span>,</span><br><span class="line">name: <span class="string">"Login"</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span>=&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/base/login/LoginPageNew'</span>),</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'*'</span>,</span><br><span class="line">redirect: <span class="string">'/404'</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'/404'</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span>=&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/base/error-page/404'</span>),</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// createRouterå‡½æ•°æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå°†åˆ›å»ºä¸€ä¸ªæƒé™è¿‡æ»¤åçš„è·¯ç”±å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> createRouter = <span class="function">(<span class="params">validate</span>) =&gt;</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">base: process.env.NODE_ENV === <span class="string">'development'</span>?<span class="string">'/'</span>:<span class="string">'/synthesize/'</span>,</span><br><span class="line">routes: <span class="keyword">typeof</span> validate === <span class="string">'function'</span>?validate(routes):routes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(routes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æƒé™è·å–åæ›¿æ¢è·¯ç”±</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resetRouter</span>(<span class="params">validate</span>) </span>&#123;</span><br><span class="line"><span class="keyword">const</span> newRouter = createRouter(validate)</span><br><span class="line">router.matcher = newRouter.matcher</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹åçš„é€»è¾‘å˜æˆäº†åœ¨è°ƒç”¨resetRouteræ—¶ä¼ å…¥ä¸€ä¸ªéªŒè¯çš„å›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°çš„å‚æ•°å°±æ˜¯å½“å‰æ‰€æœ‰è·¯ç”±çš„å…ƒæ•°æ®ï¼Œåœ¨ä½¿ç”¨æ—¶å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> getPower() &#123;</span><br><span class="line">  <span class="keyword">let</span> [err, res] = <span class="keyword">await</span> getPower(&#123; ...params &#125;)</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">// è¿™ä¸ªå°±æ˜¯åå°è¿”å›çš„æƒé™æ ‘</span></span><br><span class="line">  <span class="keyword">const</span> powerMetas = res.rows</span><br><span class="line">  resetRouter(<span class="function">(<span class="params">routes</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œç”¨routesä¸powerMetaså¾ªç¯åˆ¤æ–­idæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™å°†è¯¥è·¯ç”±åˆ é™¤</span></span><br><span class="line">    <span class="keyword">let</span> routesChildren = routes[<span class="number">0</span>].children</span><br><span class="line">    routesChildren.map(<span class="function">(<span class="params">route, index</span>)=&gt;</span> &#123;</span><br><span class="line">      powerMetas.forEach(<span class="function"><span class="params">meta</span>=&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span>(æ²¡æœ‰è¯¥ID) &#123;</span><br><span class="line">          <span class="comment">// åˆ é™¤è¯¥è·¯ç”±</span></span><br><span class="line">          routesChildren.splice(index, <span class="number">1</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªå·²ç»è¿‡æ»¤å®Œæˆçš„è·¯ç”±</span></span><br><span class="line">    <span class="keyword">return</span> routes</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘é€šè¿‡æ¥å£è¿”å›çš„æƒé™æ ‘æ¥ä¸å½“å‰æ‰€æœ‰è·¯ç”±è¿›è¡Œæ¯”å¯¹ï¼ŒæŠŠæƒé™idä¸å­˜åœ¨çš„è·¯ç”±åˆ é™¤æ‰ã€‚</p><h3 id="è¿›ä¸€æ­¥ä¿®æ”¹"><a href="#è¿›ä¸€æ­¥ä¿®æ”¹" class="headerlink" title="è¿›ä¸€æ­¥ä¿®æ”¹"></a>è¿›ä¸€æ­¥ä¿®æ”¹</h3><p>è¿™é‡Œå…¶å®å¹¶æ²¡æœ‰åšå®Œï¼Œå› ä¸ºæˆ‘ä»¬çš„èœå•æ˜¯æ ¹æ®vuexçš„rootMenuså±æ€§æ¥æ¸²æŸ“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å•çº¯åˆ é™¤äº†è·¯ç”±æ˜¯æ²¡æœ‰ç”¨çš„ï¼Œé¡µé¢ä¸Šçš„èœå•ä¸Šè¿˜æ˜¯ä¼šæœ‰åˆ é™¤çš„é¡µé¢ï¼Œåªæ˜¯ç‚¹äº†è¿‡åæ— æ³•è®¿é—®è€Œå·²ï¼Œè¿™æ ·ç”¨æˆ·ä½“éªŒæ˜¯å¾ˆå·®çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦æƒ³ä¸€ä¸ªåŠæ³•è®©è·¯ç”±çš„æ•°æ®ä¸vuexä¸­æ¸²æŸ“é¡µé¢çš„æ•°æ®è”ç³»èµ·æ¥ã€‚</p><h3 id="ä½¿ç”¨Proxyç›‘å¬è·¯ç”±çš„ä¿®æ”¹"><a href="#ä½¿ç”¨Proxyç›‘å¬è·¯ç”±çš„ä¿®æ”¹" class="headerlink" title="ä½¿ç”¨Proxyç›‘å¬è·¯ç”±çš„ä¿®æ”¹"></a>ä½¿ç”¨Proxyç›‘å¬è·¯ç”±çš„ä¿®æ”¹</h3><p>è¿™é‡Œæ­£å¥½å¯ä»¥ä½¿ç”¨ä¸Šå‘¨åšå®¢ä»‹ç»çš„Proxyæ¥ç›‘å¬è·¯ç”±ï¼Œåœ¨router-configæ–‡ä»¶ä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observeRouter</span>(<span class="params">router</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬ä»£ç†æ•°ç»„ä¸å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> router === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> router) &#123;</span><br><span class="line">            <span class="comment">// é€’å½’æ·±åº¦ä»£ç†</span></span><br><span class="line">            <span class="keyword">typeof</span> router[key] === <span class="string">'object'</span> &amp;&amp; (router[key] = observeRouter(router[key]))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(router, &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * @param &#123;target&#125; å½“å‰å¯¹è±¡</span></span><br><span class="line"><span class="comment">         * @param &#123;prop&#125; è®¾ç½®å±æ€§å</span></span><br><span class="line"><span class="comment">         * @param &#123;value&#125; æ–°çš„å€¼</span></span><br><span class="line"><span class="comment">         * @param &#123;receiver&#125; æ˜ å°„æ—¶çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">set</span>(target, prop, value, receiver) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`è®¾ç½®äº†ï¼š<span class="subst">$&#123;prop&#125;</span>å±æ€§ï¼Œä¿®æ”¹å€¼ï¼š<span class="subst">$&#123;value&#125;</span>`</span>)</span><br><span class="line">            <span class="comment">// ä»¥ä¸‹æ“ä½œä¸ºåŒæ­¥storeæ¸²æŸ“èœå•</span></span><br><span class="line">            <span class="keyword">let</span> newMenus = getState(<span class="string">'cache'</span>, <span class="string">'rootMenus'</span>) || [],</span><br><span class="line">                deleteXy = [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">            <span class="comment">// è¿™é‡Œåªå¤„ç†ç¬¬äºŒçº§èœå• é¡¶çº§èœå•åœ¨æ¸²æŸ“æ—¶ç›´æ¥é€šè¿‡v-showéšè—</span></span><br><span class="line">            newMenus.map(<span class="function">(<span class="params">menu, mIdx</span>)=&gt;</span> &#123;</span><br><span class="line">                menu.subs.map(<span class="function">(<span class="params">sub, sIdx</span>)=&gt;</span> &#123;</span><br><span class="line">                  <span class="comment">// receiveræ˜¯å•ä¸ªè·¯ç”±çš„é…ç½®å¯¹è±¡</span></span><br><span class="line">                    <span class="keyword">if</span>(sub.name === receiver.name) &#123;</span><br><span class="line">                        deleteXy = [mIdx, sIdx]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            newMenus[deleteXy[<span class="number">0</span>]].subs.splice(deleteXy[<span class="number">1</span>], <span class="number">1</span>)</span><br><span class="line">            <span class="comment">// å°†ä¿®æ”¹åçš„æ•°æ®åŒæ­¥åˆ°vuexä¸­</span></span><br><span class="line">            setState(<span class="string">'cache'</span>, <span class="string">'rootMenus'</span>, newMenus)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, prop, value, receiver)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œæˆ‘ä»¬é€šè¿‡é€’å½’æ¥ç›‘å¬æ•°ç»„å¯¹è±¡ï¼Œå½“æˆ‘ä»¬åˆ é™¤æ•°ç»„åï¼ŒProxyç›‘å¬ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚æˆ‘ç›‘å¬çš„æ•°æ®æ˜¯ä¸€ä¸ªåŒ…å«24ä¸ªå¯¹è±¡çš„æ•°ç»„ï¼Œ<strong>å½“æˆ‘ä»¬åˆ é™¤ç¬¬ä¸‰ä¸ªæ—¶ï¼Œè¿™é‡Œçš„ç›‘å¬å‡½æ•°ä¼šè§¦å‘21æ¬¡ï¼Œå› ä¸ºç¬¬ä¸‰ä¸ªçš„åˆ é™¤å¯¼è‡´äº†æ•°ç»„é•¿åº¦çš„å˜åŒ–ï¼Œæ¢å¥è¯è¯´ï¼Œç°åœ¨è¿™ä¸ªæ•°ç»„â€åå¡Œâ€äº†ã€‚</strong>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åŒ¹é…æƒé™è§„åˆ™æ—¶ç›´æ¥å»åˆ é™¤è·¯ç”±ï¼Œä¼šå¯¼è‡´æˆ‘ä»¬ç›‘å¬ä¸åˆ°å…·ä½“åˆ é™¤çš„ç»“æœã€‚</p><p>å†™å¥½äº†ç›‘å¬å‡½æ•°ï¼Œé‚£ä¹ˆå°±åœ¨index.jsæ–‡ä»¶ä¸­ç›‘å¬è·¯ç”±ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> &#123; associateMenu, observeRouter &#125; <span class="keyword">from</span> <span class="string">'./router-config'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"><span class="keyword">const</span> sonMenus = [].concat(...associateMenu())</span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">&#123;</span><br><span class="line">path: <span class="string">'/synthesize'</span>,</span><br><span class="line">        redirect: <span class="string">'/synthesize'</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "about" */</span> <span class="string">'@/views/frame/Home.vue'</span>),</span><br><span class="line">        children: [</span><br><span class="line">          &#123;</span><br><span class="line">          name: <span class="string">'home'</span>,</span><br><span class="line">          path: <span class="string">'home'</span>,</span><br><span class="line">          component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: "home" */</span> <span class="string">'@/views/home/index'</span>),</span><br><span class="line">            meta: &#123;</span><br><span class="line">              title: <span class="string">'é¦–é¡µ'</span>,</span><br><span class="line">                icon: <span class="string">'el-icon-home'</span></span><br><span class="line">            &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">        ...sonMenus</span><br><span class="line">        ]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'/'</span>,</span><br><span class="line">redirect: <span class="string">'/login'</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">title: <span class="string">'ç™»å½•'</span>,</span><br><span class="line">path: <span class="string">'/login'</span>,</span><br><span class="line">name: <span class="string">"Login"</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span>=&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/base/login/LoginPageNew'</span>),</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'*'</span>,</span><br><span class="line">redirect: <span class="string">'/404'</span>,</span><br><span class="line">&#125;, &#123;</span><br><span class="line">path: <span class="string">'/404'</span>,</span><br><span class="line">component: <span class="function"><span class="params">()</span>=&gt;</span> <span class="keyword">import</span>(<span class="string">'@/views/base/error-page/404'</span>),</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œä»£ç†è·¯ç”±</span></span><br><span class="line"><span class="keyword">let</span> proxyRoutes = observeRouter(routes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// createRouterå‡½æ•°æ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå°†åˆ›å»ºä¸€ä¸ªæƒé™è¿‡æ»¤åçš„è·¯ç”±å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> createRouter = <span class="function">(<span class="params">validate</span>) =&gt;</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">base: process.env.NODE_ENV === <span class="string">'development'</span>?<span class="string">'/'</span>:<span class="string">'/synthesize/'</span>,</span><br><span class="line">routes: <span class="keyword">typeof</span> validate === <span class="string">'function'</span>?validate(proxyRoutes):proxyRoutes</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(proxyRoutes)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æƒé™è·å–åæ›¿æ¢è·¯ç”±</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resetRouter</span>(<span class="params">validate</span>) </span>&#123;</span><br><span class="line"><span class="keyword">const</span> newRouter = createRouter(validate)</span><br><span class="line">router.matcher = newRouter.matcher</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œåœ¨åˆ·æ–°è·¯ç”±é‚£é‡Œæˆ‘ä»¬å°±è¦åƒè¿™æ ·æ”¹ä¸€ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> getPower() &#123;</span><br><span class="line">  <span class="keyword">let</span> [err, res] = <span class="keyword">await</span> getPower(&#123; ...params &#125;)</span><br><span class="line">  <span class="keyword">if</span>(err) <span class="keyword">return</span></span><br><span class="line">  <span class="comment">// è¿™ä¸ªå°±æ˜¯åå°è¿”å›çš„æƒé™æ ‘</span></span><br><span class="line">  <span class="keyword">const</span> powerMetas = res.rows</span><br><span class="line">  resetRouter(<span class="function">(<span class="params">routes</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œç”¨routesä¸powerMetaså¾ªç¯åˆ¤æ–­idæ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™å°†è¯¥è·¯ç”±åˆ é™¤</span></span><br><span class="line">    <span class="keyword">let</span> routesChildren = routes[<span class="number">0</span>].children</span><br><span class="line">    routesChildren.map(<span class="function">(<span class="params">route, index</span>)=&gt;</span> &#123;</span><br><span class="line">      powerMetas.forEach(<span class="function"><span class="params">meta</span>=&gt;</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span>(æ²¡æœ‰è¯¥ID) &#123;</span><br><span class="line">          <span class="comment">// å°†è¯¥è·¯ç”±çš„å¯¼å…¥æ–‡ä»¶è®¾ç½®ä¸ºnull</span></span><br><span class="line">          route.component = <span class="literal">null</span></span><br><span class="line">          route.redirect = <span class="string">'/404'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªå·²ç»è¿‡æ»¤å®Œæˆçš„è·¯ç”±</span></span><br><span class="line">    <span class="keyword">return</span> routes</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬æŠŠæ²¡æœ‰æƒé™çš„è·¯ç”±çš„componenté¡¹è®¾ç½®ä¸ºnullï¼Œè¿™æ ·é¡µé¢å°±æ—¶ç©ºçš„äº†ï¼Œä½†æ˜¯è¯¥è·¯ç”±å…¶å®è¿˜æ˜¯æ³¨å†Œäº†ï¼Œç”¨æˆ·å¦‚æœç›´æ¥è¾“å…¥è·¯å¾„è®¿é—®å¹¶ä¸ä¼šè·³åˆ°404é¡µé¢ï¼Œæ‰€ä»¥åé¢æˆ‘ä»¬æŠŠè¯¥è·¯ç”±é‡å®šå‘åˆ°äº†404é¡µé¢ã€‚</p><h2 id="ä¸€äºŒçº§èœå•çš„è”åŠ¨"><a href="#ä¸€äºŒçº§èœå•çš„è”åŠ¨" class="headerlink" title="ä¸€äºŒçº§èœå•çš„è”åŠ¨"></a>ä¸€äºŒçº§èœå•çš„è”åŠ¨</h2><p>å‰é¢è¯´äº†å› ä¸ºä¸€äº›åŸå› å¯¼è‡´ä¸€çº§èœå•ä¸äºŒçº§èœå•çš„æ–‡ä»¶æ˜¯åˆ†å¼€çš„ï¼Œè¿™é‡Œæˆ‘ä¹Ÿæ²¡æœ‰å†å»æ”¹ç»“æ„ï¼Œæˆ‘ç›´æ¥æ³¨å†Œäº†å…¨å±€äº‹ä»¶ï¼Œé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼å®ç°ä¸€çº§èœå•å¸¦åŠ¨äºŒçº§èœå•çš„æ•ˆæœï¼Œå¦å¤–å¯¹äºç”¨æˆ·ç›´æ¥é€šè¿‡urlè¾“å…¥åèœå•çš„å˜åŒ–æ˜¯é€šè¿‡ç›‘å¬è·¯ç”±ç­‰å®ç°çš„ï¼Œçœ‹çœ‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">watch: &#123;</span><br><span class="line">  <span class="comment">// activeIndexæ˜¯å½“å‰æ¿€æ´»çš„ä¸€çº§èœå•çš„ç´¢å¼•</span></span><br><span class="line">  activeIndex(index) &#123;</span><br><span class="line">      <span class="comment">// æ”¹å˜äº†å°±ç›´æ¥è·³è½¬åˆ°å¯¹äºçš„èœå•</span></span><br><span class="line"><span class="keyword">this</span>.$router.push(<span class="keyword">this</span>._cache.rootMenus[index].path)</span><br><span class="line">      <span class="comment">// è§¦å‘å·¦ä¾§èœå•è®¢é˜…çš„root-menu-changeäº‹ä»¶ï¼Œå°†å½“å‰èœå•çš„æ•°æ®ä¼ è¿‡å»</span></span><br><span class="line"><span class="keyword">this</span>.$bus.$emit(<span class="string">'root-menu-change'</span>, <span class="keyword">this</span>._cache.rootMenus[index])</span><br><span class="line">&#125;,</span><br><span class="line">  $route: &#123;</span><br><span class="line">      handler(route) &#123;</span><br><span class="line">          <span class="comment">// é¡¶çº§èœå•è€¦åˆè·¯ç”±</span></span><br><span class="line">          <span class="keyword">this</span>._cache.rootMenus &amp;&amp; <span class="keyword">this</span>._cache.rootMenus.forEach(<span class="function">(<span class="params">rMenu, rIdx</span>)=&gt;</span> &#123;</span><br><span class="line">            rMenu.subs.length &amp;&amp; rMenu.subs.forEach(<span class="function"><span class="params">menu</span>=&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span>(menu.name === route.name) &#123;</span><br><span class="line">                <span class="keyword">this</span>.activeIndex = <span class="string">''</span> + rIdx</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®Œæˆï¼</strong></p><h2 id="one-more-thing"><a href="#one-more-thing" class="headerlink" title="one more thing"></a>one more thing</h2><p>è¿˜æ²¡å®Œï¼Œå› ä¸ºæˆ‘å‘ç°è¿™ä¸€å¥—æµç¨‹åœ¨IEä¸Šæ˜¯èµ°ä¸é€šçš„ï¼Œå› ä¸ºProxyè¿™ä¸ªAPIåœ¨IEä¸Šæ˜¯ä¸æ”¯æŒçš„ï¼Œå¹¶ä¸”ä¸€èˆ¬çš„polyfillè¿˜æä¸å®šProxyï¼Œæˆ‘å°è¯•äº†è°·æ­Œå¼€å‘Proxy-polyfillå‘ç°å±…ç„¶æ²¡æœ‰æ•ˆæœï¼Œäºæ˜¯ä¹åˆå†™äº†ä¸€ä¸ªæ”¯æŒIEçš„ç‰ˆæœ¬:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observeRouterForIE</span>(<span class="params">target</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> handler = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> target === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="comment">// é€’å½’æ·±åº¦ä»£ç†</span></span><br><span class="line">            <span class="keyword">typeof</span> target[key] === <span class="string">'object'</span> &amp;&amp; (target[key] = observeRouterForIE(target[key]))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Object</span>.keys(target).forEach(<span class="function"><span class="params">key</span>=&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// èµ‹å€¼é¿å…æ ˆæº¢å‡º</span></span><br><span class="line">        <span class="keyword">let</span> currentValue = target[key]</span><br><span class="line">        handler[key] = &#123;</span><br><span class="line">            enumerable: <span class="literal">true</span>,</span><br><span class="line">            configurable: <span class="literal">true</span>,</span><br><span class="line">            <span class="keyword">get</span>: function() &#123; </span><br><span class="line">                <span class="keyword">return</span> currentValue</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">set</span>: function(newVal) &#123;</span><br><span class="line">                currentValue = newVal</span><br><span class="line">                <span class="comment">// ä»¥ä¸‹æ“ä½œä¸ºåŒæ­¥storeæ¸²æŸ“èœå•</span></span><br><span class="line">                changeMenuByRoutes(target)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.defineProperties(target, handler)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯ç”¨definePropertieså»åŠ«æŒæ•°æ®ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹æ˜¯åƒgetä¸set<strong>ä¸è¦ç›´æ¥æ“ä½œtarget[key]</strong>ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä½ å·²ç»åŠ«æŒäº†è¿™ä¸ªå¯¹è±¡ï¼Œå½“ä½ return target[key]æ—¶åˆä¼šè§¦å‘ä¸€æ¬¡getterï¼Œè¿™æ ·ä¸å°±å¥—å¨ƒäº†å—ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦é‡æ„&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆè¦é‡æ„&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆè¦é‡æ„&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆè¦é‡æ„&lt;/h2&gt;&lt;p&gt;è€å®è¯´é‡æ„æˆ‘ä¸€ç›´è§‰å¾—æ˜¯ä¸€ä»¶è´¹åŠ›ä¸è®¨å¥½çš„äº‹å„¿ï¼Œä½†æ˜¯è¿™æ¬¡çš„åå°é¡¹ç›®è·¯ç”±é‚£å—ç¡®å®å¤ªä¹±äº†ï¼Œå¤åˆ¶ç²˜è´´ä»¥å‰é¡¹ç›®çš„ï¼Œéå¸¸ç”Ÿ
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="Proxy" scheme="http://localhost:4000/tags/Proxy/"/>
    
      <category term="Vue" scheme="http://localhost:4000/tags/Vue/"/>
    
      <category term="é‡æ„" scheme="http://localhost:4000/tags/%E9%87%8D%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>æŸ¯é‡ŒåŒ–å‡½æ•°</title>
    <link href="http://localhost:4000/2020/08/24/%E6%9F%AF%E9%87%8C%E5%8C%96%E5%87%BD%E6%95%B0/"/>
    <id>http://localhost:4000/2020/08/24/%E6%9F%AF%E9%87%8C%E5%8C%96%E5%87%BD%E6%95%B0/</id>
    <published>2020-08-24T12:10:33.000Z</published>
    <updated>2020-09-01T03:14:39.657Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–"><a href="#ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–" class="headerlink" title="ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–"></a>ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–</h2><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ±‚ä¸¤ä¸ªæ•°å’Œçš„å‡½æ•°ï¼Œé‚£ä¹ˆä¸€èˆ¬æƒ…å†µä¸‹ä»–çš„è°ƒç”¨çš„æ˜¯è¿™æ ·:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">sum(a, b)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†è¿™ä¸ªå‡½æ•°æŸ¯é‡ŒåŒ–:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> currySum = curry(sum)</span><br><span class="line">currySum(a)(b)</span><br></pre></td></tr></table></figure><p>æŸ¯é‡ŒåŒ–ä¸ä¼šè°ƒç”¨å‡½æ•°ï¼Œåªæ˜¯å¯¹å‡½æ•°è¿›è¡Œè½¬æ¢ã€‚</p><h2 id="æœ€ç®€å•çš„æŸ¯é‡ŒåŒ–"><a href="#æœ€ç®€å•çš„æŸ¯é‡ŒåŒ–" class="headerlink" title="æœ€ç®€å•çš„æŸ¯é‡ŒåŒ–"></a>æœ€ç®€å•çš„æŸ¯é‡ŒåŒ–</h2><p>å°±æ‹¿ä¸¤æ•°æ±‚å’Œçš„ä¾‹å­æ¥è¯´:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> fn(a, b)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> currySum = curry(sum)</span><br><span class="line">currySum(<span class="number">1</span>)(<span class="number">2</span>) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œcurryå‡½æ•°æ¥å—ä¸€ä¸ªå›è°ƒåè¿”å›ç¬¬ä¸€å±‚å‡½æ•°ï¼Œç¬¬ä¸€å±‚å‡½æ•°æ‰§è¡Œåè¿”å›ç¬¬äºŒå±‚ï¼Œç¬¬äºŒå±‚æ‰§è¡Œåå°†a,bå‚æ•°ä¼ å…¥å›è°ƒå‡½æ•°fn</p><h2 id="æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–"><a href="#æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–" class="headerlink" title="æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–"></a>æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–</h2><p>æ¥ä¸‹æ¥å®Œæˆä¸€ä¸ªå‡½æ•°ï¼Œå®ç°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arg.reduce(<span class="function">(<span class="params">p,n</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p+n</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">let</span> currySum = curry(sum)</span><br><span class="line">currySum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)() <span class="comment">// 6</span></span><br><span class="line">currySum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)(<span class="number">5</span>)() <span class="comment">// 15</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™é‡ŒæŸ¯é‡ŒåŒ–åçš„å‡½æ•°å…¶å®è¿˜æœ‰ä¸ªæ‰§è¡Œçš„èŠ±æ‹¬å·ï¼Œæ˜¯æ²¡æœ‰ä¼ å‚ï¼Œå› æ­¤åœ¨èŠ±æ‹¬å·å‰é¢æˆ‘ä»¬æ‹¿åˆ°çš„åº”è¯¥æ˜¯æ‰€æœ‰å‚æ•°çš„åˆé›†ï¼Œæœ€åçš„èŠ±æ‹¬å·ä»£è¡¨fn(1,2,3,4,5â€¦)è¿™æ ·çš„ç»“æœã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> args.reduce(<span class="function">(<span class="params">p,n</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p+n</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">currySum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™æ˜¯ç¬¬äºŒä¸ªæ‹¬å·å¼€å§‹çš„è¿”å›å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args2</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// åœ¨è¿™é‡Œåˆ¤æ–­æ˜¯å¦è¯¥å®Œç»“æ­¤æ¬¡æŸ¯é‡ŒåŒ–</span></span><br><span class="line">            <span class="keyword">if</span>(!args2.length) &#123;</span><br><span class="line">                <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, args)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// åä¹‹åˆ™ç»§ç»­é€’å½’</span></span><br><span class="line">            <span class="keyword">return</span> currySum.apply(<span class="keyword">this</span>, [...args, ...args2])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> currySum = curry(sum)</span><br><span class="line">currySum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)() <span class="comment">// 6 </span></span><br><span class="line">currySum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>)() <span class="comment">// 10</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦æ³¨æ„:</p><ul><li>é€šè¿‡ç¬¬äºŒä¸ªè¿”å›å‡½æ•°ä¸­çš„å‚æ•°args2æ¥åˆ¤æ–­æ˜¯å¦å®Œç»“æŸ¯é‡ŒåŒ–</li><li>å®Œç»“åçš„å‚æ•°æ˜¯argsè€Œä¸æ˜¯args2ï¼Œargs2æ°¸è¿œåªæ˜¯æœ€æ–°çš„ä¸€æ¬¡è°ƒç”¨ä¼ å‚</li><li>æ²¡æœ‰å®Œç»“æŸ¯é‡ŒåŒ–æ—¶é€’å½’è°ƒç”¨å¤–å±‚çš„è¿”å›å‡½æ•°ï¼Œå¹¶ä¸”è¦å°†ä¸Šä¸€æ¬¡çš„å‚æ•°åˆå¹¶</li></ul><h3 id="æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–æ‰©å±•â€“å»æ‰åé¢çš„æ‹¬å·"><a href="#æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–æ‰©å±•â€“å»æ‰åé¢çš„æ‹¬å·" class="headerlink" title="æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–æ‰©å±•â€“å»æ‰åé¢çš„æ‹¬å·"></a>æ— é™æ±‚å’ŒæŸ¯é‡ŒåŒ–æ‰©å±•â€“å»æ‰åé¢çš„æ‹¬å·</h3><p>ä¸Šé¢çš„ä¾‹å­é‡Œé¢æœ€åæ€»æ˜¯è¦æ‰“ä¸€ä¸ªæ‹¬å·æ¥æ‰§è¡Œå‡½æ•°ï¼Œä¸‹é¢ä¼˜åŒ–ä¸€ä¸‹å®ç°currySum(1)(2)(3)ç›´æ¥è¾“å‡º6çš„æ•ˆæœ</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">currySum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿™é‡Œå£°æ˜å‡½æ•° èµ‹ç»™ä¸€ä¸ªå˜é‡</span></span><br><span class="line">        <span class="keyword">let</span> sumFn = <span class="function"><span class="keyword">function</span>(<span class="params">...args2</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!args2.length) &#123;</span><br><span class="line">                <span class="keyword">return</span> fn.apply(<span class="keyword">this</span>, args)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> currySum(...args.concat(args2))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡ç‚¹ï¼Œæˆ‘ä»¬é‡å†™äº†sumFnå‡½æ•°toStringæ–¹æ³•ï¼Œè®©ä»–è¿”å›sumFnå‡½æ•°çš„æ‰§è¡Œç»“æœ</span></span><br><span class="line">        sumFn.toString = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> sumFn()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sumFn</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> args.reduce(<span class="function">(<span class="params">p,n</span>)=&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> p+n</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> currySum = curry(sum)</span><br><span class="line">currySum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>) <span class="comment">// 6</span></span><br><span class="line">currySum(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>)(<span class="number">4</span>) <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–&lt;/h2&gt;&lt;p&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ±‚ä¸¤ä¸ªæ•°å’Œçš„å‡½æ•°ï¼Œé‚£ä¹ˆä¸€èˆ¬æƒ…å†µä¸‹ä»–çš„è°ƒç”¨çš„æ˜¯è¿™æ ·:&lt;/p&gt;
&lt;figure class=&quot;hi
      
    
    </summary>
    
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="http://localhost:4000/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="æŸ¯é‡ŒåŒ–" scheme="http://localhost:4000/tags/%E6%9F%AF%E9%87%8C%E5%8C%96/"/>
    
      <category term="currying" scheme="http://localhost:4000/tags/currying/"/>
    
  </entry>
  
  <entry>
    <title>ES6-Proxyä¸Reflect</title>
    <link href="http://localhost:4000/2020/08/20/ES6-Proxy%E4%B8%8EReflect/"/>
    <id>http://localhost:4000/2020/08/20/ES6-Proxy%E4%B8%8EReflect/</id>
    <published>2020-08-20T07:02:17.000Z</published>
    <updated>2020-08-28T01:46:19.359Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h2><p>ProxyåŒ…è£…å¯¹è±¡çš„æ–¹æ³•</p><table><thead><tr><th>å†…éƒ¨æ–¹æ³•</th><th>Handleræ–¹æ³•</th><th>ä½•æ—¶è§¦å‘</th></tr></thead><tbody><tr><td>[[Get]]</td><td>get</td><td>è¯»å–å±æ€§</td></tr><tr><td>[[Set]]</td><td>set</td><td>å†™å…¥å±æ€§</td></tr><tr><td>[[HasProperty]]</td><td>has</td><td>inæ“ä½œç¬¦(key in obj)</td></tr><tr><td>[[Delete]]</td><td>deleteProperty</td><td>deleteæ“ä½œç¬¦</td></tr><tr><td>[[Call]]</td><td>apply</td><td>å‡½æ•°è°ƒç”¨ä¸Šä¸‹æ–‡ç»‘å®š</td></tr><tr><td>[[Construct]]</td><td>construct</td><td>newæ“ä½œç¬¦ï¼Œæ„é€ å‡½æ•°</td></tr><tr><td>[[GetPrototypeOf]]</td><td>getPrototypeOf</td><td>Object.getPrototypeOf</td></tr><tr><td>[[SetPrototypeOf]]</td><td>setPrototypeOf</td><td>Object.setPrototypeOf</td></tr><tr><td>[[IsExtensible]]</td><td>isExtensible</td><td>Object.isExtensible(å†³å®šå¯¹è±¡æ˜¯å¦å¯æ‰©å±•)</td></tr><tr><td>[[PreventExtensions]]</td><td>preventExtensions</td><td>Object.preventExtensions</td></tr><tr><td>[[DefineOwnProperty]]</td><td>defineProperty</td><td>Object.defineProperty/defineProperties</td></tr><tr><td>[[GetOwnProperty]]</td><td>getOwnPropertyDescriptor</td><td>Object.getOwnPropertyDescriptor,<br>forâ€¦in/Object.keys/Object.values/Object.entries</td></tr><tr><td>[[OwnPropertyKeys]]</td><td>ownKeys</td><td>Object.getOwnPropertyNames, Object.getOwnPropertySymbols, for..in, Object/keys/values/entries</td></tr></tbody></table><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>è¿™é‡Œæˆ‘ä»¬ç”¨getã€setå’ŒdeletePropertyä½œä¸ºä¾‹å­:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">  userName: <span class="string">'Chow'</span>,</span><br><span class="line">  _userId: <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user = <span class="keyword">new</span> <span class="built_in">Proxy</span>(user, &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, prop) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`è¯»å–å±æ€§:<span class="subst">$&#123;prop&#125;</span>`</span>)</span><br><span class="line">      <span class="keyword">return</span> target[prop]</span><br><span class="line">    &#125;,</span><br><span class="line">  <span class="keyword">set</span>(target, prop, value) &#123;</span><br><span class="line">      <span class="keyword">if</span>(target[prop].startsWith(<span class="string">'_'</span>)) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="string">'can not change value'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          target[prop] = value</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  deleteProperty(target, prop) &#123;</span><br><span class="line">      <span class="keyword">if</span>(target[prop].startsWith(<span class="string">'_'</span>)) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="string">'can not delete property that start with _'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">delete</span> target[prop]</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨æ— æ³•åˆ é™¤ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„key</span></span><br><span class="line"><span class="keyword">const</span> name = user.userName <span class="comment">// è¾“å‡º è¯»å–å±æ€§:userName</span></span><br><span class="line">user._userId = <span class="number">321</span> <span class="comment">// throw error: can not change value</span></span><br><span class="line"><span class="keyword">delete</span> user._userId <span class="comment">// throw error: can not delete property that start with _</span></span><br></pre></td></tr></table></figure><p>å½“è¯»å–å€¼æ—¶ä¼šæ‰“å°è¯»å–çš„å±æ€§åï¼Œå½“å­—æ®µä»¥_å¼€å¤´æ—¶å°†æ— æ³•åˆ é™¤ä¸ä¿®æ”¹</p><h3 id="thisæŒ‡å‘é—®é¢˜"><a href="#thisæŒ‡å‘é—®é¢˜" class="headerlink" title="thisæŒ‡å‘é—®é¢˜"></a>thisæŒ‡å‘é—®é¢˜</h3><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥å¦‚é¢„æœŸçš„å¾—åˆ°ç»“æœï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨å‡½æ•°ï¼Œå°±ä¼šå‘ç”Ÿæ„å¤–ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    _name: <span class="string">"User"</span>,</span><br><span class="line">    <span class="keyword">get</span> name() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> userProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(user, &#123;</span><br><span class="line">    <span class="keyword">get</span>(target, prop) &#123;</span><br><span class="line">      <span class="keyword">return</span> target[prop] <span class="comment">// target = user</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> admin = &#123;</span><br><span class="line">    __proto__: userProxy,</span><br><span class="line">    _name: <span class="string">"Admin"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(admin.name) <span class="comment">// è¾“å‡º "User"</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬çš„æœ¬æ„æ˜¯è®©adminç»§æ‰¿userå¯¹è±¡ï¼Œè®¿é—®admin.nameæ—¶æ‰“å°å‡ºâ€Adminâ€ï¼Œä½†æœ€åè¾“å‡ºçš„ç»“æœå´æ˜¯â€Userâ€ï¼Œåˆ†æä¸€ä¸‹è¿‡ç¨‹ï¼š</p><ul><li>userå¯¹è±¡ä¸­è®¾ç½®äº†getterï¼Œè¿”å›ç§æœ‰å±æ€§_name</li><li>userè¢«ä»£ç†ï¼Œè®¾ç½®äº†getteræ‹¦æˆªå™¨ï¼Œè¿”å›target[prop]ï¼Œè¿™é‡Œçš„targetæ˜¯user</li><li>åˆ›å»ºadminå¯¹è±¡å¹¶ç»§æ‰¿ä»£ç†åçš„userå¯¹è±¡</li><li>è°ƒç”¨admin.nameï¼Œadminä¸­æ²¡æœ‰nameå±æ€§ï¼Œä¾¿é¡ºç€åŸå‹é“¾æ‰¾åˆ°userProxy</li><li>äºæ˜¯è°ƒç”¨ä»£ç†userProxyçš„nameå±æ€§ï¼Œå†æ¬¡è§¦å‘getteræ‹¦æˆªå™¨ï¼Œè¿™ä¸ªæ—¶å€™ä¼šä»åŸå§‹å¯¹è±¡ä¸­è¿”å›target[prop]ï¼Œæ­¤æ—¶çš„targetè¿˜æ˜¯user</li></ul><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è°ƒç”¨admin.nameæœ€åæ‰§è¡Œçš„è¿˜æ˜¯user.nameï¼</p><h3 id="ä½¿ç”¨Reflectè§£å†³æŒ‡å‘é—®é¢˜"><a href="#ä½¿ç”¨Reflectè§£å†³æŒ‡å‘é—®é¢˜" class="headerlink" title="ä½¿ç”¨Reflectè§£å†³æŒ‡å‘é—®é¢˜"></a>ä½¿ç”¨Reflectè§£å†³æŒ‡å‘é—®é¢˜</h3><p>åœ¨proxyä»£ç†çš„æ‹¦æˆªå™¨ä¸­ï¼Œæœ‰ä¸€ä¸ªreceiverå‚æ•°ï¼Œé€šè¿‡å®ƒæˆ‘ä»¬èƒ½å¤Ÿå–åˆ°æ­£ç¡®çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> user = &#123;</span><br><span class="line">    _name: <span class="string">"User"</span>,</span><br><span class="line">    <span class="keyword">get</span> name() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>._name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> userProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(user, &#123;</span><br><span class="line">    <span class="keyword">get</span>(target, prop, receiver) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, prop, receiver)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> admin = &#123;</span><br><span class="line">    __proto__: userProxy,</span><br><span class="line">    _name: <span class="string">"Admin"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(admin.name) <span class="comment">// è¾“å‡º "Admin"</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„receiverå°±æ˜¯adminå¯¹è±¡äº†ï¼Œå› æ­¤admin.nameæ­£ç¡®è¾“å‡ºäº†â€Adminâ€</p><h2 id="Proxyçš„é™åˆ¶"><a href="#Proxyçš„é™åˆ¶" class="headerlink" title="Proxyçš„é™åˆ¶"></a>Proxyçš„é™åˆ¶</h2><p>å¯¹äºå¯¹è±¡æ•°ç»„æˆ‘ä»¬å¯ä»¥ç›´æ¥ç›‘å¬ï¼Œå¯¹äºå¯¹è±¡æ•°ç»„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é€’å½’éå†æ¥ç›‘å¬ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observeObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ç›‘å¬ä»£ç†æ•°ç»„ä¸å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> obj === <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj) &#123;</span><br><span class="line">            <span class="comment">// é€’å½’æ·±åº¦ä»£ç†</span></span><br><span class="line">            <span class="keyword">typeof</span> obj[key] === <span class="string">'object'</span> &amp;&amp; (obj[key] = observeRouter(obj[key]))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> person = [</span><br><span class="line">&#123; <span class="attr">name</span>: <span class="string">'zhou'</span>, <span class="attr">job</span>: <span class="string">'programmer'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">'li'</span>, <span class="attr">job</span>: <span class="string">'teacher'</span> &#125;                     </span><br><span class="line">]                     </span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> personProxy = observeObject(person) <span class="comment">// ä»£ç†å¤æ‚æ•°ç»„</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä¸€äº›å†…å»ºå¯¹è±¡ï¼Œå¦‚<strong>Map</strong>ã€<strong>Set</strong>ã€<strong>Date</strong>ã€<strong>Promise</strong>ç­‰éƒ½æ˜¯ç”¨äº†<strong>å†…éƒ¨æ’æ§½(Internal slot)</strong>ã€‚</p><h3 id="å†…å»ºå±æ€§çš„å†…éƒ¨æ’æ§½"><a href="#å†…å»ºå±æ€§çš„å†…éƒ¨æ’æ§½" class="headerlink" title="å†…å»ºå±æ€§çš„å†…éƒ¨æ’æ§½"></a>å†…å»ºå±æ€§çš„å†…éƒ¨æ’æ§½</h3><p>å¦‚<strong>Map</strong>å¯¹è±¡ï¼Œä»–çš„å†…éƒ¨æˆå‘˜è¢«æ”¾åœ¨<strong>[[MapData]]</strong>ä¸­ï¼Œè¯¸å¦‚<strong>get</strong>å†…å»ºæ–¹æ³•èƒ½å¤Ÿä¸ä½¿ç”¨<strong>[[Get]]</strong>ç›´æ¥è®¿é—®åˆ°å…¶ä¸­çš„å±æ€§ï¼Œä»ä¸Šé¢çš„Proxyè¡¨å¯ä»¥çœ‹åˆ°ï¼Œgetæ‹¦æˆªå™¨æ˜¯é€šè¿‡<strong>[[Get]]</strong>å†…å»ºæ–¹æ³•æ¥æ‹¦æˆªgetterï¼Œå› æ­¤Proxyæ— æ³•æ‹¦æˆªå®ƒä»¬ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬åƒä¸‹é¢è¿™æ ·ç›´æ¥ä»£ç†Mapæ˜¯è¡Œä¸é€šçš„</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(), mapProxy</span><br><span class="line"></span><br><span class="line">map.set(<span class="string">'name'</span>, <span class="string">'zhou'</span>)</span><br><span class="line">mapProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(map, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">mapProxy.get(<span class="string">'name'</span>) <span class="comment">// æŠ¥é”™ï¼šUncaught TypeError: Method Map.prototype.get called on incompatible receiver [object Object]</span></span><br></pre></td></tr></table></figure><p>ä»£ç†å¯¹è±¡æ²¡æœ‰<strong>[[MapData]]</strong>æ’æ§½ï¼Œè°ƒç”¨mapProxy.getåï¼Œå†…å»ºæ–¹æ³•ä¼šè°ƒç”¨<strong>Map.prototype.getå»è®¿é—®this.[[MapData]]</strong>ï¼Œä½†æ­¤æ—¶thisæ˜¯proxyï¼Œproxyä¸­å¹¶æ²¡æœ‰è¯¥æ’æ§½ï¼Œå› æ­¤æŠ¥é”™ã€‚</p><h3 id="è§£å†³éƒ¨åˆ†å†…å»ºå¯¹è±¡æ— æ³•ä»£ç†"><a href="#è§£å†³éƒ¨åˆ†å†…å»ºå¯¹è±¡æ— æ³•ä»£ç†" class="headerlink" title="è§£å†³éƒ¨åˆ†å†…å»ºå¯¹è±¡æ— æ³•ä»£ç†"></a>è§£å†³éƒ¨åˆ†å†…å»ºå¯¹è±¡æ— æ³•ä»£ç†</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(), mapProxy</span><br><span class="line"></span><br><span class="line">map.set(<span class="string">'name'</span>, <span class="string">'zhou'</span>)</span><br><span class="line">mapProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(map, &#123;</span><br><span class="line">  <span class="keyword">get</span>(target, prop, receiver) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="built_in">Reflect</span>.get(target, prop, receiver)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">typeof</span> value === <span class="string">'function'</span>?value.bind(target):value</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">mapProxy.get(<span class="string">'name'</span>) <span class="comment">// è¾“å‡ºï¼šzhou</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬æŠŠthisç»‘å®šåˆ°äº†Mapå¯¹è±¡ä¸Šï¼Œä»£ç†çš„Mapæ­£å¸¸å·¥ä½œäº†ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Proxy&quot;&gt;&lt;a href=&quot;#Proxy&quot; class=&quot;headerlink&quot; title=&quot;Proxy&quot;&gt;&lt;/a&gt;Proxy&lt;/h2&gt;&lt;p&gt;ProxyåŒ…è£…å¯¹è±¡çš„æ–¹æ³•&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å†…éƒ¨æ–¹æ³•&lt;/th&gt;
&lt;th&gt;Ha
      
    
    </summary>
    
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="http://localhost:4000/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="Proxy" scheme="http://localhost:4000/tags/Proxy/"/>
    
      <category term="Reflect" scheme="http://localhost:4000/tags/Reflect/"/>
    
  </entry>
  
  <entry>
    <title>Typescriptå†ä½“éªŒ---ä¸€äº›å¼€å‘ä¸­çš„æ‚è°ˆ</title>
    <link href="http://localhost:4000/2020/08/10/Typescript%E5%86%8D%E4%BD%93%E9%AA%8C-%E4%B8%80%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E6%9D%82%E8%B0%88/"/>
    <id>http://localhost:4000/2020/08/10/Typescript%E5%86%8D%E4%BD%93%E9%AA%8C-%E4%B8%80%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E6%9D%82%E8%B0%88/</id>
    <published>2020-08-10T12:13:37.000Z</published>
    <updated>2020-08-10T12:49:47.280Z</updated>
    
    <content type="html"><![CDATA[<h2 id="keyofæ˜ å°„"><a href="#keyofæ˜ å°„" class="headerlink" title="keyofæ˜ å°„"></a>keyofæ˜ å°„</h2><p>keyofè¿™ä¸ªå…³é”®å­—åœ¨tsä¸­å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹çš„Readonly Partial typeï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Readonlyå°†interfaceæˆ–typeä¸­çš„æ‰€æœ‰å±æ€§è½¬ä¸ºåªè¯»é¡¹</span></span><br><span class="line"><span class="keyword">type</span> Readonly&lt;T&gt; = &#123;</span><br><span class="line">  readonly [K <span class="keyword">in</span> keyof T]: T[K]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ï¼š</span></span><br><span class="line"><span class="keyword">type</span> Person = &#123;</span><br><span class="line">  name: <span class="built_in">string</span>,</span><br><span class="line">  age: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person: ReadOnly&lt;Person&gt; = &#123;</span><br><span class="line">  name: <span class="string">'chow'</span>,</span><br><span class="line">  age: <span class="number">23</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.age = <span class="number">22</span> <span class="comment">// ç¼–è¯‘æŠ¥é”™ å› ä¸ºageæ˜¯åªè¯»å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Partialå°†interfaceæˆ–typeä¸­çš„æ‰€æœ‰å±æ€§è½¬ä¸ºéå¿…é€‰é¡¹</span></span><br><span class="line"><span class="keyword">type</span> Partial&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨å¯ä»¥åªä¼ å…¥ä¸€ä¸ªå±æ€§ç”šè‡³ä¸ä¼ </span></span><br><span class="line"><span class="keyword">const</span> person: Partial&lt;Person&gt; = &#123;</span><br><span class="line">  name: <span class="string">'chow'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªéå¸¸ä¸¥è°¨çš„å­—å…¸è¯»å–å‡½æ•°:</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getValue</span>&lt;<span class="title">T</span>, <span class="title">K</span> <span class="title">extends</span> <span class="title">keyof</span> <span class="title">T</span>&gt;(<span class="params">obj: T, key: K</span>): <span class="title">T</span>[<span class="title">K</span>] </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> obj[key]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getValue(&#123; name: <span class="string">'chow'</span> &#125;, <span class="string">'name'</span>) <span class="comment">// chow</span></span><br></pre></td></tr></table></figure><p>åŒæ ·æ˜¯ä½¿ç”¨äº†æ³›å‹ keyof</p><h2 id="ä½¿ç”¨è£…é¥°å™¨å°è£…é˜²æŠ–å‡½æ•°"><a href="#ä½¿ç”¨è£…é¥°å™¨å°è£…é˜²æŠ–å‡½æ•°" class="headerlink" title="ä½¿ç”¨è£…é¥°å™¨å°è£…é˜²æŠ–å‡½æ•°"></a>ä½¿ç”¨è£…é¥°å™¨å°è£…é˜²æŠ–å‡½æ•°</h2><p>æœ€è¿‘æˆ‘å¼€å‘è‡ªå·±çš„åšå®¢æœ‰ä¸€ä¸ªä¸Šæ‹‰åŠ è½½çš„åŠŸèƒ½ï¼Œæˆ‘ä½¿ç”¨äº†é˜²æŠ–åŒ…è£…ï¼Œä½†åé¢ä¸€ä¸ªè¾“å…¥æ¡†åˆéœ€è¦é˜²æŠ–ï¼Œäºæ˜¯æˆ‘æ‰“ç®—ç”¨è£…é¥°å™¨å°è£…ï¼Œè¾¾åˆ°ä¸€ä¸‹æ•ˆæœ</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    components: &#123; LoadingWaves &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Article <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    <span class="keyword">private</span> loading: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">private</span> noMore: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">private</span> pageNum: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">...</span><br><span class="line">    <span class="comment">// åªéœ€ä¼ å…¥å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line">    <span class="meta">@debounce</span>(<span class="number">500</span>)</span><br><span class="line">    <span class="keyword">public</span> loadMore() &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.noMore) <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">this</span>.pageNum++</span><br><span class="line">        <span class="keyword">this</span>.loading = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">this</span>.loading = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">this</span>.getArticle()</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è£…ï¼š</p><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">delay: <span class="built_in">number</span></span>): <span class="title">Function</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timer: <span class="built_in">number</span> | <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span>, descriptor: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸€å®šè¦å…ˆå°†æœ¬æ¬¡æ‰§è¡Œçš„å‡½æ•°æ‹·è´åˆ°å˜é‡ä¸­</span></span><br><span class="line">        <span class="keyword">const</span> aimFunction = descriptor.value</span><br><span class="line">        descriptor.value = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> args: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt;</span><br><span class="line">            <span class="keyword">if</span>(timer) clearTimeout(timer)</span><br><span class="line">          <span class="comment">// ç¬¬ä¸€ä¸ªæ˜¯ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæ‹·è´åç»­å‚æ•°</span></span><br><span class="line">            args = [...arguments].slice(<span class="number">1</span>)</span><br><span class="line">            timer = setTimeout(<span class="function"><span class="params">()</span>=&gt;</span> &#123;</span><br><span class="line">                aimFunction.apply(<span class="keyword">this</span>, args)</span><br><span class="line">                timer = <span class="literal">null</span></span><br><span class="line">            &#125;, delay) </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦æ˜ç¡®ï¼Œtsä¸­å‡½æ•°è£…é¥°å™¨ä¼šæ‹¿åˆ°ä¸‰ä¸ªå‚æ•°:</p><ul><li>targetï¼Œè£…é¥°å‡½æ•°æ‰€åœ¨ç±»çš„æ„é€ å‡½æ•°</li><li>keyï¼Œè¯¥å‡½æ•°çš„åç§°ï¼Œå³Function.name</li><li>descriptorï¼Œå³Object.defineProperty() çš„ç¬¬ä¸‰ä¸ªå‚æ•° descrideptor</li></ul><p>è¿™é‡Œä¸ºäº†æ¥å—è‡ªå®šä¹‰å‚æ•°ï¼Œæˆ‘ä»¬ç”¨äº†é—­åŒ…ï¼Œè¿”å›äº†ä¸€ä¸ªå‡½æ•°ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;keyofæ˜ å°„&quot;&gt;&lt;a href=&quot;#keyofæ˜ å°„&quot; class=&quot;headerlink&quot; title=&quot;keyofæ˜ å°„&quot;&gt;&lt;/a&gt;keyofæ˜ å°„&lt;/h2&gt;&lt;p&gt;keyofè¿™ä¸ªå…³é”®å­—åœ¨tsä¸­å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹çš„Readonly Partial typeï¼š&lt;/
      
    
    </summary>
    
    
      <category term="ç»éªŒ" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C/"/>
    
    
      <category term="Typescript" scheme="http://localhost:4000/tags/Typescript/"/>
    
  </entry>
  
  <entry>
    <title>uni-appä¸­åˆ©ç”¨webviewæ ‡ç­¾ä½¿ç”¨åŸç”Ÿjsé«˜å¾·åœ°å›¾</title>
    <link href="http://localhost:4000/2020/07/17/uni-app%E4%B8%AD%E5%88%A9%E7%94%A8webview%E6%A0%87%E7%AD%BE%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9Fjs%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE/"/>
    <id>http://localhost:4000/2020/07/17/uni-app%E4%B8%AD%E5%88%A9%E7%94%A8webview%E6%A0%87%E7%AD%BE%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9Fjs%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE/</id>
    <published>2020-07-17T01:54:16.000Z</published>
    <updated>2020-07-17T04:19:43.274Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾</h2><p>é¦–å…ˆè¯´ä¸€ä¸‹åŸå› ï¼Œè™½ç„¶uni-appè‡ªå¸¦çš„mapä¹Ÿæ˜¯é«˜å¾·åœ°å›¾ï¼Œä½†æ˜¯è¿™åœ°å›¾ç¡®å®å¤ªé¸¡è‚‹äº†ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½æ²¡æœ‰ï¼Œè‡ªå®šä¹‰çš„ç¨‹åº¦ä¹Ÿå¾ˆä½ï¼Œå¹¶ä¸”çŠ¹è±«æ˜¯åº•å±‚çš„ï¼Œå› æ­¤æ— æ³•ç®€å•çš„é€šè¿‡z-indexè®¾ç½®æ˜¾ç¤ºå±‚çº§ã€‚è€Œé«˜å¾·å®˜æ–¹çš„jsåœ°å›¾å°±éå¸¸å‹å¥½äº†ï¼Œå¹¶ä¸”åŠŸèƒ½é½å…¨ï¼Œè‡ªå®šä¹‰ç¨‹åº¦é«˜ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webview"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webview" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webview"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨webview</h2><p>å› ä¸ºåœ¨uni-appä¸­ï¼Œæ‰“åŒ…åçš„æ‰‹æœºç¯å¢ƒæ˜¯æ²¡æœ‰docmentå¯¹è±¡æˆ–æ˜¯windowå¯¹è±¡ç­‰ä¸€äº›åˆ—æˆ‘ä»¬å¸¸ç”¨çš„apiï¼Œæ²¡æœ‰documentå¯¹è±¡æˆ‘ä»¬å°±æ— æ³•å°†é«˜å¾·åœ°å›¾çš„apiä»¥scriptæ ‡ç­¾çš„å½¢å¼å¼•å…¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‹¿ä¸åˆ°AMapçš„å®ä¾‹äº†ã€‚è€Œä½¿ç”¨webviewæ§ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥è‡ªå·±çš„htmlæ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªhtmlæ–‡ä»¶é‡Œç”¨scriptæ ‡ç­¾å¼•å…¥é«˜å¾·åœ°å›¾ä¾¿å¯ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge,chrome=1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"renderer"</span> <span class="attr">content</span>=<span class="string">"webkit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css"><span class="selector-id">#map-container</span> &#123;</span></span><br><span class="line">width: 100vw;</span><br><span class="line">height: 100vh;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://webapi.amap.com/maps?v=1.4.15&amp;key=********&amp;plugin=Map3D,AMap.DistrictLayer,AMap.Scale,AMap.ToolBar"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/webview.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/map.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"map-container"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾&quot;&gt;&lt;a href=&quot;#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾&quot; class=&quot;headerlink&quot; title=&quot;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾&quot;&gt;&lt;/a&gt;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŸç”Ÿçš„jsé«˜å¾·åœ°å›¾&lt;/h2&gt;&lt;p&gt;é¦–å…ˆè¯´ä¸€ä¸‹åŸå› ï¼Œè™½ç„¶uni-appè‡ª
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="uni-app" scheme="http://localhost:4000/tags/uni-app/"/>
    
      <category term="é«˜å¾·åœ°å›¾" scheme="http://localhost:4000/tags/%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>flutteré¡µé¢é‡ç»˜é—®é¢˜è§£å†³æ–¹æ¡ˆ</title>
    <link href="http://localhost:4000/2020/07/11/flutter%E9%A1%B5%E9%9D%A2%E9%87%8D%E7%BB%98%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>http://localhost:4000/2020/07/11/flutter%E9%A1%B5%E9%9D%A2%E9%87%8D%E7%BB%98%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2020-07-11T05:54:10.000Z</published>
    <updated>2020-07-11T05:57:10.860Z</updated>
    
    <content type="html"><![CDATA[<h2 id="IndexedStack"><a href="#IndexedStack" class="headerlink" title="IndexedStack"></a>IndexedStack</h2><p>IndexedStackç»„ä»¶ç»§æ‰¿è‡ªStackï¼Œä¸¤ä¸ªå‚æ•°</p><ul><li>Index: å½“å‰æ˜¾ç¤ºçš„ç»„ä»¶åˆ—è¡¨ä¸­çš„çš„ç¬¬å‡ ä¸ª</li><li>children: æ¸²æŸ“é¡µé¢çš„ç»„ä»¶åˆ—è¡¨</li></ul><p>ä½¿ç”¨:</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">   <span class="built_in">int</span> currentIndex;</span><br><span class="line">   <span class="built_in">List</span>&lt;Widget&gt; pages = [Pages1(), Pages2(), Pages3()];</span><br><span class="line">   ...</span><br><span class="line">   ...</span><br><span class="line">   ...</span><br><span class="line">   <span class="meta">@override</span></span><br><span class="line">   Widget build(BuildContext context) &#123;</span><br><span class="line">   <span class="keyword">return</span> Scaffold(</span><br><span class="line">     appBar: AppBar(</span><br><span class="line">       title: Text(<span class="string">'demo'</span>),</span><br><span class="line">     ),</span><br><span class="line">     bottomNavigationBar: BottomNavigationBar(</span><br><span class="line">       items: items, currentIndex: currentIndex, onTap: onTap),</span><br><span class="line">     body: IndexedStack(</span><br><span class="line">       index: currentIndex,</span><br><span class="line">       children: pages</span><br><span class="line">     )</span><br><span class="line">   );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™åœ¨æ–¹æ³•é…ç½®æœ€ç®€å•ï¼Œä½†æ˜¯ä¸€è¿›å…¥ç¨‹åºå°±ä¼šç›´æ¥å°†pagesåˆ—è¡¨ä¸­å¼•ç”¨çš„æ‰€æœ‰ç»„ä»¶éƒ½åˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªæ˜¯æ€§èƒ½æ¶ˆè€—é—®é¢˜ï¼Œå¦å¤–å¦‚æœæŸä¸ªé¡µé¢æ˜¯æœ‰è¿›å…¥åŠ¨ç”»çš„ï¼Œé‚£ä¹ˆåœ¨åˆå§‹åŒ–æ—¶åŠ¨ç”»ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œä¹‹åå†ç‚¹å‡»å»å°±æ²¡æœ‰åŠ¨ç”»äº†ã€‚</p><h2 id="Offstage"><a href="#Offstage" class="headerlink" title="Offstage"></a>Offstage</h2><p>æ­¤æ–¹æ³•å®é™…æ˜¯é…ç½®éšè—ç»„ä»¶ï¼Œä¹Ÿæ˜¯ä¸¤ä¸ªå‚æ•°:</p><ul><li><p>Offstage: è®¾ç½®ç»„ä»¶<strong>éšè—</strong>çš„æ¡ä»¶</p></li><li><p>child: ç»„ä»¶</p></li></ul><p>ä½¿ç”¨ï¼š</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TabBar</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;StatefulWidget&gt; createState() =&gt; _TabBarState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_TabBarState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">TabBar</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// åœ¨æ­¤å®šä¹‰å½“å‰tabçš„ç´¢å¼•</span></span><br><span class="line">  <span class="built_in">int</span> currentIndex = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">"wave"</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primaryColor: Colors.white</span><br><span class="line">      ),</span><br><span class="line">      home: Scaffold(</span><br><span class="line">        appBar: PreferredSize(</span><br><span class="line">          child: (AppBar(title: Text(<span class="string">"æ ‡é¢˜"</span>), leading: Icon(Icons.list, color: Colors.black), centerTitle: <span class="keyword">true</span>)),</span><br><span class="line">          preferredSize: Size.fromHeight(<span class="number">50</span>)</span><br><span class="line">        ),</span><br><span class="line">        body: Stack(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            Offstage(</span><br><span class="line">              offstage: currentIndex != <span class="number">0</span>,</span><br><span class="line">              child: FollowPage(),</span><br><span class="line">            ),</span><br><span class="line">            Offstage(</span><br><span class="line">              offstage: currentIndex != <span class="number">1</span>,</span><br><span class="line">              child: NextPage(),</span><br><span class="line">            ),</span><br><span class="line">            Offstage(</span><br><span class="line">              offstage: currentIndex != <span class="number">2</span>,</span><br><span class="line">              child: MinePage(),</span><br><span class="line">            )</span><br><span class="line">          ]</span><br><span class="line">        ),</span><br><span class="line">        ...</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Offstageç»„ä»¶é—®é¢˜å’ŒIndexedStackä¸€æ ·ï¼Œåˆå§‹å°±ä¼šå°†æ‰€æœ‰ç©ºé—´éƒ½æ¸²æŸ“äº†ï¼Œåªæ˜¯ä¼šæ ¹æ®è§„åˆ™éšè—éƒ¨åˆ†ã€‚å¯¹äºæœ‰åŠ¨ç”»çš„éƒ¨åˆ†ä½¿ç”¨æ­¤ç©ºé—´ä¼šå¯¼è‡´åŠ¨ç”»æ— æ•ˆã€‚</p><h2 id="AutomaticKeepAliveClientMixin"><a href="#AutomaticKeepAliveClientMixin" class="headerlink" title="AutomaticKeepAliveClientMixin"></a>AutomaticKeepAliveClientMixin</h2><p>AutomaticKeepAliveClientMixinæ˜¯ä¸€ä¸ªMixinæ··å…¥ç±»ï¼Œä½¿ç”¨å®ƒèƒ½å¤Ÿå®ç°ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•æ— æ³•å®Œæˆçš„æ•ˆæœ:</p><ul><li>ç¼“å­˜é¡µé¢ï¼Œä½†ä¸ä¼šä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰é¡µé¢éƒ½æ¸²æŸ“ã€‚</li><li>åªæœ‰ç¬¬ä¸€æ¬¡è¿›å…¥é¡µé¢æ—¶æ‰ä¼šæ¸²æŸ“é¡µé¢ï¼Œè§¦å‘initStateç­‰é’©å­å‡½æ•°ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨æ··å…¥ç±»AutomaticKeepAliveClientMixinè¾¾æˆçš„æ•ˆæœå°±åƒæˆ‘ä»¬ä½¿ç”¨Vueä¸­çš„é¡µé¢ç¼“å­˜æŠ€æœ¯ä¸€æ ·ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ä½¿ç”¨æ–¹æ³•:</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:flutter/material.dart'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'components/wb-list.dart'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FollowPage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;StatefulWidget&gt; createState() =&gt; FollowPageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FollowPageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">FollowPage</span>&gt; <span class="title">with</span> <span class="title">AutomaticKeepAliveClientMixin</span> </span>&#123;</span><br><span class="line">  <span class="comment">// åœ¨å¤–å±‚å®šä¹‰æ»šåŠ¨controller ä»¥ä¾¿åœ¨æ­¤æ§åˆ¶é¡µé¢è¿”å›é¡¶éƒ¨</span></span><br><span class="line">  ScrollController _scrollController = ScrollController();</span><br><span class="line"><span class="keyword">final</span> GlobalKey&lt;WBListState&gt; _wbListKey = <span class="keyword">new</span> GlobalKey&lt;WBListState&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡å†™AutomaticKeepAliveClientMixinçš„wantKeepAliveçš„getterï¼Œæ­¤å±æ€§é»˜è®¤æ˜¯false</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">bool</span> <span class="keyword">get</span> wantKeepAlive =&gt; <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// åœ¨é‡å†™çš„buildæ–¹æ³•å†…ä¸€å®šè¦æ³¨æ„è°ƒç”¨çˆ¶ç±»çš„buildæ–¹æ³•ï¼</span></span><br><span class="line">    <span class="keyword">super</span>.build(context);</span><br><span class="line">    <span class="keyword">return</span> Column(</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Flexible(</span><br><span class="line">          child: WBList(</span><br><span class="line">            fetchData: wbList,</span><br><span class="line">            scrollController: _scrollController,</span><br><span class="line">          ),</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ä¸€ä¸‹ä½¿ç”¨AutomaticKeepAliveClientMixinéœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p><ul><li><p>é‡å†™wanKeepAliveçš„getterï¼Œå¹¶è¿”å›true</p></li><li><p>åœ¨buildå‡½æ•°å†…è°ƒç”¨çˆ¶ç±»çš„buildæ–¹æ³•ã€‚</p></li><li><p>éœ€è¦æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨ç±»ä¼¼BottomNavigationBarè¿™ç§ä½¿ç”¨åº•æ è¿›è¡Œé¡µé¢åˆ‡æ¢ï¼Œå¹¶ä¸”åˆ‡æ¢çš„é¡µé¢ä½¿ç”¨importå¯¼å…¥ï¼Œé‚£ä¹ˆAutomaticKeepAliveClientMixinä¸èƒ½å†™åœ¨BottomNavigationBaræ‰€åœ¨çš„çˆ¶é¡µé¢ï¼åŠ¡å¿…è¿›å…¥æ¯ä¸ªå¯¼å…¥çš„é¡µé¢ä¸ºä»–ä»¬ä¹¦å†™ä»¥ä¸Šä»£ç ã€‚</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;IndexedStack&quot;&gt;&lt;a href=&quot;#IndexedStack&quot; class=&quot;headerlink&quot; title=&quot;IndexedStack&quot;&gt;&lt;/a&gt;IndexedStack&lt;/h2&gt;&lt;p&gt;IndexedStackç»„ä»¶ç»§æ‰¿è‡ªStackï¼Œä¸¤ä¸ªå‚æ•°&lt;/p
      
    
    </summary>
    
    
      <category term="å­¦ä¹ ç¬”è®°" scheme="http://localhost:4000/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="flutter" scheme="http://localhost:4000/tags/flutter/"/>
    
  </entry>
  
  <entry>
    <title>vueå¼€å‘ä¸­çš„å®ç”¨æŠ€å·§</title>
    <link href="http://localhost:4000/2020/06/22/vue%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    <id>http://localhost:4000/2020/06/22/vue%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/</id>
    <published>2020-06-22T11:51:23.000Z</published>
    <updated>2020-07-04T03:01:46.974Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Vue-cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ"><a href="#Vue-cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="Vue.cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ"></a>Vue.cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ</h2><p>å¯¹äºåœ¨vueè„šæ‰‹æ¶ä¸­åŒºåˆ†å¼€ç¯å¢ƒï¼Œæˆ‘ä¸€ç›´ç”¨çš„ä¸‹é¢çš„æ–¹æ³•:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">baseUrl: process.env.NODE_ENV === <span class="string">'development'</span>? xxx.com : yyy.com</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æ²¡æ¯›ç—…ï¼Œèƒ½æ­£å¸¸è¿è¡Œï¼Œä¸è¿‡è¿˜æœ‰ä¸€ç§æ›´å¥½çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶:</p><p><img src="/BeCoderQ.github.io/2020/06/22/vueå¼€å‘ä¸­çš„å®ç”¨æŠ€å·§/struct.png" alt="ç»“æ„"></p><p>.env.productionæ–‡ä»¶ä¸.env.developmentæ–‡ä»¶åˆ†åˆ«æ˜¯ç”Ÿäº§ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒå¯¹åº”çš„æ–‡ä»¶ï¼Œåœ¨æˆ‘ä»¬run devæ—¶åè€…ä¼šç”Ÿæ•ˆï¼Œrun buildæ—¶å‰è€…ä¼šç”Ÿæ•ˆï¼Œç„¶åæˆ‘ä»¬åˆ©ç”¨è¿™ç‚¹å¯ä»¥è½»æ¾çš„å®ç°ç±»ä¼¼ä¸‹é¢çš„æ“ä½œ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­æˆ‘ä»¬éƒ½è®¾ç½®ä¸€ä¸ªåœ°å€å˜é‡ å½“ç„¶åœ°å€çš„è·¯å¾„ä¼šæ ¹æ®ç¯å¢ƒè€Œä¸åŒ</span></span><br><span class="line">VUE_APP_BASE_API = <span class="string">"http://xxx.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥ä¸‹æ¥åœ¨axiosçš„é…ç½®æ–‡ä»¶ä¸­</span></span><br><span class="line">...</span><br><span class="line">baseUrl: process.env.VUE_APP_BASE_API</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®Œæˆäº†ç”Ÿäº§ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒçš„åŒºåˆ†ã€‚</p><h2 id="å·§å¦™åˆ©ç”¨refé’©å­"><a href="#å·§å¦™åˆ©ç”¨refé’©å­" class="headerlink" title="å·§å¦™åˆ©ç”¨refé’©å­"></a>å·§å¦™åˆ©ç”¨refé’©å­</h2><p>åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œä¼šé‡åˆ°ä¸€äº›å¤æ‚çš„é¡µé¢ï¼Œè¿™äº›é¡µé¢æˆ‘ä»¬ä¼šæŠŠç»„ä»¶æŠ½ç¦»å‡ºæ¥ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨å‚æ•°ä¼ é€’ï¼Œäº‹ä»¶è§¦å‘ç­‰é—®é¢˜ï¼Œå¯¹äºä¸Šè¿°é—®é¢˜ï¼Œåˆç†åˆ©ç”¨refé’©å­å¯ä»¥å°‘å†™ä¸å°‘ä»£ç ï¼Œä¸‹é¢çœ‹ä¾‹å­ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- çˆ¶ç»„ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"button"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"$refs['deal-violation'].onDeal(row)"</span>&gt;</span></span><br><span class="line">          ç«‹å³å¤„ç†</span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- å­ç»„ä»¶ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">electric-deal-violation</span> <span class="attr">ref</span>=<span class="string">"deal-violation"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åœ¨å­ç»„ä»¶å†…éƒ¨</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  methods: &#123;</span><br><span class="line">      onDeal(data) &#123;</span><br><span class="line">          <span class="comment">// do something</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„å¥½å¤„æ˜¯æˆ‘ä»¬è®©çˆ¶å­é€šä¿¡åå­ç»„ä»¶çš„é€»è¾‘èƒ½åœ¨è‡ªå·±å†…éƒ¨å®Œæˆï¼Œé™ä½äº†ä¸çˆ¶ç»„ä»¶çš„è€¦åˆåº¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ ·çš„æ“ä½œå¹¶ä¸æ˜¯æ‰€æœ‰æƒ…å†µéƒ½é€‚ç”¨ï¼š</p><ul><li><p>å¦‚æœçˆ¶ç»„ä»¶ä¸å­ç»„ä»¶æœ‰è¾ƒå¤šçš„æ•°æ®æ¥æºï¼Œé‚£ä¹ˆè¿˜æ˜¯é€‚ç”¨propsä¼ å‚ï¼Œå› ä¸ºè¿™æ ·èƒ½ä¸€ç›®äº†ç„¶å“ªäº›æ•°æ®ä¼šå½±å“å­ç»„ä»¶ã€‚</p></li><li><p>åµŒå¥—è¶…è¿‡ä¸€å±‚çš„ç»„ä»¶ä¸å®œä½¿ç”¨è¯¥æ–¹æ³•ã€‚</p></li></ul><h2 id="ä½¿ç”¨-attrså±æ€§äºŒæ¬¡å°è£…ç»„ä»¶"><a href="#ä½¿ç”¨-attrså±æ€§äºŒæ¬¡å°è£…ç»„ä»¶" class="headerlink" title="ä½¿ç”¨$attrså±æ€§äºŒæ¬¡å°è£…ç»„ä»¶"></a>ä½¿ç”¨$attrså±æ€§äºŒæ¬¡å°è£…ç»„ä»¶</h2><p>$attrsè¿™ä¸ªå±æ€§å†…éƒ¨æ˜¯çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’çš„å‚æ•°ï¼Œå½“ç„¶ï¼Œä¸åŒ…å«åœ¨å­ç»„ä»¶å†…é€šè¿‡propså±æ€§æ³¨å†Œçš„ã€‚ä¸€èˆ¬æˆ‘ä»¬åœ¨åµŒå¥—ç»„ä»¶å†…ä¼šä½¿ç”¨$attrså±æ€§ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è¿™é‡Œæˆ‘ä»¬äºŒæ¬¡å°è£…ä¸€ä¸ªelementuiçš„è¡¨æ ¼+åˆ†é¡µç»„ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"table"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-table</span> <span class="attr">v-bind</span>=<span class="string">"$attrs"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">"pagination"</span> </span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-pagination</span></span></span><br><span class="line"><span class="tag">                <span class="attr">layout</span>=<span class="string">"total, prev, pager, next"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:total</span>=<span class="string">"total"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">:page-size</span>=<span class="string">"pageSize"</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">current-change</span>=<span class="string">"pageChange"</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">prev-click</span>=<span class="string">"pageChange"</span></span></span><br><span class="line"><span class="tag">                @<span class="attr">next-click</span>=<span class="string">"pageChange"</span></span></span><br><span class="line"><span class="tag">            &gt;</span><span class="tag">&lt;/<span class="name">el-pagination</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªæ¥æ”¶åˆ†é¡µçš„å±æ€§ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// è¿™é‡Œåªæ¥æ”¶äº†sonTitleå±æ€§</span></span><br><span class="line">  props: &#123;</span><br><span class="line">      total: &#123;</span><br><span class="line">            type: <span class="built_in">Number</span>,</span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        pageSize: &#123;</span><br><span class="line">            type: <span class="built_in">Number</span>,</span><br><span class="line">            <span class="keyword">default</span>: <span class="number">10</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æˆ‘ä»¬åœ¨el-tableæ ‡ç­¾ä¸Šä½¿ç”¨äº†$attrså±æ€§ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨å¤–éƒ¨è°ƒç”¨è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œå°±èƒ½å¤Ÿåƒç›´æ¥ä½¿ç”¨el-tableä¸€æ ·ä¼ é€’å„ç§è¯¸å¦‚dataç­‰å±æ€§ï¼Œé™¤äº†å£°æ˜çš„totalä¸pageSizeå±æ€§ï¼Œå…¶ä»–éƒ½ä¼šè¢«æ”¾å½“$attrsé‡Œä¼ é€’ç»™el-tableã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Vue-cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ&quot;&gt;&lt;a href=&quot;#Vue-cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ&quot; class=&quot;headerlink&quot; title=&quot;Vue.cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ&quot;&gt;&lt;/a&gt;Vue.cliä¸­åŒºåˆ†å¼€å‘ã€ç”Ÿäº§ç¯å¢ƒ&lt;/h2&gt;&lt;p&gt;å¯¹äºåœ¨vueè„šæ‰‹æ¶ä¸­
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="vue.cli4" scheme="http://localhost:4000/tags/vue-cli4/"/>
    
      <category term="vue" scheme="http://localhost:4000/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>vue.cli4ç‰ˆæœ¬ä¸‹è·¨åŸŸä»£ç†é…ç½®ä¸æ•°æ®mock</title>
    <link href="http://localhost:4000/2020/05/27/vue-cli4%E7%89%88%E6%9C%AC%E4%B8%8B%E8%B7%A8%E5%9F%9F%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%95%B0%E6%8D%AEmock/"/>
    <id>http://localhost:4000/2020/05/27/vue-cli4%E7%89%88%E6%9C%AC%E4%B8%8B%E8%B7%A8%E5%9F%9F%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%95%B0%E6%8D%AEmock/</id>
    <published>2020-05-27T08:09:01.000Z</published>
    <updated>2020-05-31T11:57:07.590Z</updated>
    
    <content type="html"><![CDATA[<h2 id="proxyä»£ç†é…ç½®"><a href="#proxyä»£ç†é…ç½®" class="headerlink" title="proxyä»£ç†é…ç½®"></a>proxyä»£ç†é…ç½®</h2><p>æœ€è¿‘æ­äº†ä¸€ä¸ªé¡¹ç›®çš„æ¶å­ï¼Œæ¥å£è¯·æ±‚åº“ç”¨çš„axiosï¼Œç¬¬ä¸€ä¸ªæµ‹è¯•æ¥å£å°±ç»™æ‰”äº†CORSï¼Œäºæ˜¯æ‰“å¼€vue.config.jsæ–‡ä»¶é…ç½®ä»£ç†æœåŠ¡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vue.config.jsä¸­</span></span><br><span class="line">devServer: &#123;</span><br><span class="line">port: port,</span><br><span class="line">    open: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦åœ¨runèµ·æ¥åè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨</span></span><br><span class="line">    hot: <span class="literal">true</span>, <span class="comment">// å¼€å¯çƒ­é‡è½½</span></span><br><span class="line">    overlay: &#123;</span><br><span class="line">         warnings: <span class="literal">false</span>,</span><br><span class="line">         errors: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/proxy'</span>: &#123; <span class="comment">// åŒ¹é…çš„åœ°å€</span></span><br><span class="line">        target: <span class="string">'çœŸå®çš„è¯·æ±‚åœ°å€, å¦‚https://real-request-address.com/api...'</span>,</span><br><span class="line">          changeOrigin: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// è·¯å¾„é‡å†™ï¼Œè¿™é‡Œå°±ç»™ä¸ªç©ºçš„ï¼Œå› ä¸ºæˆ‘é…ç½®çš„æ–¹å¼ä¼šè®©/proxyç›´æ¥æ”¾åˆ°è¯·æ±‚è·¯å¾„é‡Œï¼Œæ‰€ä»¥é‚£å¹¶ä¸æ˜¯çœŸå®è·¯å¾„ã€‚å› æ­¤è¿™é‡Œé‡å†™ä¸ºç©ºã€‚</span></span><br><span class="line">            pathRewrite: &#123;<span class="string">'^/proxy'</span>: <span class="string">''</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>æˆ‘æ˜¯ç”¨çš„æ˜¯axiosï¼Œè‡ªå·±æ ¹æ®éœ€æ±‚äºŒæ¬¡å°è£…äº†ï¼Œé…ç½®é¡¹å¤§æ¦‚åœ¨å¦‚ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// åŸºç¡€urlå‰ç¼€</span></span><br><span class="line">    baseURL: <span class="string">'/proxy'</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¥½åå°±èƒ½ç›´æ¥ä½¿ç”¨äº†ï¼Œéœ€è¦æ³¨æ„ï¼Œè¿™é‡ŒbaseUrlè®¾ç½®ä¸ºvue.config.jsä¸­ä»£ç†æ‰€åŒ¹é…çš„è·¯å¾„å³å¯ã€‚è¯·æ±‚å‘é€åï¼Œæˆ‘ä»¬çœ‹åˆ°çš„è¯·æ±‚è·¯å¾„å°±æ˜¯æœ¬åœ°è·¯å¾„ï¼Œä½†å®é™…å·²ç»è¢«ä»£ç†äº†ï¼Œèƒ½å¤Ÿæ­£å¸¸å‘é€å¹¶æ¥å—è¿”å›å€¼äº†ã€‚</p><h2 id="åˆ©ç”¨è„šæ‰‹æ¶è‡ªå¸¦çš„expresså®ç°å‰åç«¯åˆ†ç¦»"><a href="#åˆ©ç”¨è„šæ‰‹æ¶è‡ªå¸¦çš„expresså®ç°å‰åç«¯åˆ†ç¦»" class="headerlink" title="åˆ©ç”¨è„šæ‰‹æ¶è‡ªå¸¦çš„expresså®ç°å‰åç«¯åˆ†ç¦»"></a>åˆ©ç”¨è„šæ‰‹æ¶è‡ªå¸¦çš„expresså®ç°å‰åç«¯åˆ†ç¦»</h2><p>æˆ‘çš„vue.cli4è‡ªå¸¦äº†expressï¼ŒåŒæ ·æ˜¯åœ¨vue.config.jsæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‹¦æˆªè¯·æ±‚ï¼Œå¹¶ä½¿ç”¨expresså®ç°å‰ç«¯åç«¯åˆ†ç¦»ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹æˆ‘çš„è¯·æ±‚æ–‡ä»¶ç»“æ„:</p><p><img src="/BeCoderQ.github.io/2020/05/27/vue-cli4ç‰ˆæœ¬ä¸‹è·¨åŸŸä»£ç†é…ç½®ä¸æ•°æ®mock/construct.png" alt="è¯·æ±‚å…ƒæ•°æ®ç»“æ„"></p><h3 id="apiæ–‡ä»¶ä¸­"><a href="#apiæ–‡ä»¶ä¸­" class="headerlink" title="apiæ–‡ä»¶ä¸­"></a>apiæ–‡ä»¶ä¸­</h3><p>åœ¨apié‡Œçš„modulesæ–‡ä»¶ä¸‹æœ‰æ‰€æœ‰æŒ‰æ¨¡å—åˆ†å¥½çš„è¯·æ±‚åœ°å€æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å†…æ˜¯è¿™æ ·çš„:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> apis = &#123;</span><br><span class="line">    <span class="string">"login"</span>: &#123; <span class="attr">url</span>: <span class="string">"/ad/user/auth"</span>, <span class="attr">noToken</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  <span class="comment">// è¿™é‡Œçš„mockåé¢ä¼šè§£é‡Š</span></span><br><span class="line">  <span class="string">"list"</span>: &#123; <span class="attr">url</span>: <span class="string">"/ad/user/list"</span>, <span class="attr">mock</span>: &#123;</span><br><span class="line">      code: <span class="number">0</span>,</span><br><span class="line">      data: [</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">'zhou'</span>, <span class="attr">age</span>: <span class="number">23</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">'ming'</span>, <span class="attr">age</span>: <span class="number">23</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125; &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// export default apis </span></span><br><span class="line"><span class="built_in">module</span>.exports = apis</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸ç”¨exportå¯¼å‡ºè€Œç”¨common.jsçš„å¯¼å‡ºè§„åˆ™æ˜¯å› ä¸ºè¿˜éœ€è¦åœ¨nodeç¯å¢ƒçš„æ–‡ä»¶é‡Œå–åˆ°è¿™äº›å…ƒæ•°æ®ã€‚</p><p>ä¸‹é¢çš„index.jsæ–‡ä»¶ä¼šå°†æ‰€æœ‰æ¥å£æ–‡ä»¶çš„æ–‡ä»¶åä¸æ–‡ä»¶å†…çš„æ¥å£åœ°å€è€¦åˆ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> apiMap = &#123;&#125;</span><br><span class="line"><span class="comment">// è¿™ä¸ªfileNameç”¨äºå­˜å‚¨modulesä¸‹æ‰€æœ‰æ–‡ä»¶çš„æ–‡ä»¶å</span></span><br><span class="line"><span class="keyword">let</span> fileName = []</span><br><span class="line"><span class="comment">/* åˆ©ç”¨webpackçš„require.contextåŠ è½½modulesä¸‹æ‰€æœ‰çš„æ¥å£æ–‡ä»¶ */</span></span><br><span class="line"><span class="keyword">var</span> moduleFiles = <span class="built_in">require</span>.context(<span class="string">'./modules'</span>, <span class="literal">true</span>, /\.js$/)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å–æ¨¡å—ä¸‹çš„apié…ç½®å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * @param moduleName æ¨¡å—æ–‡ä»¶å</span></span><br><span class="line"><span class="comment"> * @param apiName æ–‡ä»¶ä¸‹apiæ¨¡å—å</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">moduleFiles.keys().map(<span class="function"><span class="keyword">function</span>(<span class="params">modulePath</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> moduleName = modulePath.substr(modulePath.lastIndexOf(<span class="string">'/'</span>) + <span class="number">1</span>, modulePath.length - <span class="number">5</span>)</span><br><span class="line">    fileName.push(moduleName)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// è¿™é‡Œå› ä¸ºmodulesä¸‹çš„æ–‡ä»¶éƒ½æ˜¯ä»¥module.exportså¯¼å‡ºï¼Œæ‰€ä»¥è¦ç”¨requireçš„æ–¹å¼æ‹¿åˆ°å¯¼å‡ºå€¼</span></span><br><span class="line">fileName.forEach(<span class="function"><span class="params">name</span>=&gt;</span> &#123;</span><br><span class="line">    apiMap[name] = <span class="built_in">require</span>(<span class="string">`./modules/<span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œå¯¼å¤„çš„ç»“æœå°†ä¸ºæˆ‘å°è£…çš„axiosæ‰€ç”¨</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> apiMap</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°è£…çš„ç»“æœå°±æ˜¯è®©æˆ‘çš„axioså¯ä»¥ä»¥å¦‚ä¸‹çš„æ–¹å¼è°ƒç”¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.$api.user.login(&#123; <span class="string">'è¿™é‡Œä¼ é€’postå‚æ•°'</span> &#125;, è¿™é‡Œä¼ é€’queryå‚æ•°).then(<span class="function"><span class="params">res</span>=&gt;</span> &#123;</span><br><span class="line">  æˆåŠŸè¯·æ±‚å¹¶æŒ‰ç…§äº†è§„å®šçš„è¿”å›code</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span>=&gt;</span> &#123;</span><br><span class="line">  è¯·æ±‚è¿”å›æœ‰ä»»ä½•é”™è¯¯æˆ–åœ¨æ‹¦æˆªå™¨ä¸­æœ‰ä»»ä½•å¼‚å¸¸</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œæˆ‘è¯·æ±‚çš„ç¯å¢ƒå°±äº¤ä»£æ¸…æ¥šäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ ¸å¿ƒéƒ¨åˆ†äº†</p><h3 id="åœ¨vue-configä¸­æ‹¿åˆ°å…ƒæ•°æ®å¹¶æ‹¦æˆªè¯·æ±‚"><a href="#åœ¨vue-configä¸­æ‹¿åˆ°å…ƒæ•°æ®å¹¶æ‹¦æˆªè¯·æ±‚" class="headerlink" title="åœ¨vue.configä¸­æ‹¿åˆ°å…ƒæ•°æ®å¹¶æ‹¦æˆªè¯·æ±‚"></a>åœ¨vue.configä¸­æ‹¿åˆ°å…ƒæ•°æ®å¹¶æ‹¦æˆªè¯·æ±‚</h3><p>è¿™ä¸€æ­¥å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨apiçš„modulesæ–‡ä»¶ä¸‹ï¼Œæˆ‘çš„æ‰€æœ‰è¯·æ±‚æ•°æ®éƒ½ä»¥module.exportsæ–¹å¼å¯¼å‡ºçš„åŸå› äº†ï¼Œå› ä¸ºvu e.config.jsæ–‡ä»¶æ˜¯çº¯nodeç¯å¢ƒä¸‹è¿è¡Œï¼Œåƒrequire.contextè¿™ç§apiæ˜¯ç”¨ä¸äº†çš„ï¼å¥½äº†ç›´æ¥çœ‹ä»£ç :</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨æœ€å¤–å±‚ï¼Œæˆ‘ä»¬è¦æ‹¿åˆ°æ‰€æœ‰æ¥å£çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> apiModules = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(process.env.NODE_ENV === <span class="string">'development'</span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œè¦è¯»å–modulesä¸‹çš„apiæ–‡ä»¶å</span></span><br><span class="line">    <span class="keyword">let</span> files = fs.readdirSync(resolve(<span class="string">'/src/api/modules'</span>))</span><br><span class="line">    <span class="comment">// æ‹¿åˆ°æ‰€æœ‰æ–‡ä»¶ååæ”¾å…¥å˜é‡ä¸­</span></span><br><span class="line">    files.forEach(<span class="function"><span class="params">fName</span>=&gt;</span> &#123;</span><br><span class="line">      apiModules.push(<span class="built_in">require</span>(resolve(<span class="string">`/src/api/modules/<span class="subst">$&#123;fName&#125;</span>`</span>)))</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¯»å–æ–‡ä»¶è¦ç”¨åŒæ­¥è¯»å–ï¼Œå¦åˆ™åé¢expresséƒ¨åˆ†ä»£ç æ‰§è¡Œæ—¶å¯èƒ½æ–‡ä»¶è¿˜æ²¡è¯»å–å®Œã€‚</p><p>æ¥ä¸‹æ¥åœ¨configureWebpackå±æ€§ä¸‹:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">            before(app) &#123;</span><br><span class="line">              <span class="comment">// è¿™æ˜¯æˆ‘å¯¼å…¥çš„é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å†…é…ç½®æ˜¯å¦éœ€è¦mockæ•°æ®</span></span><br><span class="line">                <span class="keyword">if</span>(!defaultSettings.enableMock) <span class="keyword">return</span></span><br><span class="line">              <span class="comment">// è¿™å°±æ˜¯å‰é¢æ‹¿åˆ°çš„æ–‡ä»¶åæ•°ç»„</span></span><br><span class="line">                apiModules.forEach(<span class="function"><span class="params">modules</span>=&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">Object</span>.keys(modules).forEach(<span class="function"><span class="params">key</span>=&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span>(modules[key].mock) &#123;</span><br><span class="line">                            app.post(<span class="string">`/proxy<span class="subst">$&#123;modules[key].url&#125;</span>`</span>, (req, res)=&gt; &#123;</span><br><span class="line">                              <span class="comment">// è¿™å„¿æˆ‘ä»¬å°±æ‹¿åˆ°åœ¨apiæ–‡ä»¶å†…å†™çš„mockå‡æ•°æ®å•¦ï¼</span></span><br><span class="line">                                res.json(modules[key].mock)</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>å¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±è®¾ç½®å®Œäº†ï¼Œåœ¨è¯·æ±‚åï¼Œæ¥å£ä¼šè¿”å›æˆ‘ä»¬åœ¨apiçš„modulesæ–‡ä»¶å†…å„ä¸ªæ¥å£ä¸­é…ç½®çš„mockå±æ€§ä¸‹çš„æ•°æ®ï¼Œå¹¶ä¸”ä¸mock.jsä¸åŒï¼Œæ˜¯èƒ½å¤Ÿç›´æ¥åœ¨networké‡Œé¢çœŸå®å­˜åœ¨çš„ä¸€æ¬¡è¯·æ±‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;proxyä»£ç†é…ç½®&quot;&gt;&lt;a href=&quot;#proxyä»£ç†é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;proxyä»£ç†é…ç½®&quot;&gt;&lt;/a&gt;proxyä»£ç†é…ç½®&lt;/h2&gt;&lt;p&gt;æœ€è¿‘æ­äº†ä¸€ä¸ªé¡¹ç›®çš„æ¶å­ï¼Œæ¥å£è¯·æ±‚åº“ç”¨çš„axiosï¼Œç¬¬ä¸€ä¸ªæµ‹è¯•æ¥å£å°±ç»™æ‰”äº†CORSï¼Œäº
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="vue.cli4" scheme="http://localhost:4000/tags/vue-cli4/"/>
    
      <category term="è·¨åŸŸ" scheme="http://localhost:4000/tags/%E8%B7%A8%E5%9F%9F/"/>
    
  </entry>
  
  <entry>
    <title>electronæ‰“åŒ…åæ–‡ä»¶è·¯å¾„é—®é¢˜(è§£å†³å­è¿›ç¨‹æ–‡ä»¶æŠ¥é”™)</title>
    <link href="http://localhost:4000/2020/05/23/electron%E6%89%93%E5%8C%85%E5%90%8E%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98-%E8%A7%A3%E5%86%B3%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%96%87%E4%BB%B6%E6%8A%A5%E9%94%99/"/>
    <id>http://localhost:4000/2020/05/23/electron%E6%89%93%E5%8C%85%E5%90%8E%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98-%E8%A7%A3%E5%86%B3%E5%AD%90%E8%BF%9B%E7%A8%8B%E6%96%87%E4%BB%B6%E6%8A%A5%E9%94%99/</id>
    <published>2020-05-23T05:33:24.000Z</published>
    <updated>2020-05-23T06:13:56.787Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>æœ€è¿‘æ‰‹ä¸Šæœ‰ä¸ªé¡¹ç›®æ˜¯åŸºäºelectronï¼ˆelectron-vueï¼‰å¼€å‘çš„å¹³å°ç›‘æµ‹ç³»ç»Ÿï¼Œæœ‰ä¸€éƒ¨åˆ†æ•°æ®é‡éå¸¸å¤§ï¼Œå¹¶ä¸”æ˜¯å®æ—¶æ›´æ–°æ•°æ®æ»šåŠ¨æ˜¾ç¤ºï¼Œä½†åå°çš„åŒå­¦å¾ˆé¸¡è´¼çš„æ²¡æœ‰è¿‡æ»¤å»é‡å°±æŠŠè¶…å¤šçš„æ•°æ®ä»ç»™æˆ‘äº†ï¼Œå› æ­¤æ•°æ®å¤„ç†å°±äº¤ç»™å‰ç«¯äº†ã€‚ä¸ºäº†ä¸å½±å“é¡µé¢çš„æµç•…æ€§ï¼Œæˆ‘æŠŠè®¡ç®—å»é‡ç­‰æ“ä½œæ”¾åˆ°äº†å­è¿›ç¨‹ä¸­(child_process.fork)ã€‚ä½†æ‰“åŒ…åå‘ç°æŠ›å‡ºäº†channel closedçš„æŠ¥é”™ï¼ˆè¿™é‡Œçš„errorè¾“å‡ºæ˜¯æˆ‘æ‰‹åŠ¨æŠ“å–çš„ï¼‰ï¼š</p><p><img src="/BeCoderQ.github.io/2020/05/23/electronæ‰“åŒ…åæ–‡ä»¶è·¯å¾„é—®é¢˜-è§£å†³å­è¿›ç¨‹æ–‡ä»¶æŠ¥é”™/error.png" alt="æŠ“åˆ°çš„æŠ¥é”™"></p><p>è¿™ä¸ªæŠ¥é”™æˆ‘åœ¨stackoverflowä¸Šçœ‹æœ‰è¯´ç‰ˆæœ¬é—®é¢˜ï¼Œæœ‰è¯´sendæ•°æ®ä¸å¯¹ã€‚ä½†debugäº†åŠå¤©ï¼Œæœ€åå‘ç°å®é™…æ˜¯æ‰“åŒ…åå­è¿›ç¨‹æ–‡ä»¶çš„è·¯å¾„å‡ºäº†é—®é¢˜ã€‚</p><h2 id="åœ¨package-jsonä¸­ä¿®æ”¹é…ç½®"><a href="#åœ¨package-jsonä¸­ä¿®æ”¹é…ç½®" class="headerlink" title="åœ¨package.jsonä¸­ä¿®æ”¹é…ç½®"></a>åœ¨package.jsonä¸­ä¿®æ”¹é…ç½®</h2><p>æ‰¾åˆ°äº†å‡ºé”™çš„åŸå› ï¼Œä¸‹ä¸€æ­¥å°±å¥½åšäº†ï¼Œæ‰“åŒ…åè·¯å¾„æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨package.jsonæ–‡ä»¶ä¸­çš„buildå±æ€§ä¸‹ï¼ŒåŠ å…¥ä¸‹é¢çš„é…ç½®:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"build"</span>: &#123;</span><br><span class="line">  ...otherConfig,</span><br><span class="line">    <span class="string">"asarUnpack"</span>: [</span><br><span class="line"><span class="string">"**/src/renderer/utils/**/*"</span></span><br><span class="line">],</span><br><span class="line">    <span class="string">"extraResources"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"from"</span>: <span class="string">"src/renderer/utils/worker.js"</span>,</span><br><span class="line">          <span class="string">"to"</span>: <span class="string">"app.asar.unpacked/source/worker.js"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æ–‡æ¡£ä¸Šçš„è¯´æ³•ï¼Œ<strong><a href="https://github.com/atom/asar" target="_blank" rel="noopener">asar</a> æ˜¯ä¸€ç§å°†å¤šä¸ªæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶çš„ç±» tar é£æ ¼çš„å½’æ¡£æ ¼å¼ã€‚Electron å¯ä»¥æ— éœ€è§£å‹ï¼Œå³ä»å…¶ä¸­è¯»å–ä»»æ„æ–‡ä»¶å†…å®¹ã€‚</strong></p><p>é‚£ä¹ˆè¿™é‡Œå°±æ˜¯é…ç½®unpackï¼ˆä¸æ‰“åŒ…ï¼‰çš„æ–‡ä»¶ï¼Œæˆ‘çš„å­è¿›ç¨‹æ–‡ä»¶æ”¾åœ¨äº†utilsé‡Œï¼Œå› æ­¤è¿™é‡Œæˆ‘é…ç½®äº†utilsçš„è·¯å¾„ã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°extraResourcesï¼ˆç›´è¯‘é¢å¤–çš„èµ„æºï¼‰ï¼Œä¸‹é¢from-toä¹Ÿå¾ˆæ˜æ˜¾æ˜¯è¦åœ¨æ‰“åŒ…åä»å“ªä¸ªè·¯å¾„åˆ°å“ªä¸ªè·¯å¾„ï¼Œå®é™…å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„å…·ä½“æŸä¸ªæ–‡ä»¶éœ€è¦åœ¨æ‰“åŒ…åå­˜æ”¾åˆ°å“ªä¸ªè·¯å¾„ä¸‹ã€‚</p><h2 id="ä¸»è¿›ç¨‹æ–‡ä»¶ä¸­"><a href="#ä¸»è¿›ç¨‹æ–‡ä»¶ä¸­" class="headerlink" title="ä¸»è¿›ç¨‹æ–‡ä»¶ä¸­"></a>ä¸»è¿›ç¨‹æ–‡ä»¶ä¸­</h2><p>è¿™é‡Œæˆ‘ä»¬è®¾ç½®å¥½äº†æ‰“åŒ…åçš„è·¯å¾„ï¼Œæ¥ä¸‹æ¥å°±åœ¨è°ƒç”¨å­è¿›ç¨‹çš„ä¸»è¿›ç¨‹æ–‡ä»¶å†…åšå¥½å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„åˆ¤å®šå°±å¥½äº†ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¼•å…¥å­è¿›ç¨‹</span></span><br><span class="line"><span class="keyword">const</span> childProcess = <span class="built_in">require</span>(<span class="string">'child_process'</span>)</span><br><span class="line"><span class="comment">// å¼•å…¥path</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="comment">// åˆ¤å®šå½“å‰ç¯å¢ƒçš„å˜é‡</span></span><br><span class="line"><span class="keyword">const</span> isDev = process.env.NODE_ENV &amp;&amp; process.env.NODE_ENV == <span class="string">'development'</span></span><br><span class="line"><span class="comment">// å­è¿›ç¨‹çš„çœŸå®è·¯å¾„ æ³¨æ„åé¢ç”Ÿäº§ç¯èŠ‚çš„è·¯å¾„è¦ä¸package.jsonä¸­é…ç½®çš„ç›¸åŒ</span></span><br><span class="line"><span class="keyword">let</span> _path = isDev?path.join(__dirname, <span class="string">'worker.js'</span>):path.join(process.resourcesPath, <span class="string">'app.asar.unpacked/source/worker.js'</span>)</span><br><span class="line"><span class="keyword">const</span> worker = childProcess.fork(_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> onMessage = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ä»¥ä¸‹ä¸ºæˆ‘çš„ä¸šåŠ¡å‡½æ•° </span></span><br><span class="line">    caculateMsg(clientMsg, serverMsg, callback) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;ä¸»è¿›ç¨‹å¯åŠ¨'</span>, _path)</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            worker.send(&#123;clientMsg, serverMsg&#125;);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;ä¸»è¿›ç¨‹å‘é€å‡ºæ•°æ®'</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œå›è°ƒéµå®ˆerror-firstçš„è®¾è®¡é€»è¾‘</span></span><br><span class="line">            callback(err, <span class="literal">null</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!onMessage)</span><br><span class="line">            onMessage = worker.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;å­è¿›ç¨‹çš„ä¿¡æ¯:'</span>, msg)</span><br><span class="line">                callback(<span class="literal">null</span>, msg)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Done!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;æœ€è¿‘æ‰‹ä¸Šæœ‰ä¸ªé¡¹ç›®æ˜¯åŸºäºelectronï¼ˆelectron-vueï¼‰å¼€å‘çš„å¹³å°ç›‘æµ‹ç³»ç»Ÿï¼Œæœ‰ä¸€éƒ¨åˆ†æ•°æ®é‡éå¸¸å¤§ï¼Œå¹¶ä¸”æ˜¯å®æ—¶æ›´æ–°æ•°
      
    
    </summary>
    
    
      <category term="ç»éªŒæ€»ç»“" scheme="http://localhost:4000/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/"/>
    
    
      <category term="electron" scheme="http://localhost:4000/tags/electron/"/>
    
      <category term="webpack" scheme="http://localhost:4000/tags/webpack/"/>
    
  </entry>
  
</feed>
